"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[6267],{28453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>o});var l=i(96540);const r={},s=l.createContext(r);function t(n){const e=l.useContext(s);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:t(n.components),l.createElement(s.Provider,{value:e},n.children)}},96831:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>x,frontMatter:()=>o,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"mlops/network/istio/traffic-management/envoy-filter/envoy-filter","title":"EnvoyFilter","description":"EnvoyFilter","source":"@site/docs/mlops/network/istio/traffic-management/envoy-filter/envoy-filter.mdx","sourceDirName":"mlops/network/istio/traffic-management/envoy-filter","slug":"/mlops/network/istio/traffic-management/envoy-filter/","permalink":"/docs/mlops/network/istio/traffic-management/envoy-filter/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/network/istio/traffic-management/envoy-filter/envoy-filter.mdx","tags":[],"version":"current","lastUpdatedAt":1746637031000,"frontMatter":{"id":"envoy-filter","title":"EnvoyFilter","sidebar_label":"EnvoyFilter","description":"EnvoyFilter","keywords":["EnvoyFilter"]},"sidebar":"network","previous":{"title":"VirtualService","permalink":"/docs/mlops/network/istio/traffic-management/virtual-service"},"next":{"title":"Auth","permalink":"/docs/mlops/network/istio/traffic-management/envoy-filter/auth"}}');var r=i(74848),s=i(28453),t=i(86025);const o={id:"envoy-filter",title:"EnvoyFilter",sidebar_label:"EnvoyFilter",description:"EnvoyFilter",keywords:["EnvoyFilter"]},c=void 0,a={},d=[{value:"Terminology",id:"terminology",level:2},{value:"EnvoyFilter",id:"envoyfilter",level:2},{value:"Debug",id:"debug",level:2}];function h(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"terminology",children:"Terminology"}),"\n",(0,r.jsx)(e.admonition,{title:"Reference",type:"info",children:(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/intro/terminology",children:"Envoy / Terminology"})}),"\n"]})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Host"}),": \ub124\ud2b8\uc6cc\ud06c \ud1b5\uc2e0\uc774 \uac00\ub2a5\ud55c Entity\ub85c Envoy \ubb38\uc11c\uc5d0\uc11c\ub294 \ud558\ub098\uc758 \ub17c\ub9ac\uc801 \ub124\ud2b8\uc6cc\ud06c \uc560\ud50c\ub9ac\ucf00\uc774\uc158\uc744 \uc758\ubbf8\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Downstream"}),": Envoy\uc5d0 \uc694\uccad\uc744 \ubcf4\ub0b4\uace0 \uc751\ub2f5\uc744 \ubc1b\ub294 host\uc785\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Upstream"}),": Envoy\ub85c\ubd80\ud130 \uc694\uccad\uc744 \ubc1b\uace0 \uc751\ub2f5\uc744 \ubcf4\ub0b4\ub294 host\uc785\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Listener"}),": downstream\uc5d0 \uc5f0\uacb0\ub420 \uc218 \uc788\ub294 \ub124\uc784\ub4dc \ub124\ud2b8\uc6cc\ud06c \uc704\uce58\uc785\ub2c8\ub2e4. e.g., port, unix domain socket"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Cluster"}),": Envoy\uc5d0 \uc5f0\uacb0\ub418\ub294 \ub17c\ub9ac\uc801\uc73c\ub85c \uc720\uc0ac\ud55c upstream host \uadf8\ub8f9\uc785\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Mesh"}),": \uc77c\uad00\ub41c \ub124\ud2b8\uc6cc\ud06c topology\ub97c \uc81c\uacf5\ud558\uae30 \uc704\ud574 \uc870\uc815\ub418\ub294 \ud638\uc2a4\ud2b8 \uadf8\ub8f9\uc73c\ub85c Envoy \ubb38\uc11c\uc5d0\uc11c\ub294 Envoy proxy \uadf8\ub8f9\uc785\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Runtime configuration"}),": \uc2e4\uc2dc\uac04\uc73c\ub85c \ubcc0\uacbd\uac00\ub2a5\ud55c \uc124\uc815\uc785\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"envoyfilter",children:"EnvoyFilter"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://istio.io/latest/docs/reference/config/networking/envoy-filter/",children:"https://istio.io/latest/docs/reference/config/networking/envoy-filter/"})}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"apiVersion: networking.istio.io/v1alpha3\nkind: EnvoyFilter\nmetadata:\n  name: <name>\n  namespace: <namespace>\nspec:\n  workloadSelector:\n    labels:\n      <key>: <value>\n  configPatches:\n    []\n    # - applyTo:\n    #   match:\n    #   patch:\n  # \ud328\uce58\uac00 \uc801\uc6a9\ub418\ub294 \uc6b0\uc120\uc21c\uc704\ub294 namespace \uae30\uc900\uc73c\ub85c \ub8e8\ud2b8 \ub124\uc784\uc2a4\ud398\uc774\uc2a4 -> \uac1c\ubcc4 \ub124\uc784\uc2a4\ud398\uc774\uc2a4\n  # \uc21c\uc73c\ub85c \uc801\uc6a9\ub429\ub2c8\ub2e4.\n  # \uac19\uc740 namespace\uc5d0 \uc5ec\ub7ec EnvoyFilter\uac00 \uc874\uc7ac\ud558\ub294 \uacbd\uc6b0, \uc6b0\uc120\uc21c\uc704\ub294 priority \uae30\uc900\uc73c\ub85c\n  # \uc624\ub984\ucc28\uc21c\uc73c\ub85c \uc801\uc6a9\ub429\ub2c8\ub2e4.\n  # \uac19\uc740 EnvoyFilter\uc5d0 \uc5ec\ub7ec \ud328\uce58\uac00 \uc874\uc7ac\ud558\ub294 \uacbd\uc6b0, \uc6b0\uc120\uc21c\uc704\ub294 \ud328\uce58\uc758 \uc21c\uc11c\ub85c \uc801\uc6a9\ub429\ub2c8\ub2e4.\n  priority: 0 # default\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"workloadSelector"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\uc124\uc815\ud558\uba74 \ub3d9\uc77c\ud55c namespace \ub0b4\uc5d0\uc11c \uc120\ud0dd\ub41c Workload\uc758 Envoy\uc5d0 \ud544\ud130\uac00 \uc801\uc6a9\ub429\ub2c8\ub2e4"}),"\n",(0,r.jsx)(e.li,{children:"\uc124\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \ub3d9\uc77c\ud55c namespace \ub0b4\uc758 \ubaa8\ub4e0 Workload\uc758 Envoy\uc5d0 \ud544\ud130\uac00 \uc801\uc6a9\ub429\ub2c8\ub2e4"}),"\n",(0,r.jsx)(e.li,{children:"namespace\uac00 MeshConfig\uc758 rootNamespace(default: istio-system)\uc640 \uac19\uc740 \uacbd\uc6b0 namespace\uc5d0 \uad00\uacc4\uc5c6\uc774 \uc801\uc6a9\ub429\ub2c8\ub2e4"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"configPatches"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"applyTo"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"LISTENER"}),"\n",(0,r.jsx)(e.li,{children:"FILTER_CHAIN"}),"\n",(0,r.jsx)(e.li,{children:"NETWORK_FILTER"}),"\n",(0,r.jsx)(e.li,{children:"HTTP_FILTER"}),"\n",(0,r.jsx)(e.li,{children:"ROUTE_CONFIGURATION"}),"\n",(0,r.jsx)(e.li,{children:"VIRTUAL_HOST"}),"\n",(0,r.jsx)(e.li,{children:"HTTP_ROUTE"}),"\n",(0,r.jsx)(e.li,{children:"CLUSTER"}),"\n",(0,r.jsx)(e.li,{children:"EXTENSION_CONFIG"}),"\n",(0,r.jsx)(e.li,{children:"BOOTSTRAP"}),"\n",(0,r.jsx)(e.li,{children:"LISTENER_FILTER"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"match"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"context"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"ANY"}),"\n",(0,r.jsx)(e.li,{children:"SIDECAR_INBOUND"}),"\n",(0,r.jsx)(e.li,{children:"SIDECAR_OUTBOUND"}),"\n",(0,r.jsx)(e.li,{children:"GATEWAY"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"patch"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"operation"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"MERGE"}),"\n",(0,r.jsx)(e.li,{children:"ADD"}),"\n",(0,r.jsx)(e.li,{children:"REMOVE"}),"\n",(0,r.jsx)(e.li,{children:"INSERT_BEFORE"}),"\n",(0,r.jsx)(e.li,{children:"INSERT_AFTER"}),"\n",(0,r.jsx)(e.li,{children:"INSERT_FIRST"}),"\n",(0,r.jsx)(e.li,{children:"REPLACE"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"debug",children:"Debug"}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("img",{src:(0,t.Ay)("img/mlops/network/istio/iptables.svg")})}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("strong",{children:(0,r.jsx)(e.a,{href:"https://jimmysong.io/en/blog/sidecar-injection-iptables-and-traffic-routing/",children:"https://jimmysong.io/en/blog/sidecar-injection-iptables-and-traffic-routing/"})})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(e.p,{children:"\uadf8\ub9bc\uc5d0\uc11c 15006 \ud3ec\ud2b8\ub85c \ub4e4\uc5b4\uac00\ub294 \ud2b8\ub798\ud53d\uc774 SIDECAR_INBOUND \ud2b8\ub798\ud53d\uc774\uace0, 15001 \ud3ec\ud2b8\ub85c \ub098\uac00\ub294 \ud2b8\ub798\ud53d\uc774 SIDECAR_OUTBOUND \ud2b8\ub798\ud53d\uc785\ub2c8\ub2e4."}),"\n",(0,r.jsx)(e.p,{children:"\ub530\ub77c\uc11c EnvoyFilter \uc801\uc6a9\uc774 \uc798 \ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud558\uae30 \uc704\ud574 \uc544\ub798 \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc124\uc815\ub41c \ub0b4\uc6a9\uc744 \ud655\uc778\ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"istioctl proxy-status listener -n <namespace> <pod> --port 15006 -o yaml | yq '.[0]'\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'name: virtualInbound\nlistenerFilters: []\nfilterChains:\n  - name:\n    filterChainMatch:\n    filters:\n      - name:\n        typedConfig:\n          "@type":\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-shell",children:"istioctl proxy-status listener -n <namespace> <pod> --port 15001 -o yaml | yq '.[0]'\n"})})]})}function x(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}}}]);