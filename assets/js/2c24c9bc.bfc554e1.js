"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[66913],{28453:(t,e,n)=>{n.d(e,{R:()=>a,x:()=>i});var o=n(96540);const s={},r=o.createContext(s);function a(t){const e=o.useContext(r);return o.useMemo((function(){return"function"==typeof t?t(e):{...e,...t}}),[e,t])}function i(t){let e;return e=t.disableParentContext?"function"==typeof t.components?t.components(s):t.components||s:a(t.components),o.createElement(r.Provider,{value:e},t.children)}},97489:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>p});const o=JSON.parse('{"id":"mlops/mlops/aws/eks/node-group","title":"EKS NodeGroup","description":"EKS NodeGroup","source":"@site/docs/mlops/mlops/aws/eks/node-group.mdx","sourceDirName":"mlops/mlops/aws/eks","slug":"/mlops/mlops/aws/eks/node-group","permalink":"/docs/mlops/mlops/aws/eks/node-group","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/aws/eks/node-group.mdx","tags":[],"version":"current","lastUpdatedAt":1743003044000,"frontMatter":{"id":"node-group","title":"EKS NodeGroup","sidebar_label":"NodeGroup","description":"EKS NodeGroup","keywords":["EKS","NodeGroup"]},"sidebar":"mlops","previous":{"title":"EKS","permalink":"/docs/mlops/mlops/aws/eks/"},"next":{"title":"EKS RBAC","permalink":"/docs/mlops/mlops/aws/eks/eks-rbac"}}');var s=n(74848),r=n(28453);const a={id:"node-group",title:"EKS NodeGroup",sidebar_label:"NodeGroup",description:"EKS NodeGroup",keywords:["EKS","NodeGroup"]},i=void 0,l={},p=[{value:"Role",id:"role",level:2},{value:"NodeGroup",id:"nodegroup",level:2}];function c(t){const e={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...t.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"role",children:"Role"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:'const nodeGroupRoleName = "eks-ng-role";\nconst nodeGroupRole = new aws.iam.Role(\n\tnodeGroupRoleName,\n\t{\n\t\tnamePrefix: `${nodeGroupRoleName}-`,\n\t\tassumeRolePolicy: {\n\t\t\tVersion: "2012-10-17",\n\t\t\tStatement: [\n\t\t\t\t{\n\t\t\t\t\tEffect: "Allow",\n\t\t\t\t\tPrincipal: {\n\t\t\t\t\t\tService: "ec2.amazonaws.com",\n\t\t\t\t\t},\n\t\t\t\t\tAction: "sts:AssumeRole",\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t\ttags: {\n\t\t\tName: nodeGroupRoleName,\n\t\t\t"loliot.net/stack": variable.stackName,\n\t\t},\n\t},\n\t{ protect: true },\n);\n\nconst nodeGroupInstanceProfileName = "eks-ng-instacne-profile";\nconst nodeGroupInstanceProfile = new aws.iam.InstanceProfile(\n\tnodeGroupInstanceProfileName,\n\t{\n\t\tnamePrefix: `${nodeGroupInstanceProfileName}-`,\n\t\trole: nodeGroupRole.name,\n\t\ttags: {\n\t\t\tName: nodeGroupInstanceProfileName,\n\t\t\t"loliot.net/stack": variable.stackName,\n\t\t},\n\t},\n\t{ protect: true },\n);\n\nconst nodeGroupPolicyARNs = {\n\t"0": "arn:aws:iam::aws:policy/AmazonEKSWorkerNodePolicy",\n\t"1": "arn:aws:iam::aws:policy/AmazonEC2ContainerRegistryReadOnly",\n\t"2": "arn:aws:iam::aws:policy/AmazonEKS_CNI_Policy",\n\t"3": "arn:aws:iam::aws:policy/AmazonSSMManagedInstanceCore", // Karpenter\n};\n\nconst nodeGroupRpas = Object.entries(nodeGroupPolicyARNs).map(\n\t([i, arn]) =>\n\t\tnew aws.iam.RolePolicyAttachment(\n\t\t\t`eks-ng-rpa-${i}`,\n\t\t\t{\n\t\t\t\tpolicyArn: arn,\n\t\t\t\trole: nodeGroupRole.name,\n\t\t\t},\n\t\t\t{ protect: true },\n\t\t),\n);\n'})}),"\n",(0,s.jsx)(e.h2,{id:"nodegroup",children:"NodeGroup"}),"\n",(0,s.jsx)(e.admonition,{type:"info",children:(0,s.jsx)(e.p,{children:"EBS \uc554\ud638\ud654\uac00 \ud544\uc694\ud55c \uacbd\uc6b0 \uc9c4\ud589 \uc804\uc5d0 EC2 \uacc4\uc815 \uc18d\uc131\uc758 EBS \uc554\ud638\ud654 \uae30\ubcf8 \uc124\uc815\uc744 \ud65c\uc131\ud654\ud558\uba74 \ub429\ub2c8\ub2e4."})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-ts",children:'const nodeGroupName = "eks-ng";\nconst nodeGroup = new aws.eks.NodeGroup(\n\tnodeGroupName,\n\t{\n\t\tnodeGroupNamePrefix: `${nodeGroupName}-`,\n\t\tclusterName: cluster.name,\n\t\tnodeRoleArn: nodeGroupRole.arn,\n\t\tinstanceTypes: ["m6a.large"],\n\t\tdiskSize: 50,\n\t\tscalingConfig: {\n\t\t\tminSize: 1,\n\t\t\tmaxSize: 1,\n\t\t\tdesiredSize: 1,\n\t\t},\n\t\tsubnetIds: [vpc.privateSubnet1.id],\n\t\tlabels: {\n\t\t\t"node-group": "eks-ng",\n\t\t},\n\t\ttaints: [\n\t\t\t{\n\t\t\t\tkey: "node-group",\n\t\t\t\tvalue: "eks-ng",\n\t\t\t\teffect: "NO_SCHEDULE",\n\t\t\t},\n\t\t],\n\t\ttags: {\n\t\t\tName: nodeGroupName,\n\t\t\t"loliot.net/stack": variable.stackName,\n\t\t},\n\t},\n\t{ protect: true },\n);\n'})})]})}function d(t={}){const{wrapper:e}={...(0,r.R)(),...t.components};return e?(0,s.jsx)(e,{...t,children:(0,s.jsx)(c,{...t})}):c(t)}}}]);