"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[21482],{15302:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"mlops/kubernetes/tools/kubespray/ha","title":"Kubespray Control Plane HA endpoint \uad6c\uc131","description":"Kubespray Control Plane HA endpoint \uad6c\uc131","source":"@site/docs/mlops/kubernetes/tools/kubespray/ha.mdx","sourceDirName":"mlops/kubernetes/tools/kubespray","slug":"/mlops/kubernetes/tools/kubespray/ha","permalink":"/docs/mlops/kubernetes/tools/kubespray/ha","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/kubernetes/tools/kubespray/ha.mdx","tags":[],"version":"current","lastUpdatedAt":1740111436000,"frontMatter":{"id":"ha","title":"Kubespray Control Plane HA endpoint \uad6c\uc131","sidebar_label":"Control Plane HA","description":"Kubespray Control Plane HA endpoint \uad6c\uc131","keywords":["kubespray","kube-apiserver","ha","high availability"]},"sidebar":"kubernetes","previous":{"title":"Kubespray","permalink":"/docs/mlops/kubernetes/tools/kubespray/"},"next":{"title":"etcd","permalink":"/docs/mlops/kubernetes/tools/kubespray/etcd"}}');var r=l(74848),d=l(28453);const i={id:"ha",title:"Kubespray Control Plane HA endpoint \uad6c\uc131",sidebar_label:"Control Plane HA",description:"Kubespray Control Plane HA endpoint \uad6c\uc131",keywords:["kubespray","kube-apiserver","ha","high availability"]},c=void 0,o={},t=[{value:"kube-apiserver HA endpoint",id:"kube-apiserver-ha-endpoint",level:2},{value:"LoadBalancer(LB)\uc5d0 \ub530\ub978 endpoint",id:"loadbalancerlb\uc5d0-\ub530\ub978-endpoint",level:3},{value:"Local LB",id:"local-lb",level:3},{value:"\uc0ac\uc6a9\uc790 \uc815\uc758 \ub124\ud2b8\uc6cc\ud06c",id:"\uc0ac\uc6a9\uc790-\uc815\uc758-\ub124\ud2b8\uc6cc\ud06c",level:4},{value:"External LB",id:"external-lb",level:3}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/kubespray/blob/master/docs/operations/ha-mode.md",children:"Kubespray / HA endpoints for k8s"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"kube-apiserver-ha-endpoint",children:"kube-apiserver HA endpoint"}),"\n",(0,r.jsx)(n.h3,{id:"loadbalancerlb\uc5d0-\ub530\ub978-endpoint",children:"LoadBalancer(LB)\uc5d0 \ub530\ub978 endpoint"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"type"}),(0,r.jsx)(n.th,{children:(0,r.jsx)(n.code,{children:"kube_control_plane"})}),(0,r.jsxs)(n.th,{children:["not ",(0,r.jsx)(n.code,{children:"kube_control_plane"})]}),(0,r.jsx)(n.th,{children:"external"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Local LB(default)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://0.0.0.0:po"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://localhost:llbpo"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://kcp[0].access_ip:po"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Local LB(default) + cbip"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"https://cbip:po"}),(0,r.jsx)("br",{}),(0,r.jsx)(n.code,{children:"https://localhost:llbpo"})]}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://localhost:llbpo"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://kcp[0].access_ip:po"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Local LB + \uc0ac\uc6a9\uc790 \uc815\uc758 \ub124\ud2b8\uc6cc\ud06c"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://0.0.0.0:po"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://localhost:llbpo"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://user_defined"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"External LB"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://0.0.0.0:po"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://lb:lbpo"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://lb:lbpo"})})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"LB \uc5c6\uc74c"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://0.0.0.0:po"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://kcp[0].access_ip:po"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"https://kcp[0].access_ip:po"})})]})]})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kcp"}),": ",(0,r.jsx)(n.code,{children:"kube_control_plane"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cbip"}),": ",(0,r.jsx)(n.code,{children:"kube_apiserver_bind_address"}),"(role)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"po"}),": ",(0,r.jsx)(n.code,{children:"kube_apiserver_port"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"llbpo"}),": ",(0,r.jsx)(n.code,{children:"loadbalancer_apiserver_port"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"lb"}),": ",(0,r.jsx)(n.code,{children:"apiserver_loadbalancer_domain_name"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"lbpo"}),": ",(0,r.jsx)(n.code,{children:"loadbalancer_apiserver.port"})]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Local LB + \uc0ac\uc6a9\uc790 \uc815\uc758 \ub124\ud2b8\uc6cc\ud06c"}),"\ub294 External LB \ub4f1 \uc0ac\uc6a9\uc790\uac00 \uc815\uc758\ud55c \ub124\ud2b8\uc6cc\ud06c\ub97c \ud1b5\ud574 kube-apiserver\uc5d0 \uc811\uadfc \ud558\ub294\uacbd\uc6b0\uc785\ub2c8\ub2e4. Kubespray\ub294 \ud2b9\uc815 \uc0ac\ub840\uac00 \uc544\ub2c8\ub77c\uba74 \uc774 \uacbd\uc6b0\ub294 \uc0ac\uc6a9\ud558\uc9c0 \uc54a\ub294\ub2e4\uace0 \uac04\uc8fc\ud569\ub2c8\ub2e4."]})}),"\n",(0,r.jsx)(n.h3,{id:"local-lb",children:"Local LB"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"kube_control_plane"}),"\uc774 \uc544\ub2cc \uac01 Node\uc5d0\ub294 Local LB\uac00 \uc124\uce58\ub418\uace0, Local LB\ub294 kube-apiserver\uc5d0 \ub300\ud55c \uc694\uccad\uc744 \ubd84\uc0b0\uc2dc\ud0b5\ub2c8\ub2e4. ",(0,r.jsx)(n.code,{children:"loadbalancer_apiserver"}),"\ub97c \uc124\uc815\ud558\uc9c0 \uc54a\uc558\ub2e4\uba74, nginx\ub97c \uc0ac\uc6a9\ud55c Local LB\uac00 \uae30\ubcf8\uc73c\ub85c \ud65c\uc131\ud654\ub429\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["group_vars","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["all","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["all.yml","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver_localhost: true"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver_type: nginx|haproxy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver_port: 6443"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\uc0ac\uc6a9\uc790-\uc815\uc758-\ub124\ud2b8\uc6cc\ud06c",children:"\uc0ac\uc6a9\uc790 \uc815\uc758 \ub124\ud2b8\uc6cc\ud06c"}),"\n",(0,r.jsxs)(n.p,{children:["\uc0ac\uc6a9\uc790\uac00 \uad6c\uc131\ud55c \ub124\ud2b8\uc6cc\ud06c\uac00 \uc788\ub294 \uacbd\uc6b0 \uc678\ubd80\uc5d0 \ub178\ucd9c\ub418\ub294 IP \ub610\ub294 \ub3c4\uba54\uc778\uc744 kube-apiserver \uc778\uc99d\uc11c\uc758 ",(0,r.jsx)(n.strong,{children:"Subject Alternative Name(SAN)"})," \ub9ac\uc2a4\ud2b8\uc5d0 \ucd94\uac00\ud574\uc57c \ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["group_vars","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["k8s_cluster","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["k8s-cluster.yml","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"supplementary_addresses_in_ssl_keys: [<ip|domain>]"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\ud074\ub7ec\uc2a4\ud130\uac00 \uc774\ubbf8 \uc0dd\uc131\ub41c \ud6c4\uc5d0 \ubcc0\uacbd\ud558\ub294 \uacbd\uc6b0 \uc544\ub798 \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud558\uc5ec \ubcc0\uacbd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ansible-playbook -i <inventory> -b upgrade-cluster.yml \\\n  --tags master\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\uc791\uc5c5\uc774 \uc644\ub8cc\ub41c \ud6c4\uc5d0 ",(0,r.jsx)(n.strong,{children:"kubeadm-config"})," ConfigMap\uc744 \ud655\uc778\ud558\uc5ec SAN \ub9ac\uc2a4\ud2b8\uac00 \ubcc0\uacbd\ub418\uc5c8\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl get configmap -n kube-system kubeadm-config -o jsonpath='{.data.ClusterConfiguration}'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"external-lb",children:"External LB"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["group_vars","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["all","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver_localhost: false"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"apiserver_loadbalancer_domain_name: <domain>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver.address: <ip>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"loadbalancer_apiserver.port: 6443"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},28453:(e,n,l)=>{l.d(n,{R:()=>i,x:()=>c});var s=l(96540);const r={},d=s.createContext(r);function i(e){const n=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(d.Provider,{value:n},e.children)}}}]);