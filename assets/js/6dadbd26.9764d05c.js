"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[16972],{16267:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var i=t(74848),c=t(28453);const o={id:"websocket",title:"WebSocket",sidebar_label:"WebSocket",description:"WebSocket",keywords:["websocket"]},r=void 0,l={id:"lang/design/protocol/http/websocket",title:"WebSocket",description:"WebSocket",source:"@site/docs/lang/design/protocol/http/websocket.mdx",sourceDirName:"lang/design/protocol/http",slug:"/lang/design/protocol/http/websocket",permalink:"/docs/lang/design/protocol/http/websocket",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1723642138e3,frontMatter:{id:"websocket",title:"WebSocket",sidebar_label:"WebSocket",description:"WebSocket",keywords:["websocket"]},sidebar:"design",previous:{title:"CORS",permalink:"/docs/lang/design/protocol/http/cors"},next:{title:"WebRTC",permalink:"/docs/lang/design/protocol/http/webrtc"}},s={},d=[{value:"\ub3d9\uc791 \ubc29\uc2dd",id:"\ub3d9\uc791-\ubc29\uc2dd",level:2},{value:"Opening Handshake",id:"opening-handshake",level:2},{value:"Data Framing",id:"data-framing",level:2}];function a(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.rfc-editor.org/rfc/rfc6455",children:"https://www.rfc-editor.org/rfc/rfc6455"})}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\ub3d9\uc791-\ubc29\uc2dd",children:"\ub3d9\uc791 \ubc29\uc2dd"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n  participant Client\n  participant Server\n\n  Note right of Client: HandShake\n  Client->>Server: HTTP Upgrade \uc694\uccad\n  Server--\x3e>Client: HTTP Upgrade \uc751\ub2f5\n\n  Note right of Client: \uc591\ubc29\ud5a5 \ud1b5\uc2e0\n  par Client to Server\n    Client->>Server: message\n  and Server to Client\n    Server->>Client: message\n  end\n\n  Note right of Client: \uc5f0\uacb0 \uc885\ub8cc\n\n  alt Client\uac00 \uc5f0\uacb0 \uc885\ub8cc \uc694\uccad\n    Client->>Server: \uc885\ub8cc \uc694\uccad\n    Server--\x3e>Client: \uc751\ub2f5\n  else Server\uac00 \uc5f0\uacb0 \uc885\ub8cc \uc694\uccad\n    Server->>Client: \uc885\ub8cc \uc694\uccad\n    Client--\x3e>Server: \uc751\ub2f5\n  end"}),"\n",(0,i.jsx)(n.h2,{id:"opening-handshake",children:"Opening Handshake"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"GET /chat HTTP/1.1\nHost: api.loliot.net\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: dGhlIHNhbXBsZSBub25jZQ==\nOrigin: https://wiki.loliot.net\nSec-WebSocket-Protocol: chat, superchat\nSec-WebSocket-Version: 13\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Sec-WebSocket-Key"}),": base64\ub85c \uc778\ucf54\ub529\ub41c 16\ubc14\uc774\ud2b8\uc758 \ub79c\ub364 \uac12\uc785\ub2c8\ub2e4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Sec-WebSocket-Protocol"}),": \ud074\ub77c\uc774\uc5b8\ud2b8\uac00 \uc9c0\uc6d0\ud558\ub294 \ud504\ub85c\ud1a0\ucf5c \ubaa9\ub85d\uc785\ub2c8\ub2e4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Origin"}),": CORS\ub97c \uc704\ud55c \ud5e4\ub354\uc785\ub2c8\ub2e4"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-http",children:"HTTP/1.1 101 Switching Protocols\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: s3pPLMBiTxaQ9kYGzzhZRbK+xOo=\nSec-WebSocket-Protocol: chat\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Sec-WebSocket-Accept"}),": ",(0,i.jsx)(n.code,{children:"Sec-WebSocket-Key"}),"\uac12\uc5d0 ",(0,i.jsx)(n.code,{children:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11"}),"\ub97c \ubd99\uc5ec SHA-1 \ud574\uc2dc\ub97c \ucde8\ud55c \ud6c4 base64\ub85c \uc778\ucf54\ub529\ud55c \uac12\uc785\ub2c8\ub2e4"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Sec-WebSocket-Protocol"}),": \uc11c\ubc84\uac00 \uc120\ud0dd\ud55c \ud504\ub85c\ud1a0\ucf5c\uc785\ub2c8\ub2e4"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"data-framing",children:"Data Framing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-txt",children:" 0                   1                   2                   3\n 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n+-+-+-+-+-------+-+-------------+-------------------------------+\n|F|R|R|R| opcode|M| Payload len |    Extended payload length    |\n|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |\n|N|V|V|V|       |S|             |   (if payload len==126/127)   |\n| |1|2|3|       |K|             |                               |\n+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +\n|     Extended payload length continued, if payload len == 127  |\n+ - - - - - - - - - - - - - - - +-------------------------------+\n|                               |Masking-key, if MASK set to 1  |\n+-------------------------------+-------------------------------+\n| Masking-key (continued)       |          Payload Data         |\n+-------------------------------- - - - - - - - - - - - - - - - +\n:                     Payload Data continued ...                :\n+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +\n|                     Payload Data continued ...                |\n+---------------------------------------------------------------+\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"FIN"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x0"}),": Frame\uc774 \ub354 \uc788\uc74c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x1"}),": \ub9c8\uc9c0\ub9c9 Frame"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"opcode"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x1"}),": \ud14d\uc2a4\ud2b8"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x2"}),": \ubc14\uc774\ub108\ub9ac"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x8"}),": \uc5f0\uacb0 \uc885\ub8cc"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MASK"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x0"}),": Frame\uc774 \ub9c8\uc2a4\ud0b9\ub418\uc9c0 \uc54a\uc74c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"0x1"}),": Frame\uc774 \ub9c8\uc2a4\ud0b9\ub428"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Client\uc5d0\uc11c Server\ub85c \ubcf4\ub0b4\ub294 \ub370\uc774\ud130\ub294 \ubc18\ub4dc\uc2dc \ub9c8\uc2a4\ud0b9\ub418\uc5b4\uc57c \ud569\ub2c8\ub2e4"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var i=t(96540);const c={},o=i.createContext(c);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);