"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[1011],{28453:(n,e,a)=>{a.d(e,{R:()=>c,x:()=>t});var i=a(96540);const s={},d=i.createContext(s);function c(n){const e=i.useContext(d);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),i.createElement(d.Provider,{value:e},n.children)}},88720:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>r,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"lang/javascript/node-addon-api/basics","title":"node-addon-api","description":"node-addon-api","source":"@site/docs/lang/javascript/node-addon-api/basics.mdx","sourceDirName":"lang/javascript/node-addon-api","slug":"/lang/javascript/node-addon-api/basics","permalink":"/docs/lang/javascript/node-addon-api/basics","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/lang/javascript/node-addon-api/basics.mdx","tags":[],"version":"current","lastUpdatedAt":1721925757000,"frontMatter":{"id":"basics","title":"node-addon-api","sidebar_label":"Basics","description":"node-addon-api","keywords":["Node.js","package","node-addon-api"]},"sidebar":"javascript","previous":{"title":"Linting & Formatting","permalink":"/docs/lang/javascript/env/linting-formatting"},"next":{"title":"C++ Class Binding","permalink":"/docs/lang/javascript/node-addon-api/class-binding"}}');var s=a(74848),d=a(28453);const c={id:"basics",title:"node-addon-api",sidebar_label:"Basics",description:"node-addon-api",keywords:["Node.js","package","node-addon-api"]},t=void 0,r={},l=[{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"Setup",id:"setup",level:2},{value:"Wrapper",id:"wrapper",level:2},{value:"Build",id:"build",level:2},{value:"Test",id:"test",level:2},{value:"Reference",id:"reference",level:2}];function o(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - \\\n&& sudo apt-get install -y nodejs\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"mkdir test \\\n&& cd test \\\n&& npm init\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"sudo npm install -g node-gyp\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"npm install node-addon-api\n"})}),"\n",(0,s.jsx)(e.h2,{id:"setup",children:"Setup"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"<package>\n\u251c\u2500\u2500 binding.gyp\n\u251c\u2500\u2500 index.js\n\u251c\u2500\u2500 node_modules\n\u2502   \u2514\u2500\u2500 node-addon-api\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 package-lock.json\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 .clang-format\n\u2514\u2500\u2500 c_src\n    \u251c\u2500\u2500 funcs.cpp\n    \u251c\u2500\u2500 funcs.h\n    \u251c\u2500\u2500 funcs_wrapper.cpp\n    \u251c\u2500\u2500 funcs_wrapper.h\n    \u2514\u2500\u2500 <target>.cpp\n"})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://docs.npmjs.com/files/package.json",children:"package.json"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",metastring:'title="package.json"',children:'{\n    "name": "<package>",\n\n    # ...\n\n    "gypfile": true,\n\n    # ...\n\n    "scripts": {\n        "install": "node-gyp rebuild",\n        "build": "node-gyp rebuild --verbose",\n        "clean": "node-gyp clean",\n        "cf": "clang-format -style=file -i -verbose c_src/*"\n    },\n\n    # ...\n\n    "dependencies": {\n        "node-addon-api": "*",\n    },\n\n    # ...\n}\n'})}),"\n",(0,s.jsx)(e.p,{children:(0,s.jsx)(e.a,{href:"https://github.com/nodejs/node-addon-api/blob/master/doc/setup.md",children:"binding.gyp"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-json",metastring:'title="binding.gyp"',children:'{\n    "targets": [\n        {\n            "target_name": "<target>",\n            "include_dirs": ["<!@(node -p \\"require(\'node-addon-api\').include\\")"],\n            "dependencies": ["<!(node -p \\"require(\'node-addon-api\').gyp\\")"],\n            "cflags!": ["-fno-exceptions"],\n            "cflags_cc!": ["-fno-exceptions"],\n            "cflags": [],\n            "cflags_cc": [],\n            "defines": [],\n            "sources": [\n                "c_src/funcs.cpp",\n                "c_src/funcs.h",\n                "c_src/funcs_wrapper.cpp",\n                "c_src/funcs_wrapper.h",\n                "c_src/<target>.cpp",\n            ],\n            "libraries": [\n                # "/usr/lib/libxxx.so"\n            ]\n        }\n    ]\n}\n'})}),"\n",(0,s.jsx)(e.admonition,{type:"danger",children:(0,s.jsxs)(e.p,{children:[(0,s.jsx)(e.code,{children:"target_name"}),"\uc5d0 '-' \ub4f1\uc740 \ub4e4\uc5b4\uac08 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:'title="index.js"',children:'module.exports = require("./build/Release/<target>");\n'})}),"\n",(0,s.jsx)(e.h2,{id:"wrapper",children:"Wrapper"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",metastring:'title="c_src/funcs.h"',children:"#pragma once\n\n#include <string>\n\nstd::string hello(void);\nint         add(int a, int b);\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",metastring:'title="c_src/funcs.cpp"',children:'#include "funcs.h"\n\nstd::string hello(void) { return "Hello World!"; }\n\nint add(int a, int b) { return a + b; }\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",metastring:'title="c_src/funcs_wrapper.h"',children:"#pragma once\n\n#include <napi.h>\n\nNapi::Object init_funcs(Napi::Env env, Napi::Object exports);\n\nNapi::String hello_wrapper(const Napi::CallbackInfo &info);\nNapi::Number add_wrapper(const Napi::CallbackInfo &info);\n"})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",metastring:'title="c_src/funcs_wrapper.cpp"',children:'#include "funcs.h"\n#include "funcs_wrapper.h"\n\nNapi::Object init_funcs(Napi::Env env, Napi::Object exports) {\n    exports.Set("hello", Napi::Function::New(env, hello_wrapper));\n    exports.Set("add", Napi::Function::New(env, add_wrapper));\n\n    return exports;\n}\n\nNapi::String hello_wrapper(const Napi::CallbackInfo &info) {\n    Napi::Env env = info.Env();\n\n    return Napi::String::New(env, hello());\n}\n\nNapi::Number add_wrapper(const Napi::CallbackInfo &info) {\n    Napi::Env env = info.Env();\n\n    if(info.Length() < 2 || ! info[0].IsNumber() || ! info[1].IsNumber()) {\n        Napi::TypeError::New(env,\n                             "Arguments must be (int a, int b) such as (1, 2).")\n            .ThrowAsJavaScriptException();\n    }\n\n    // Implicit type conversion\n    int a = info[0].As<Napi::Number>();\n    int b = info[1].As<Napi::Number>();\n\n    return Napi::Number::New(env, add(a, b));\n}\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-cpp",metastring:'title="c_src/<target>.cpp"',children:'#include "funcs_wrapper.h"\n\n#include <napi.h>\n\nNapi::Object init_all(Napi::Env env, Napi::Object exports) {\n    return init_funcs(env, exports);\n}\n\nNODE_API_MODULE(NODE_GYP_MODULE_NAME, init_all)\n'})}),"\n",(0,s.jsx)(e.h2,{id:"build",children:"Build"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",children:"npm run build\n"})}),"\n",(0,s.jsx)(e.h2,{id:"test",children:"Test"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-js",metastring:'title="test/test.js"',children:'const addon = require("../build/Release/<target>");\n\nconsole.log("wrapper info", addon);\n\nconsole.log(addon.hello());\nconsole.log(addon.add(1, 2));\n'})}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-shell",metastring:"{1}",children:"$ node test/test.js\nwrapper info { hello: [Function], add: [Function] }\nHello World!\n3\n"})}),"\n",(0,s.jsx)(e.h2,{id:"reference",children:"Reference"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nodejs/node-addon-api#api",children:"https://github.com/nodejs/node-addon-api#api"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://docs.npmjs.com/files/package.json",children:"https://docs.npmjs.com/files/package.json"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://github.com/nodejs/node-addon-api/blob/master/doc/setup.md",children:"https://github.com/nodejs/node-addon-api/blob/master/doc/setup.md"})}),"\n",(0,s.jsx)(e.li,{children:(0,s.jsx)(e.a,{href:"https://medium.com/@atulanand94/beginners-guide-to-writing-nodejs-addons-using-c-and-n-api-node-addon-api-9b3b718a9a7f",children:"https://medium.com/@atulanand94/beginners-guide-to-writing-nodejs-addons-using-c-and-n-api-node-addon-api-9b3b718a9a7f"})}),"\n"]})]})}function p(n={}){const{wrapper:e}={...(0,d.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(o,{...n})}):o(n)}}}]);