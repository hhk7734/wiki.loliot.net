"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[67004],{2013:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>l,toc:()=>t});const l=JSON.parse('{"id":"mlops/mlops/kubernetes/tools/kubespray/kubespray","title":"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30","description":"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30","source":"@site/docs/mlops/mlops/kubernetes/tools/kubespray/kubespray.mdx","sourceDirName":"mlops/mlops/kubernetes/tools/kubespray","slug":"/mlops/mlops/kubernetes/tools/kubespray/","permalink":"/docs/mlops/mlops/kubernetes/tools/kubespray/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/kubernetes/tools/kubespray/kubespray.mdx","tags":[],"version":"current","lastUpdatedAt":1732036287000,"frontMatter":{"id":"kubespray","title":"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30","sidebar_label":"Kubespray","description":"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30","keywords":["kubespray","kubeadm","ansible"]},"sidebar":"mlops","previous":{"title":"Kubeadm","permalink":"/docs/mlops/mlops/kubernetes/tools/kubeadm"},"next":{"title":"Control Plane HA","permalink":"/docs/mlops/mlops/kubernetes/tools/kubespray/ha"}}');var r=s(74848),i=s(28453);const o={id:"kubespray",title:"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30",sidebar_label:"Kubespray",description:"Kubespray\ub85c Kubernetes \ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131\ud558\uae30",keywords:["kubespray","kubeadm","ansible"]},a=void 0,c={},t=[{value:"\uc0ac\uc804 \uc791\uc5c5",id:"\uc0ac\uc804-\uc791\uc5c5",level:2},{value:"\ud504\ub85c\uc81d\ud2b8 \uc0dd\uc131",id:"\ud504\ub85c\uc81d\ud2b8-\uc0dd\uc131",level:2},{value:"\ucee8\ud14c\uc774\ub108 \uc0ac\uc6a9\ud558\uae30",id:"\ucee8\ud14c\uc774\ub108-\uc0ac\uc6a9\ud558\uae30",level:3},{value:"git submodule \uc0ac\uc6a9\ud558\uae30",id:"git-submodule-\uc0ac\uc6a9\ud558\uae30",level:3},{value:"\uc778\ubca4\ud1a0\ub9ac \uc791\uc131",id:"\uc778\ubca4\ud1a0\ub9ac-\uc791\uc131",level:2},{value:"\ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131",id:"\ud074\ub7ec\uc2a4\ud130-\uc0dd\uc131",level:2},{value:"\ud074\ub7ec\uc2a4\ud130 \uc0ad\uc81c",id:"\ud074\ub7ec\uc2a4\ud130-\uc0ad\uc81c",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"\uc0ac\uc804-\uc791\uc5c5",children:"\uc0ac\uc804 \uc791\uc5c5"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\ucd5c\uc18c \ud544\uc694 \uc870\uac74","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"2 CPU"}),"\n",(0,r.jsx)(n.li,{children:"2 GB memory"}),"\n",(0,r.jsxs)(n.li,{children:["\ubaa8\ub4e0 \ub178\ub4dc\uc5d0 \ub300\ud55c \uace0\uc720\ud55c \ud638\uc2a4\ud2b8 \uc774\ub984, MAC \uc8fc\uc18c, prodcut_uuid","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"ip link"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"sudo cat /sys/class/dmi/id/product_uuid"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cat /proc/cgroups | column -t"})," \ubaa8\ub450 enabled \uc0c1\ud0dc"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\ud504\ub85c\uc81d\ud2b8-\uc0dd\uc131",children:"\ud504\ub85c\uc81d\ud2b8 \uc0dd\uc131"}),"\n",(0,r.jsx)(n.h3,{id:"\ucee8\ud14c\uc774\ub108-\uc0ac\uc6a9\ud558\uae30",children:"\ucee8\ud14c\uc774\ub108 \uc0ac\uc6a9\ud558\uae30"}),"\n",(0,r.jsx)(n.p,{children:"kubespray\uc758 \uae30\ubcf8 \uae30\ub2a5\ub9cc \uc0ac\uc6a9\ud558\uba74\uc11c \uc778\ubca4\ud1a0\ub9ac\ub9cc \uad00\ub9ac\ud558\uba74 \ub41c\ub2e4\uba74 \ucee8\ud14c\uc774\ub108\ub97c \ud65c\uc6a9\ud558\ub294 \uac83\uc774 \ud3b8\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"podman run --rm -it \\\n  -v <path>:/mycluster \\\n  quay.io/kubespray/kubespray:v2.24.0 \\\n  cp -rfp /kubespray/inventory/sample /mycluster/inventory\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"./\n\u2514\u2500\u2500 inventory/\n    \u251c\u2500\u2500 group_vars/\n    \u2502   \u2514\u2500\u2500 ...\n    \u251c\u2500\u2500 hosts.yaml\n    \u2514\u2500\u2500 patches/\n        \u2514\u2500\u2500 ...\n"})}),"\n",(0,r.jsx)(n.p,{children:"\uc544\ub798 \uba85\ub839\uc5b4\ub85c \ucee8\ud14c\uc774\ub108 \ub0b4\uc5d0\uc11c \uc791\uc5c5\uc744 \ud558\uba74 \ub429\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"podman run --rm -it \\\n  -v $PWD/inventory:/kubespray/inventory \\\n  -e ANSIBLE_STDOUT_CALLBACK=yaml \\\n  quay.io/kubespray/kubespray:v2.24.0 \\\n  bash\n"})}),"\n",(0,r.jsx)(n.h3,{id:"git-submodule-\uc0ac\uc6a9\ud558\uae30",children:"git submodule \uc0ac\uc6a9\ud558\uae30"}),"\n",(0,r.jsx)(n.p,{children:"\ucd94\uac00\uc801\uc778 \ud50c\ub798\uc774\ubd81\uc744 \ub9cc\ub4e4\uc5b4\uc11c \uc0ac\uc6a9\ud574\uc57c\ud558\ub294 \uacbd\uc6b0 git submodule\uc744 \uc0ac\uc6a9\ud558\ub294 \uac83\uc774 \ud3b8\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"git submodule add https://github.com/kubernetes-sigs/kubespray.git upstream \\\n&& pushd upstream \\\n&& git checkout v2.24.0 \\\n&& popd\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cp -rfp upstream/inventory/sample inventory\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"cp upstream/ansible.cfg ansible.cfg \\\n&& sed -i \\\n  -e 's/\\(^stdout_callback = \\).*$/\\1yaml/g' \\\n  -e 's/\\(^library =.*\\)/\\1:upstream\\/library/g' \\\n  -e 's/\\(^roles_path =.*\\)/\\1:upstream\\/roles/g' ansible.cfg\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"for playbook in cluster.yml recover-control-plane.yml remove-node.yml reset.yml scale.yml upgrade-cluster.yml; do\n  cat <<EOF > $playbook\n---\n- name: Import upstream/$playbook\n  ansible.builtin.import_playbook: upstream/$playbook\nEOF\ndone\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"./\n\u251c\u2500\u2500 ansible.cfg\n\u251c\u2500\u2500 cluster.yml\n\u251c\u2500\u2500 inventory/\n\u2502   \u251c\u2500\u2500 group_vars/\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u251c\u2500\u2500 hosts.yaml\n\u2502   \u2514\u2500\u2500 patches/\n\u2502       \u2514\u2500\u2500 ...\n\u251c\u2500\u2500 recover-control-plane.yml\n\u251c\u2500\u2500 remove-node.yml\n\u251c\u2500\u2500 reset.yml\n\u251c\u2500\u2500 scale.yml\n\u251c\u2500\u2500 upgrade-cluster.yml\n\u2514\u2500\u2500 upstream/\n    \u2514\u2500\u2500 ...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\uc778\ubca4\ud1a0\ub9ac-\uc791\uc131",children:"\uc778\ubca4\ud1a0\ub9ac \uc791\uc131"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\uc778\ubca4\ud1a0\ub9ac \uc791\uc131\uc740 ",(0,r.jsx)(n.a,{href:"/docs/mlops/mlops/ansible/inventory",children:"Inventory"}),"\ub97c \ucc38\uace0\ud558\uc2dc\uba74 \ub429\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/hosts.yaml"',children:"all:\n  hosts:\n    <hostname>:\n      ansible_host: <host> # ansible\uc774 \uc811\uadfc \uac00\ub2a5\ud55c \uc8fc\uc18c\n      ip: <ip> # Node IP\n      access_ip: <ip>\n\netcd:\n  hosts:\n    <hostname>:\n\nkube_control_plane:\n  hosts:\n    <hostname>:\n\nkube_node:\n  hosts:\n    <hostname>:\n\nbastion:\n  hosts: {}\n\n# Calico Route Reflector\ncalico_rr:\n  hosts: {}\n\nk8s_cluster:\n  # \uc218\uc815\ud558\uc9c0 \ub9c8\uc138\uc694.\n  children:\n    kube_control_plane:\n    kube_node:\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\ud074\ub7ec\uc2a4\ud130-\uc0dd\uc131",children:"\ud074\ub7ec\uc2a4\ud130 \uc0dd\uc131"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"./\n\u251c\u2500\u2500 inventory/\n\u2502   \u251c\u2500\u2500 group_vars/\n\u2502   \u2502   \u251c\u2500\u2500 all/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 all.yml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u251c\u2500\u2500 k8s_cluster/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 addons.yml\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 k8s-cluster.yml\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u2514\u2500\u2500 etcd.yml\n\u2502   \u251c\u2500\u2500 hosts.yaml\n\u2502   \u2514\u2500\u2500 patches/\n\u2502       \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 ...\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["group_vars/","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["k8s_cluster/","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["k8s-cluster.yml: \ud074\ub7ec\uc2a4\ud130\uc758 \uae30\ubcf8 \uad6c\uc131\uc744 \uc124\uc815\ud569\ub2c8\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kube_owner: root"}),": \uc77c\ubd80 \ud30c\uc77c\uc774\ub098 \ub514\ub809\ud1a0\ub9ac\uc758 \uc18c\uc720\uc790\ub97c \uc124\uc815\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kube_oidc_*"}),": kube-apiserver\uc5d0 OIDC \uad00\ub828 \uc124\uc815\uc744 \ucd94\uac00\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"kube_network_plugin: <cni>"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"calico"}),": \uae30\ubcf8\uac12\uc785\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"cni"}),": \uae30\ubcf8\uc801\uc73c\ub85c \ud544\uc694\ud55c cni \ud50c\ub7ec\uadf8\uc778\ub4e4\ub9cc \uc124\uce58\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"supplementary_addresses_in_ssl_keys: []"}),": api-server \uc778\uc99d\uc11c\uc5d0 \ucd94\uac00\ud560 IP \ub610\ub294 domain \ubaa9\ub85d\uc785\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"addons.yml: metrics-server, metallb \ub4f1 \ud074\ub7ec\uc2a4\ud130\uc5d0 \ucd94\uac00\ud560 \uc560\ub4dc\uc628\uc744 \uc124\uc815\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["HA","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/mlops/mlops/kubernetes/tools/kubespray/ha",children:"kube-apiserver HA"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\ub2e4\uc6b4\ub85c\ub4dc","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/mlops/mlops/kubernetes/tools/kubespray/download",children:"\ubc14\uc774\ub108\ub9ac/\uc774\ubbf8\uc9c0 \ub2e4\uc6b4\ub85c\ub4dc"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\uae30\ud0c0","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"kubelet_fail_swap_on: <bool>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"kubelet_swap_behavior: UnlimitedSwap|LimitedSwap"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'kubelet_feature_gates: ["<key>=<value>"]'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'node_labels: {"<key>": "<value>"}'})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:'node_taints: ["<key>=<value>:<effect>"]'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ansible-playbook -i inventory -b cluster.yml \\\n  -e kubeconfig_localhost=true\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\ud074\ub7ec\uc2a4\ud130-\uc0ad\uc81c",children:"\ud074\ub7ec\uc2a4\ud130 \uc0ad\uc81c"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"ansible-playbook -i inventory -b reset.yml\n"})})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var l=s(96540);const r={},i=l.createContext(r);function o(e){const n=l.useContext(i);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),l.createElement(i.Provider,{value:n},e.children)}}}]);