"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[99991],{93772:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"mlops/mlops/network/istio/traffic-management/gateway","title":"Gateway","description":"Gateway","source":"@site/docs/mlops/mlops/network/istio/traffic-management/gateway.mdx","sourceDirName":"mlops/mlops/network/istio/traffic-management","slug":"/mlops/mlops/network/istio/traffic-management/gateway","permalink":"/docs/mlops/mlops/network/istio/traffic-management/gateway","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/network/istio/traffic-management/gateway.mdx","tags":[],"version":"current","lastUpdatedAt":1734625390000,"frontMatter":{"id":"gateway","title":"Gateway","sidebar_label":"Gateway","description":"Gateway","keywords":["gateway","istio"]},"sidebar":"mlops","previous":{"title":"Upgrade","permalink":"/docs/mlops/mlops/network/istio/upgrade"},"next":{"title":"VirtualService","permalink":"/docs/mlops/mlops/network/istio/traffic-management/virtual-service"}}');var i=t(74848),o=t(28453);const s={id:"gateway",title:"Gateway",sidebar_label:"Gateway",description:"Gateway",keywords:["gateway","istio"]},r=void 0,l={},c=[{value:"Gateway &amp; Envoy",id:"gateway--envoy",level:2},{value:"Gateway",id:"gateway",level:2},{value:"\uc124\uce58",id:"\uc124\uce58",level:3},{value:"Gateway CRD",id:"gateway-crd",level:3},{value:"Gateway\uac04 \uc5f0\uacb0",id:"gateway\uac04-\uc5f0\uacb0",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"gateway--envoy",children:"Gateway & Envoy"}),"\n",(0,i.jsx)(n.p,{children:"Istio\uc5d0\uc11c Gateway\ub294 \ub3c5\ub9bd\uc801\uc73c\ub85c \ubc30\ud3ec\ub41c Envoy\ub85c \ub4e4\uc5b4\uc624\ub294 \ud2b8\ub798\ud53d\uc744 \uad00\ub9ac\ud558\ub294 \ub9ac\uc18c\uc2a4\uc785\ub2c8\ub2e4. \uc77c\ubc18\uc801\uc73c\ub85c IngressGateway EgressGateway\ub77c\uace0 \ubd80\ub974\ub294 Envoy Pod\uc774 \uc788\uace0, \uc774 Pod\uc744 \ubc14\ub77c\ubcf4\ub294 Service\uc758 \ud0c0\uc785\uacfc \ud3ec\ud2b8 \uc124\uc815\uc5d0 \ub530\ub77c \uc2e4\uc7ac \ud2b8\ub798\ud53d\uc774 \ub4e4\uc5b4\uc624\ub294 \uacf3\uc774 \uacb0\uc815\ub429\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Service\uc5d0 \uc124\uc815\ub41c \ud3ec\ud2b8\ub85c \ud2b8\ub798\ud53d\uc774 \ub4e4\uc5b4\uac00\ub354\ub77c\ub3c4 Gateway\uc5d0 \ud574\ub2f9 \ud3ec\ud2b8\uc5d0 \ub300\ud55c \uc124\uc815\uc774 \uc5c6\ub2e4\uba74 \ud2b8\ub798\ud53d\uc774 \ud1b5\uacfc\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."})}),"\n",(0,i.jsx)("center",{children:(0,i.jsx)(n.mermaid,{value:"flowchart LR\n  GS(GatewayService</br>LoadBalancer)\n  G(GatewayEnvoy</br>Gateway)\n  GS --\x3e G\n  G -- VirtualService --\x3e AppService"})}),"\n",(0,i.jsx)(n.h2,{id:"gateway",children:"Gateway"}),"\n",(0,i.jsx)(n.h3,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm show values istio/gateway \\\n    --version 1.20.2 \\\n    > ingress-values.yaml\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress-values.yaml"',children:'revision: 1-20-2\n\nservice:\n  ports:\n    - name: status-port\n      port: 15021\n      targetPort: 15021\n      protocol: TCP\n      nodePort: <nodePort>\n    - name: http2\n      port: 80\n      targetPort: 8080\n      protocol: TCP\n      nodePort: <nodePort>\n    - name: https\n      port: 443\n      targetPort: 8443\n      protocol: TCP\n      nodePort: <nodePort>\n  # https://istio.io/latest/docs/reference/config/labels/\n  # https://istio.io/latest/docs/reference/config/annotations/\n  annotations:\n    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"\n    service.beta.kubernetes.io/aws-load-balancer-proxy-protocol: "*"\n    proxy.istio.io/config: \'{"gatewayTopology" : { "numTrustedProxies": 2 } }\'\n  externalTrafficPolicy: "Local"\n\nresources:\n  requests:\n    cpu: 100m\n    memory: 128Mi\n  limits:\n    cpu: 2000m\n    memory: 1024Mi\n\nautoscaling:\n  enabled: true\n  minReplicas: 2\n  maxReplicas: 5\n  targetCPUUtilizationPercentage: 80\n\nlabels: {}\n\ntolerations: []\n\naffinity:\n  nodeAffinity:\n    requiredDuringSchedulingIgnoredDuringExecution:\n      nodeSelectorTerms:\n        # LoadBalancer\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 AZ\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\n        - matchExpressions:\n            - key: topology.kubernetes.io/zone\n              operator: In\n              values:\n                - ap-northeast-2a\n                - ap-northeast-2c\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - podAffinityTerm:\n          labelSelector:\n            matchExpressions:\n              - key: app\n                operator: In\n                values:\n                  - istio-ingress\n          topologyKey: "kubernetes.io/hostname"\n        weight: 50\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://istio.io/latest/docs/tasks/security/authorization/authz-ingress/#source-ip-address-of-the-original-client",children:"https://istio.io/latest/docs/tasks/security/authorization/authz-ingress/#source-ip-address-of-the-original-client"})})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm template istio-ingress istio/gateway \\\n    --version 1.20.2 \\\n    -n istio-system \\\n    -f ingress-values.yaml \\\n    > ingress.yaml\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm upgrade istio-ingress istio/gateway \\\n    --install \\\n    --history-max 5 \\\n    --version 1.20.2 \\\n    -n istio-system \\\n    -f ingress-values.yaml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"gateway-crd",children:"Gateway CRD"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",children:"https://istio.io/latest/docs/reference/config/networking/gateway/"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: <name>\n  namespace: <namespace>\nspec:\n  selector:\n    # \uc774 \uc124\uc815\uc744 \uc801\uc6a9\ud558\uace0 \uc2f6\uc740 Gateway Pod\uc758 Label\uc744 \uc124\uc815\ud569\ub2c8\ub2e4.\n    # \uae30\ubcf8\uc801\uc73c\ub85c \uc774 \ub9ac\uc18c\uc2a4\uc758 namespace\uc640 \ub2e4\ub978 namespace\uae4c\uc9c0 \uc801\uc6a9\ub429\ub2c8\ub2e4. \uac19\uc740 namespace\uc5d0\ub9cc\n    # \uc801\uc6a9\ud558\uace0 \uc2f6\ub2e4\uba74 istiod\uc758 PILOT_SCOPE_GATEWAY_TO_NAMESPACE\ub97c \uc124\uc815\ud574\ud590\ubc14\ub2c8\ub2e4.\n    <key>: <value>\n  servers:\n    - name: <name> # Optional, \uc124\uc815\ud55c\ub2e4\uba74 servers \ub0b4\uc5d0\uc11c \uace0\uc720\ud574\uc57c\uba70 \ub514\ubc84\uae45 \ub4f1\uc5d0 \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\n      port:\n        name: <name>\n        number: <servicePort> # Service\uc758 port \uc911 \ud558\ub098\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.\n        # HTTP|HTTPS|GRPC|HTTP2|MONGO|TCP|TLS\n        protocol: HTTP\n      # \ud574\ub2f9 port\ub85c \ub4e4\uc5b4\uc624\ub294 \ud2b8\ub798\ud53d \uc911 \ucc98\ub9ac\ud560 host\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.\n      # \uac00\uc7a5 \uc67c\ucabd subdomain \ud30c\ud2b8\uc5d0 wildcard\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n      # namespace\ub97c \uc124\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \uc804\uccb4 \ub124\uc784 \uc2a4\ud398\uc774\uc2a4\uc11c \uc0ac\uc6a9\uac00\ub2a5\ud569\ub2c8\ub2e4.\n      hosts:\n        - <host>\n        - <namespace>/<host>\n      # TLS \uc124\uc815\uc774 \ud544\uc694\ud55c \uacbd\uc6b0 \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud569\ub2c8\ub2e4.\n      # https://istio.io/latest/docs/reference/config/networking/gateway/#ServerTLSSettings\n      tls:\n        # httpsRedirect: true\n        mode: <mode> # PASSTHROUGH|SIMPLE|MUTUAL|AUTO_PASSTHROUGH|ISTIO_MUTUAL\n        credentialName: <secret name> # CA, TLS \uc778\uc99d\uc11c\ub97c \uac00\uc9c0\uace0 \uc788\ub294 Secret\uc758 name\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"TLS"})," \ud504\ub85c\ud1a0\ucf5c\uc744 \uc0ac\uc6a9\ud558\ub294 \uacbd\uc6b0 \uc5f0\uacb0\uc744 \uc885\ub8cc\ud558\uc9c0 \uc54a\uace0 SNI \ud5e4\ub354\ub97c \uae30\ubc18\uc73c\ub85c \ub77c\uc6b0\ud305\ud558\ubbc0\ub85c \uc8fc\uc758\ud574\uc57c\ud569\ub2c8\ub2e4."]})}),"\n",(0,i.jsx)(n.h2,{id:"gateway\uac04-\uc5f0\uacb0",children:"Gateway\uac04 \uc5f0\uacb0"}),"\n",(0,i.jsx)(n.p,{children:"Envoy\ub294 \uc778\uc99d\uc744 \ucc98\ub9ac\ud558\uac70\ub098 \ud2b8\ub798\ud53d \ub0b4\uc6a9\uc744 \ubcc0\uacbd\ud558\ub294 \ub4f1 \ub2e4\uc591\ud55c \uc791\uc5c5\uc744 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4. \ub2e4\uc591\ud55c \ubb38\uc81c \uc0c1\ud669\uc774 \uc874\uc7ac\ud560 \uc218 \uc788\uc9c0\ub9cc \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud558\uace0 BridgeGateway\uc5d0\ub9cc EnvoyFilter\ub97c \uc0ac\uc6a9\ud558\uc5ec \ud2b8\ub798\ud53d\uc744 \uc81c\uc5b4\ud558\ub294 \ubc29\uc2dd\ub3c4 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.mermaid,{value:"flowchart LR\n  IGS(IngressGatewayService</br>LoadBalancer)\n  BGS(BridgeGatewayService</br>ClusterIP)\n  IGS --\x3e IngressGatewayEnvoy\n  IngressGatewayEnvoy -- VirtualService --\x3e BGS\n  BGS --\x3e BridgeGatewayEnvoy\n  IngressGatewayEnvoy -- VirtualService --\x3e App1Service\n  BridgeGatewayEnvoy -- VirtualService --\x3e App2Service\n  BridgeGatewayEnvoy -- VirtualService --\x3e App3Service"})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>r});var a=t(96540);const i={},o=a.createContext(i);function s(e){const n=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:n},e.children)}}}]);