"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[19375],{7227:(e,n,t)=>{t.d(n,{A:()=>l});t(96540);var s=t(34164);const r={tabItem:"tabItem_Ymn6"};var i=t(74848);function l({children:e,hidden:n,className:t}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(r.tabItem,t),hidden:n,children:e})}},28453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>a});var s=t(96540);const r={},i=s.createContext(r);function l(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(i.Provider,{value:n},e.children)}},49489:(e,n,t)=>{t.d(n,{A:()=>w});var s=t(96540),r=t(34164),i=t(18630),l=t(24245),a=t(56347),o=t(36494),c=t(62814),u=t(67548),d=t(69900);function m(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:t}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return m(e).map(({props:{value:e,label:n,attributes:t,default:s}})=>({value:e,label:n,attributes:t,default:s}))}(t);return function(e){const n=(0,u.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,t])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function g({queryString:e=!1,groupId:n}){const t=(0,a.W6)(),r=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(r),(0,s.useCallback)(e=>{if(!r)return;const n=new URLSearchParams(t.location.search);n.set(r,e),t.replace({...t.location,search:n.toString()})},[r,t])]}function f(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,i=h(e),[l,a]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const t=n.find(e=>e.default)??n[0];if(!t)throw new Error("Unexpected error: 0 tabValues");return t.value}({defaultValue:n,tabValues:i})),[c,u]=g({queryString:t,groupId:r}),[m,f]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[t,r]=(0,d.Dv)(n);return[t,(0,s.useCallback)(e=>{n&&r.set(e)},[n,r])]}({groupId:r}),x=(()=>{const e=c??m;return p({value:e,tabValues:i})?e:null})();(0,o.A)(()=>{x&&a(x)},[x]);return{selectedValue:l,selectValue:(0,s.useCallback)(e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);a(e),u(e),f(e)},[u,f,i]),tabValues:i}}var x=t(11062);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=t(74848);function v({className:e,block:n,selectedValue:t,selectValue:s,tabValues:i}){const a=[],{blockElementScrollPositionUntilNextRender:o}=(0,l.a_)(),c=e=>{const n=e.currentTarget,r=a.indexOf(n),l=i[r].value;l!==t&&(o(n),s(l))},u=e=>{let n=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const t=a.indexOf(e.currentTarget)+1;n=a[t]??a[0];break}case"ArrowLeft":{const t=a.indexOf(e.currentTarget)-1;n=a[t]??a[a.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},e),children:i.map(({value:e,label:n,attributes:s})=>(0,b.jsx)("li",{role:"tab",tabIndex:t===e?0:-1,"aria-selected":t===e,ref:e=>{a.push(e)},onKeyDown:u,onClick:c,...s,className:(0,r.A)("tabs__item",y.tabItem,s?.className,{"tabs__item--active":t===e}),children:n??e},e))})}function j({lazy:e,children:n,selectedValue:t}){const i=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=i.find(e=>e.props.value===t);return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:i.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==t}))})}function k(e){const n=f(e);return(0,b.jsxs)("div",{className:(0,r.A)(i.G.tabs.container,"tabs-container",y.tabList),children:[(0,b.jsx)(v,{...n,...e}),(0,b.jsx)(j,{...n,...e})]})}function w(e){const n=(0,x.A)();return(0,b.jsx)(k,{...e,children:m(e.children)},String(n))}},76599:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>u,default:()=>p,frontMatter:()=>c,metadata:()=>s,toc:()=>m});const s=JSON.parse('{"id":"mlops/network/istio/multi-cluster","title":"Multi-cluster","description":"Multi-cluster","source":"@site/docs/mlops/network/istio/multi-cluster.mdx","sourceDirName":"mlops/network/istio","slug":"/mlops/network/istio/multi-cluster","permalink":"/docs/mlops/network/istio/multi-cluster","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/network/istio/multi-cluster.mdx","tags":[],"version":"current","lastUpdatedAt":1761493575000,"frontMatter":{"id":"multi-cluster","title":"Multi-cluster","sidebar_label":"Multi-cluster","description":"Multi-cluster","keywords":["multi-cluster"]},"sidebar":"network","previous":{"title":"Istio CSR","permalink":"/docs/mlops/network/istio/istio-csr"},"next":{"title":"Upgrade","permalink":"/docs/mlops/network/istio/upgrade"}}');var r=t(74848),i=t(28453),l=t(98180),a=t(49489),o=t(7227);const c={id:"multi-cluster",title:"Multi-cluster",sidebar_label:"Multi-cluster",description:"Multi-cluster",keywords:["multi-cluster"]},u=void 0,d={},m=[{value:"Configure Trust",id:"configure-trust",level:2},{value:"Root CA",id:"root-ca",level:3},{value:"Intermediate CA",id:"intermediate-ca",level:3},{value:"Multi-Primary on different networks",id:"multi-primary-on-different-networks",level:2},{value:"Istiod",id:"istiod",level:3},{value:"Cross gateway",id:"cross-gateway",level:3},{value:"Endpoint Discovery",id:"endpoint-discovery",level:3},{value:"Test",id:"test",level:2},{value:"\uc6b4\uc601 \uc2dc \uc8fc\uc758\uc0ac\ud56d",id:"\uc6b4\uc601-\uc2dc-\uc8fc\uc758\uc0ac\ud56d",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"configure-trust",children:"Configure Trust"}),"\n",(0,r.jsxs)(a.A,{defaultValue:"istio-csr",values:[{label:"Istio-CSR",value:"istio-csr"},{label:"\uc9c1\uc811 \uc0dd\uc131",value:"manual"}],children:[(0,r.jsxs)(o.A,{value:"manual",children:[(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://istio.io/latest/docs/tasks/security/cert-management/plugin-ca-cert/",children:"https://istio.io/latest/docs/tasks/security/cert-management/plugin-ca-cert/"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/mlops/mlops/auth/tls/x509",children:"x509"})}),"\n"]}),(0,r.jsx)(n.h3,{id:"root-ca",children:"Root CA"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",metastring:'title="root-ca.conf"',children:"[ req ]\ndefault_md = sha256\ndefault_bits = 3072\nencrypt_key = no\nprompt = no\nutf8 = yes\n\nreq_extensions = req_ext\nx509_extensions = req_ext\n\ndistinguished_name = req_dn\n\n[ req_ext ]\nbasicConstraints = critical, CA:true\nkeyUsage = critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign\n\nsubjectKeyIdentifier = hash\n\n[ req_dn ]\ncommonName = Root CA\norganizationName = lol-iot\n"})}),(0,r.jsx)(n.h3,{id:"intermediate-ca",children:"Intermediate CA"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ini",metastring:'title="ca-cert.conf"',children:"[ req ]\ndefault_md = sha256\ndefault_bits = 3072\nencrypt_key = no\nprompt = no\nutf8 = yes\n\nreq_extensions = req_ext\nx509_extensions = req_ext\n\ndistinguished_name = req_dn\n\n[ req_ext ]\nbasicConstraints = critical, CA:true, pathlen:0\nkeyUsage = critical, digitalSignature, nonRepudiation, keyEncipherment, keyCertSign\n\nsubjectKeyIdentifier = hash\nsubjectAltName=@san\n\n[ san ]\nDNS.1 = <istiodService>.istio-system.svc\n\n[ req_dn ]\ncommonName = Intermediate CA\norganizationName = lol-iot\nlocalityName = <clusterName>\n"})}),(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"<clusterName>"}),"\uc740 ",(0,r.jsx)(n.code,{children:"^(?![0-9]+$)(?!-)[a-zA-Z0-9-]{1,63}(?<!-)$"})," \ud615\uc2dd\uc744 \ub530\ub77c\uc57c \ud569\ub2c8\ub2e4."]})}),(0,r.jsx)(n.p,{children:"\ud074\ub7ec\uc2a4\ud130 \uc218 \ub9cc\ud07c \uc778\uc99d\uc11c\ub97c \uc0dd\uc131\ud574\uc8fc\uc138\uc694."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl create secret generic cacerts -n istio-system \\\n    --from-file=ca-cert.pem \\\n    --from-file=ca-key.pem \\\n    --from-file=cert-chain.pem \\\n    --from-file=../root-cert.pem\n"})})]}),(0,r.jsx)(o.A,{value:"istio-csr",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"/docs/mlops/network/istio/istio-csr",children:"Istio CSR"})}),"\n"]})})]}),"\n",(0,r.jsx)(n.h2,{id:"multi-primary-on-different-networks",children:"Multi-Primary on different networks"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/",children:"https://istio.io/latest/docs/setup/install/multicluster/multi-primary_multi-network/"})}),"\n"]}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("img",{src:(0,l.Ay)("img/mlops/network/istio/multi-primary-diff.svg")})}),"\n",(0,r.jsx)("center",{children:(0,r.jsx)("strong",{children:"Multiple primary clusters on separate networks"})}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.h3,{id:"istiod",children:"Istiod"}),"\n",(0,r.jsx)(n.p,{children:"\uac01 \ud074\ub7ec\uc2a4\ud130 \ubcc4\ub85c \uc544\ub798 \uacfc\uc815\uc744 \ub3d9\uc77c\ud558\uac8c \uc218\ud589\ud574\uc8fc\uc138\uc694."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl config use-context <context>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl label namespace istio-system topology.istio.io/network=<network>\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"meshID"}),"\ub97c \uc81c\uc678\ud55c \ub2e4\ub978 \uac12\ub4e4\uc740 \ud074\ub7ec\uc2a4\ud130\ubcc4\ub85c \ub2e4\ub978 \uac12\uc744 \uc124\uc815\ud574\uc8fc\uc138\uc694."]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="istiod-values.yaml"',children:"meshConfig:\n  enablePrometheusMerge: true\n\nglobal:\n  meshID: <meshID> # \uc774 \uac12\uc740 \uacf5\ud1b5\uc73c\ub85c \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\n\n  # \uc9c1\uc811 \uac01 \ud074\ub7ec\uc2a4\ud130\uc758 cross gateway \uc5d4\ub4dc\ud3ec\uc778\ud2b8\ub97c \uc9c0\uc815\ud574\uc57c\ud560 \ub54c, \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud574\uc8fc\uc138\uc694.\n  # meshNetworks:\n  #   <network>:\n  #     endpoints:\n  #       - fromRegistry: <clusterName>\n  #     gateways:\n  #       - address: <ip|host>\n  #         port: 15443\n  #   <otherNetwork>:\n  #     endpoints:\n  #       - fromRegistry: <clusterName>\n  #     gateways:\n  #       - address: <ip|host>\n  #         port: 15443\n\n  multiCluster:\n    enabled: true\n    clusterName: <clusterName> # clusterID\n  network: <network>\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"helm upgrade -i istiod istio/istiod \\\n    --version 1.20.2 \\\n    -n istio-system \\\n    --history-max 5 \\\n    -f istiod-values.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cross-gateway",children:"Cross gateway"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"helm show values istio/gateway \\\n    --version 1.20.2 \\\n    > ingress-cross-values.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress-cross-values.yaml"',children:'revision: <revision>\n\nservice:\n  ports:\n    - name: status-port\n      port: 15021\n      targetPort: 15021\n      protocol: TCP\n      nodePort: <node-port-1>\n    - name: tls\n      port: 15443\n      targetPort: 15443\n      protocol: TCP\n      nodePort: <node-port-2>\n    - name: tls-istiod\n      port: 15012\n      targetPort: 15012\n      protocol: TCP\n      nodePort: <node-port-3>\n    - name: tls-webhook\n      port: 15017\n      targetPort: 15017\n      protocol: TCP\n      nodePort: <node-port-4>\n  annotations:\n    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"\n\nautoscaling:\n  enabled: true\n  minReplicas: 1\n  maxReplicas: 1\n  targetCPUUtilizationPercentage: 80\n\nlabels:\n  topology.istio.io/network: <network>\n\naffinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - podAffinityTerm:\n          labelSelector:\n            matchExpressions:\n              - key: app\n                operator: In\n                values:\n                  - ingress-cross\n          topologyKey: "kubernetes.io/hostname"\n        weight: 50\n\nnetworkGateway: <network>\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"helm upgrade -i ingress-cross istio/gateway \\\n    --version 1.20.2 \\\n    -n istio-system \\\n    --history-max 5 \\\n    -f ingress-cross-values.yaml\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="ingress-cross-gateway.yaml"',children:'apiVersion: networking.istio.io/v1alpha3\nkind: Gateway\nmetadata:\n  name: cross-gateway\n  namespace: istio-system\nspec:\n  selector:\n    istio: ingress-cross\n  servers:\n    - port:\n        number: 15443\n        name: tls\n        protocol: TLS\n      tls:\n        mode: AUTO_PASSTHROUGH\n      hosts:\n        - "*.local"\n'})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"kubectl apply -f ingress-cross-gateway.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"endpoint-discovery",children:"Endpoint Discovery"}),"\n",(0,r.jsx)(n.p,{children:"\uac01 \ud074\ub7ec\uc2a4\ud130\uac00 api-server\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\ub3c4\ub85d \uc124\uc815\ud574\uc8fc\uc138\uc694."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"istioctl x create-remote-secret \\\n  --context=<A-clusterContext> \\\n  --name=<A-clusterName> | \\\n  kubectl apply -f - --context=<B-clusterContext>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"test",children:"Test"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:'kubectl run tmp-shell --rm -it --image nicolaka/netshoot \\\n  --labels istio.io/rev="1-20-2" \\\n  -- \\\n  /bin/bash\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://istio.io/latest/docs/setup/install/multicluster/verify/",children:"https://istio.io/latest/docs/setup/install/multicluster/verify/"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\uc6b4\uc601-\uc2dc-\uc8fc\uc758\uc0ac\ud56d",children:"\uc6b4\uc601 \uc2dc \uc8fc\uc758\uc0ac\ud56d"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["labels\uc5d0 \uac00\ub2a5\ud55c \uc544\ub798 \uac12\ub4e4\uc744 \ucd94\uac00\ud574\uc11c Service\uac00 \uc5b4\ub290 \ub124\ud2b8\uc6cc\ud06c\uc5d0 \uc18d\ud558\ub294\uc9c0 \uba85\uc2dc\ud574\uc8fc\uc138\uc694","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"topology.istio.io/network=<network>"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"topology.istio.io/cluster=<cluster>"})}),"\n"]}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);