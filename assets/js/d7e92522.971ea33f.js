"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[11153],{28453:(e,n,c)=>{c.d(n,{R:()=>o,x:()=>s});var i=c(96540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}},54890:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"mlops/nn/llm/mooncake","title":"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving","description":"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving","source":"@site/docs/mlops/nn/llm/mooncake.mdx","sourceDirName":"mlops/nn/llm","slug":"/mlops/nn/llm/mooncake","permalink":"/docs/mlops/nn/llm/mooncake","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/nn/llm/mooncake.mdx","tags":[],"version":"current","lastUpdatedAt":1756832216000,"frontMatter":{"id":"mooncake","title":"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving","sidebar_label":"Mooncake (2407)","description":"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving","keywords":["Neural Network","Large Language Model","Mooncake"]},"sidebar":"nn","previous":{"title":"KV Cache","permalink":"/docs/mlops/nn/llm/kvcache"},"next":{"title":"DeepSeek-V3 (2412)","permalink":"/docs/mlops/nn/llm/deepseek-v3"}}');var r=c(74848),l=c(28453),o=c(98180);const s={id:"mooncake",title:"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving",sidebar_label:"Mooncake (2407)",description:"Mooncake (2407) - A KVCache-centric Disaggregated Architecture for LLM Serving",keywords:["Neural Network","Large Language Model","Mooncake"]},t=void 0,a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Overview of Mooncake&#39;s Disaggregated Architecture",id:"overview-of-mooncakes-disaggregated-architecture",level:2},{value:"Sampled Real-wrold Request Trace",id:"sampled-real-wrold-request-trace",level:2}];function h(e){const n={a:"a",admonition:"admonition",h2:"h2",li:"li",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://arxiv.org/abs/2407.00079",children:"Mooncake: A KVCache-centric Disaggregated Architecture for LLM Serving"})}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)("figure",{children:(0,r.jsxs)("center",{children:[(0,r.jsx)("img",{src:(0,o.Ay)("img/mlops/nn/llm/mooncake.png")}),(0,r.jsx)("br",{}),(0,r.jsx)("figcaption",{children:(0,r.jsx)(n.a,{href:"https://arxiv.org/html/2407.00079v3",children:"Figure 1: Mooncake Architecture."})})]})}),"\n",(0,r.jsx)(n.p,{children:"Mooncake\ub294 \ub2e4\uc74c Service Level Objectives (SLOs)\ub97c \uace0\ub824\ud558\uc5ec \ub514\uc790\uc778\ub418\uc5c8\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Time To First Token (TTFT)"}),"\n",(0,r.jsx)(n.li,{children:"Time Between Tokens (TBT)"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\uc774\ub97c \ub9cc\uc871\uc2dc\ud0a4\uae30 \uc704\ud574"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prefill Pool\uc740 KV cache\ub97c \ucd5c\ub300\ud55c \uc7ac\ud65c\uc6a9\ud558\uc5ec \uac01 \uc694\uccad\uc5d0 \ub300\ud55c \ucef4\ud4e8\ud305 \uc2dc\uac04\uc744 \ub2e8\ucd95\ud574\uc57c \ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"Decode Pool\uc740 \uac01 \ubc30\uce58\uc758 \ud1a0\ud070 \uc218\ub97c \ucd5c\ub300\ud55c \ub298\ub824\uc11c Model FLOPs Utilization (MFU)\ub97c \ub192\uc5ec\uc57c \ud569\ub2c8\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"overview-of-mooncakes-disaggregated-architecture",children:"Overview of Mooncake's Disaggregated Architecture"}),"\n",(0,r.jsx)("figure",{children:(0,r.jsxs)("center",{children:[(0,r.jsx)("img",{src:(0,o.Ay)("img/mlops/nn/llm/mooncake-kv-cache-pool.png")}),(0,r.jsx)("br",{}),(0,r.jsx)("figcaption",{children:(0,r.jsx)(n.a,{href:"https://arxiv.org/html/2407.00079v3",children:"Figure 3: The KVCache pool in CPU memory."})})]})}),"\n",(0,r.jsx)("figure",{children:(0,r.jsxs)("center",{children:[(0,r.jsx)("img",{src:(0,o.Ay)("img/mlops/nn/llm/mooncake-kv-cache-transfer.png")}),(0,r.jsx)("br",{}),(0,r.jsx)("figcaption",{children:(0,r.jsx)(n.a,{href:"https://arxiv.org/html/2407.00079v3",children:"Figure 4: Workflow of inference instances."})})]})}),"\n",(0,r.jsx)(n.p,{children:"Mooncake\ub294 GPU HBM, CPU DRAM, RDMA \ub4f1\uc758 \ub9ac\uc18c\uc2a4\ub97c \ud65c\uc6a9\ud558\uc5ec KV cache\ub97c \uad00\ub9ac\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.p,{children:"CPU DRAM\uc758 KV cache pool\uc740"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["cache\ub97c paged block \ud615\ud0dc\ub85c \uc800\uc7a5\ud569\ub2c8\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uac01 block\uc740 512 \uac1c\uc758 \ud1a0\ud070\uc744 \uc800\uc7a5\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\uac01 block\uc740 \uc790\uae30 \uc790\uc2e0\uacfc \uc774\uc804 block\uc5d0 \ub300\ud55c hash \uac12\uc744 \uac00\uc9c0\uace0 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Least Recently Used (LRU), Least Frequently Used (LFU) \ub4f1 \uc694\uccad \ud328\ud134\uc5d0 \ub530\ub77c block\uc744 \ucd95\ucd9c\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"GPU \uc5f0\uc0b0\uacfc KV cache pool \uad00\ub9ac\ub294 \ubcd1\ub82c\ub85c \uc218\ud589\ub429\ub2c8\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\uc694\uccad\uc774 \ub4e4\uc5b4\uc654\uc744 \ub54c \uc791\uc5c5 \uacfc\uc815\uc740 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uc694\uccad\uc744 \ud1a0\ud070\ud654 \ud569\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(n.li,{children:["Conductor\uc5d0\uc11c PD instance\ub97c \uc120\ud0dd\ud558\uc5ec \ub77c\uc6b0\ud305\ud569\ub2c8\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"block ID\ub97c \uacc4\uc0b0\ud558\uc5ec prefix cache hit \uc815\ubcf4\ub97c \uc218\uc9d1\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"prefix cache \uc804\uc1a1\uc2dc\uac04, prefill \uc2dc\uac04, \ud050 \ub300\uae30\uc2dc\uac04 \ub4f1\uc744 \uace0\ub824\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\ubaa8\ub4e0 \uc815\ubcf4\ub97c \uace0\ub824\ud588\uc744 \ub54c SLOs\ub97c \ub9cc\uc871\uc2dc\ud0a4\uae30 \uc5b4\ub835\ub2e4\uace0 \ud310\ub2e8\ud558\uba74 \uc694\uccad\uc744 \uac70\uc808\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Prefill instance\uc5d0\uc11c KV cache\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\ud1a0\ud070\ub4e4\uacfc block ID\ub4e4\uc744 \uc694\uccad\uc73c\ub85c \ubc1b\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"block ID\ub97c \ubc14\ud0d5\uc73c\ub85c prefix cache\ub97c KV cache pool\uc5d0\uc11c GPU HBM\uc73c\ub85c \uc804\uc1a1\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"KV cache\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\ub3d9\uc2dc\uc5d0 KV cache pool\uc5d0 \uc800\uc7a5\ud558\uba74\uc11c, Messenger\uac00 KV cache\ub97c chunk \ub2e8\uc704\ub85c Decode instance\ub85c \uc804\uc1a1\ud569\ub2c8\ub2e4. (chunk size >= 1000)"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Decode instance\uc5d0\uc11c \ud1a0\ud070\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\uc694\uccad\uc744 continuous batching \ubc29\uc2dd\uc73c\ub85c \ub2e4\uc74c \ubc30\uce58\uc5d0 \ucd94\uac00\ud569\ub2c8\ub2e4. \uc774 \ub584, \ub85c\uceec \uc2a4\ucf00\uc904\ub7ec\uac00 TBT SLO\ub97c \ub9cc\uc871\ud560\uc9c0 \ud55c \ubc88 \ub354 \ud655\uc778\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\ud1a0\ud070\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"sampled-real-wrold-request-trace",children:"Sampled Real-wrold Request Trace"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Input Sequence Length (ISL)\uc758 \ud3c9\uade0\uc740 7590 \uc774\uc600\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"Output Sequence Length (OSL)\uc758 \ud3c9\uade0\uc740 182 \uc600\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"KV cache \uc6a9\ub7c9\uc744 1000 blocks\uc5d0\uc11c 50000 blocks\ub85c \uc62c\ub838\uc744 \ub54c cache hit ratio\ub294 30%\uc5d0\uc11c 50%\ub85c \uc99d\uac00\ud588\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\uadf8 \uc774\uc0c1 \uc6a9\ub7c9\uc744 \ub298\ub9ac\ub294 \uacbd\uc6b0 \uc601\ud5a5\uc740 \ubbf8\ubbf8\ud588\uc9c0\ub9cc \uc0d8\ud50c\ub9c1 \ub41c \uacb0\uacfc\uc774\ubbc0\ub85c \uc6a9\ub7c9\uc740 \ud06c\uba74 \ud074 \uc218\ub85d cache hit ratio\uac00 \uc99d\uac00\ud560 \uac00\ub2a5\uc131\uc774 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,r.jsx)(n.li,{children:"\ud2b9\uc815 block\ub4e4\uc740 \uc218\ub9cc \ubc88 \uc7ac\uc0ac\uc6a9\ub418\ub294 \ubc18\uba74, 50%\uc758 block\uc774 \uac70\uc758 \uc7ac\uc0ac\uc6a9\ub418\uc9c0 \uc54a\uc558\uc2b5\ub2c8\ub2e4."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}}}]);