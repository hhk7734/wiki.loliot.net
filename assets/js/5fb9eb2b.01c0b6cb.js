"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[70076],{19107:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"mlops/provisioning/keda/external-scaler","title":"KEDA External Scaler","description":"KEDA External Scaler","source":"@site/docs/mlops/provisioning/keda/external-scaler.mdx","sourceDirName":"mlops/provisioning/keda","slug":"/mlops/provisioning/keda/external-scaler","permalink":"/docs/mlops/provisioning/keda/external-scaler","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/provisioning/keda/external-scaler.mdx","tags":[],"version":"current","lastUpdatedAt":1758455782000,"frontMatter":{"id":"external-scaler","title":"KEDA External Scaler","sidebar_label":"External Scaler","description":"KEDA External Scaler","keywords":["keda","event","external","trigger"]},"sidebar":"provisioning","previous":{"title":"CRD \uc548\ub0b4","permalink":"/docs/mlops/provisioning/keda/crd"},"next":{"title":"Knative","permalink":"/docs/mlops/provisioning/knative/"}}');var a=n(74848),l=n(28453);const c={id:"external-scaler",title:"KEDA External Scaler",sidebar_label:"External Scaler",description:"KEDA External Scaler",keywords:["keda","event","external","trigger"]},s=void 0,i={},o=[{value:"triggers in CRD",id:"triggers-in-crd",level:2},{value:"external",id:"external",level:3},{value:"Scaler \uc11c\ube44\uc2a4 \uad6c\ud604",id:"scaler-\uc11c\ube44\uc2a4-\uad6c\ud604",level:2}];function p(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"triggers-in-crd",children:"triggers in CRD"}),"\n",(0,a.jsx)(t.h3,{id:"external",children:"external"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",children:"spec:\n  triggers:\n    - type: external\n      metadata:\n        scalerAddress: <host>:<port>\n        # \uc124\uc815\uc744 \uc704\ud574 \uc0ac\uc6a9\uc790 \uc815\uc758 \ub370\uc774\ud130\ub97c \uc804\ub2ec\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4\n        # <customKey>: <value>\n"})}),"\n",(0,a.jsx)(t.h2,{id:"scaler-\uc11c\ube44\uc2a4-\uad6c\ud604",children:"Scaler \uc11c\ube44\uc2a4 \uad6c\ud604"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"https://keda.sh/docs/2.10/concepts/external-scalers/",children:"https://keda.sh/docs/2.10/concepts/external-scalers/"})}),"\n",(0,a.jsx)(t.li,{children:(0,a.jsx)(t.a,{href:"/docs/lang/go/libraries/grpc/",children:"gRPC"})}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"\uad6c\ud604 \ub0b4\uc6a9\uc740 \uc544\ub798\uc640 \uac19\uc740 \ub514\ub809\ud1a0\ub9ac \uad6c\uc870\uac00 \ub098\uc624\ub3c4\ub85d \uc9c4\ud589\ub429\ub2c8\ub2e4."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"<externalscaler>\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 scaler/\n\u2502       \u2514\u2500\u2500 main.go\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 application/\n\u2502   \u2502   \u2514\u2500\u2500 externalscaler.go\n\u2502   \u2514\u2500\u2500 pkg/\n\u2502       \u2514\u2500\u2500 externalscaler/\n\u2502           \u251c\u2500\u2500 externalscaler.pb.go\n\u2502           \u251c\u2500\u2500 externalscaler.proto\n\u2502           \u2514\u2500\u2500 externalscaler_grpc.pb.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"curl https://raw.githubusercontent.com/kedacore/keda/main/pkg/scalers/externalscaler/externalscaler.proto \\\n    --create-dirs \\\n    -o internal/pkg/externalscaler/externalscaler.proto\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-shell",children:"protoc \\\n    --go_out=. \\\n    --go_opt=paths=source_relative \\\n    --go-grpc_out=. \\\n    --go-grpc_opt=paths=source_relative \\\n    internal/pkg/externalscaler/externalscaler.proto\n"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="internal/application/externalscaler.go"',children:'package application\n\nimport (\n\t"context"\n\n\tpb "github.com/hhk7734/externalscaler-test/internal/pkg/externalscaler"\n\t"google.golang.org/grpc/codes"\n\t"google.golang.org/grpc/status"\n)\n\ntype ExternalScaler struct {\n\tpb.UnimplementedExternalScalerServer\n}\n\n// IsActive\ub294 \ub300\uc0c1\uc774 \ud65c\uc131\ud654\ub418\uc5b4\uc57c \ud558\ub294\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. false\ub97c \ubc18\ud658\ud558\uba74 \ub300\uc0c1\uc758 replicas\ub97c 0\uc73c\ub85c\n// \uc124\uc815\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) IsActive(ctx context.Context, scaledObject *pb.ScaledObjectRef) (*pb.IsActiveResponse, error) {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\treturn &pb.IsActiveResponse{Result: true}, nil\n}\n\n// GetMetricSpec\uc740 \ub300\uc0c1\uc774 \uc2a4\uce90\uc77c\ub9c1\ub418\uae30 \uc704\ud55c \uba54\ud2b8\ub9ad\uc758 \uae30\uc900\uac12\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) GetMetricSpec(ctx context.Context, scaledObject *pb.ScaledObjectRef) (*pb.GetMetricSpecResponse, error) {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\treturn &pb.GetMetricSpecResponse{\n\t\tMetricSpecs: []*pb.MetricSpec{\n\t\t\t{\n\t\t\t\tMetricName: "custom-metric",\n\t\t\t\tTargetSize: 10,\n\t\t\t},\n\t\t},\n\t}, nil\n}\n\n// GetMetrics\uc740 \uba54\ud2b8\ub9ad \uac12\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) GetMetrics(ctx context.Context, request *pb.GetMetricsRequest) (*pb.GetMetricsResponse, error) {\n\t// value := request.ScaledObjectRef.ScalerMetadata["<customKey>"]\n\n\treturn &pb.GetMetricsResponse{\n\t\tMetricValues: []*pb.MetricValue{\n\t\t\t{\n\t\t\t\tMetricName:  "custom-metric",\n\t\t\t\tMetricValue: 1,\n\t\t\t},\n\t\t},\n\t}, nil\n}\n\n// StreamIsActive\uc740 spec.triggers.type: external-push\uc778 \uacbd\uc6b0\uc5d0\ub9cc \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\nfunc (e *ExternalScaler) StreamIsActive(scaledObject *pb.ScaledObjectRef, stream pb.ExternalScaler_StreamIsActiveServer) error {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\t// for {\n\t// \tselect {\n\t// \tcase <-stream.Context().Done():\n\t// \t\treturn nil\n\t// \tcase <-time.Tick(30 * time.Second):\n\t// \t\tif err := stream.Send(&pb.IsActiveResponse{Result: true}); err != nil {\n\t// \t\t\treturn err\n\t// \t\t}\n\t// \t}\n\t// }\n\n\treturn status.Error(codes.Unavailable, "external-push is not supported")\n}\n'})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",metastring:'title="cmd/scaler/main.go"',children:'package main\n\nimport (\n\t"net"\n\n\t"github.com/hhk7734/externalscaler-test/internal/application"\n\tpb "github.com/hhk7734/externalscaler-test/internal/pkg/externalscaler"\n\t"google.golang.org/grpc"\n)\n\nfunc main() {\n\tgrpcServer := grpc.NewServer()\n\tlis, _ := net.Listen("tcp", ":6000")\n\tpb.RegisterExternalScalerServer(grpcServer, &application.ExternalScaler{})\n\n\tif err := grpcServer.Serve(lis); err != nil {\n\t}\n}\n'})})]})}function d(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(p,{...e})}):p(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>s});var r=n(96540);const a={},l=r.createContext(a);function c(e){const t=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(l.Provider,{value:t},e.children)}}}]);