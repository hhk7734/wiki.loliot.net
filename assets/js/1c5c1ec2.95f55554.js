"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[91302],{28453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>s});var r=o(96540);const l={},i=r.createContext(l);function a(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),r.createElement(i.Provider,{value:n},e.children)}},47343:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>t,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"mlops/mlops/auth/oauth2-proxy","title":"oauth2-proxy","description":"oauth2-proxy","source":"@site/docs/mlops/mlops/auth/oauth2-proxy.mdx","sourceDirName":"mlops/mlops/auth","slug":"/mlops/mlops/auth/oauth2-proxy","permalink":"/docs/mlops/mlops/auth/oauth2-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/auth/oauth2-proxy.mdx","tags":[],"version":"current","lastUpdatedAt":1745336627000,"frontMatter":{"id":"oauth2-proxy","title":"oauth2-proxy","sidebar_label":"oauth2-proxy","description":"oauth2-proxy","keywords":["oauth2-proxy"]},"sidebar":"mlops","previous":{"title":"Dex","permalink":"/docs/mlops/mlops/auth/dex/"},"next":{"title":"Argo CD","permalink":"/docs/mlops/mlops/workflow/argo-cd/"}}');var l=o(74848),i=o(28453);const a={id:"oauth2-proxy",title:"oauth2-proxy",sidebar_label:"oauth2-proxy",description:"oauth2-proxy",keywords:["oauth2-proxy"]},s=void 0,t={},c=[{value:"\uc778\uc99d \ubc29\uc2dd",id:"\uc778\uc99d-\ubc29\uc2dd",level:2},{value:"OAuth2 + Reverse Proxy",id:"oauth2--reverse-proxy",level:3},{value:"OAuth2",id:"oauth2",level:3},{value:"\uc124\uc815",id:"\uc124\uc815",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Keycloak OIDC",id:"keycloak-oidc",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\uc778\uc99d-\ubc29\uc2dd",children:"\uc778\uc99d \ubc29\uc2dd"}),"\n",(0,l.jsx)(n.h3,{id:"oauth2--reverse-proxy",children:"OAuth2 + Reverse Proxy"}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(n.mermaid,{value:"flowchart LR\n  Client\n  Oauth2Proxy(oauth2-proxy)\n  OIDCProvider\n  Upstream\n\n  style Oauth2Proxy fill:#4B7,color:#fff\n\n  Client <--\x3e Oauth2Proxy\n  Oauth2Proxy <--\x3e OIDCProvider\n  Oauth2Proxy <--\x3e Upstream"})}),"\n",(0,l.jsx)("center",{children:"OAuth2Proxy\uac00 \uc778\uc99d \uc5ed\ud560\uacfc \ub9ac\ubc84\uc2a4 \ud504\ub85d\uc2dc \uc5ed\ud560 \ubaa8\ub450 \uc218\ud589"}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"--upstream=<upstream-url>[,<upstream-url>...]"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\ub9ac\ubc84\uc2a4 \ud504\ub85d\uc2dc\uc5d0\uc11c \uc0ac\uc6a9\ud560 upstream \uc11c\ubc84\ub97c \uc124\uc815\ud569\ub2c8\ub2e4"}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/path"}),"\uac00 \ub9e4\ud551\ub429\ub2c8\ub2e4"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"oauth2",children:"OAuth2"}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(n.mermaid,{value:"flowchart LR\n  Client\n  Gateway\n  Oauth2Proxy(oauth2-proxy)\n  OIDCProvider\n  Upstream\n\n  style Oauth2Proxy fill:#4B7,color:#fff\n\n  Client <--\x3e Gateway\n  Gateway -- request --\x3e Oauth2Proxy\n  Oauth2Proxy <--\x3e OIDCProvider\n  Oauth2Proxy -- response --\x3e Gateway\n  Gateway <--\x3e Upstream"})}),"\n",(0,l.jsx)("center",{children:"OAuth2Proxy\uac00 \uc778\uc99d \uc5ed\ud560\ub9cc \uc218\ud589"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"--upstream=static://202"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["upstream \uc11c\ubc84\ub97c \uc124\uc815\ud558\uc9c0 \uc54a\uace0 \uc778\uc99d\uc774 \uc131\uacf5\ud55c \uacbd\uc6b0 ",(0,l.jsx)(n.code,{children:"202"}),", \uc2e4\ud328\ud55c \uacbd\uc6b0 ",(0,l.jsx)(n.code,{children:"401"})," \uc751\ub2f5\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\uc124\uc815",children:"\uc124\uc815"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview#command-line-options",children:"https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/overview#command-line-options"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\uc635\uc158\uc744 \uc804\ub2ec\ud558\ub294 \ubc29\uc2dd\uc740 3\uac00\uc9c0\uac00 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"args"}),"\uc73c\ub85c \uc635\uc158\uc744 \uc804\ub2ec"]}),"\n",(0,l.jsxs)(n.li,{children:["\ud30c\uc77c","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--config=<config-path>"})}),"\n",(0,l.jsxs)(n.li,{children:["\uc635\uc158\uc758 ",(0,l.jsx)(n.code,{children:"-"}),"\ub97c ",(0,l.jsx)(n.code,{children:"_"}),"\ub85c \ubcc0\uacbd"]}),"\n",(0,l.jsxs)(n.li,{children:["\uc5ec\ub7ec\ubc88 \uc0ac\uc6a9\ud560 \uc218 \uc788\ub294 \uc635\uc158\uc758 \uacbd\uc6b0 \ub9c8\uc9c0\ub9c9\uc5d0 s\ub97c \ubd99\uc774\uace0 ",(0,l.jsx)(n.code,{children:"[]"})," \ub9ac\uc2a4\ud2b8\ub85c \ubcc0\uacbd"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"env"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\uc635\uc158\uc758 \uc18c\ubb38\uc790\ub97c \ub300\ubb38\uc790\ub85c, ",(0,l.jsx)(n.code,{children:"-"}),"\ub97c ",(0,l.jsx)(n.code,{children:"_"}),"\ub85c \ubcc0\uacbd"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OAUTH2_PROXY_"}),"\uc744 \uc55e\uc5d0 \ubd99\uc784"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["alpha config","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--alpha-config=<config-path>"})}),"\n",(0,l.jsx)(n.li,{children:"alpha \ud14c\uc2a4\ud2b8 \uc911\uc778 \uc124\uc815 \ubc29\ubc95\uc73c\ub85c yaml \ud30c\uc77c\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsx)(n.li,{children:"alpha config\ub97c \uc0ac\uc6a9\ud558\uba74 \uc704\uc758 3 \uac00\uc9c0 \ubc29\ubc95\uc911 \ud638\ud658\ub418\uc9c0 \uc54a\ub294 \uc635\uc158\ub4e4\uc774 \uc0dd\uae41\ub2c8\ub2e4."}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/alpha-config",children:"https://oauth2-proxy.github.io/oauth2-proxy/docs/configuration/alpha-config"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: <name>\n  namespace: <namespace>\ndata:\n  oauth2-proxy.yaml: |-\n    upstreamConfig:\n      upstreams:\n        - id: <id>\n          path: /\n          uri: http://<upstreamName>.<upstreamNamespace>.svc\n    injectRequestHeaders:\n      - name: x-forwarded-email\n        values:\n          - claim: email\n    injectResponseHeaders:\n      - name: x-forwarded-email\n        values:\n          - claim: email\n    providers: []\n    server:\n      BindAddress: 0.0.0.0:4180\n      SecureBindAddress: ""\n    metricsServer:\n      BindAddress: 0.0.0.0:44180\n      SecureBindAddress: ""\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nmetadata:\n  name: <name>\n  namespace: <namespace>\nspec:\n  type: ClusterIP\n  selector:\n    <key>: <value>\n  ports:\n    - name: http\n      port: 4180\n      targetPort: http\n      protocol: TCP\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: <name>\n  namespace: <namespace>\nspec:\n  selector:\n    matchLabels:\n      <key>: <value>\n  template:\n    metadata:\n      labels:\n        <key>: <value>\n    spec:\n      containers:\n        - name: oauth2-proxy\n          image: quay.io/oauth2-proxy/oauth2-proxy:v7.4.0\n          args:\n            - --alpha-config=/opt/oauth2-proxy/oauth2-proxy.yaml\n          env: []\n          ports:\n            - name: http\n              containerPort: 4180\n              protocol: TCP\n            - name: metrics\n              containerPort: 44180\n              protocol: TCP\n          volumeMounts:\n            - name: <volumeName>\n              mountPath: /opt/oauth2-proxy\n              readOnly: true\n          readinessProbe:\n            periodSeconds: 10\n            httpGet:\n              path: /ping\n              port: 4180\n      volumes:\n        - name: <name>\n          configMap:\n            name: <configMapName>\n            defaultMode: 0644\n"})}),"\n",(0,l.jsx)(n.h2,{id:"keycloak-oidc",children:"Keycloak OIDC"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/mlops/mlops/auth/keycloak/openid-connect",children:"Keycloak OIDC"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://oauth2-proxy.github.io/oauth2-proxy/configuration/providers/keycloak_oidc",children:"OAuth2 Proxy Keycloak OIDC"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/mlops/mlops/auth/oidc#authorization-code-flow",children:"OIDC Authorization Code Flow"})}),"\n"]}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--redirect-url=<clientURL>/oauth2/callback"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--oidc-issuer-url=<keycloakURL>/realms/<realm>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--allowed-group=<group>"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--email-domain=*"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--cookie-secret=<cookieSecret>"})}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-hcl",children:'resource "random_password" "cookie_secret" {\n  length           = 32\n  override_special = "-_"\n}\n'})})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="oauth2-proxy.yaml"',children:"providers:\n  - id: keycloak-oidc\n    provider: keycloak-oidc\n    clientID: <clientID>\n    clientSecret: <clientSecret>\n    scope: openid profile email groups\n    allowedGroups:\n      - <group>\n    code_challenge_method: S256\n    oidcConfig:\n      issuerURL: <keycloakURL>/realms/<realm>\n      # discovery\ub97c \uc0ac\uc6a9\ud558\uba74 <issuerURL>/.well-known/openid-configuration \uc5d0\uc11c\n      # loginURL, redeemURL, profileURL, jwksURL, supportedCodeChallengeMethods\ub97c \uac00\uc838\uc635\ub2c8\ub2e4\n      # skipDiscovery: false\n      emailClaim: email\n      groupsClaim: groups\n      audienceClaims:\n        - aud\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"allowedGroups"}),"\ub85c ",(0,l.jsx)(n.code,{children:"role:<role>"}),"\uc744 \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);