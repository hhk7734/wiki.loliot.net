"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[82814],{28453:(n,e,r)=>{r.d(e,{R:()=>t,x:()=>i});var o=r(96540);const l={},c=o.createContext(l);function t(n){const e=o.useContext(c);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function i(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:t(n.components),o.createElement(c.Provider,{value:e},n.children)}},78655:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"mlops/serving/vllm/kvconnector","title":"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc","description":"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc","source":"@site/docs/mlops/serving/vllm/kvconnector.mdx","sourceDirName":"mlops/serving/vllm","slug":"/mlops/serving/vllm/kvconnector","permalink":"/docs/mlops/serving/vllm/kvconnector","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/serving/vllm/kvconnector.mdx","tags":[],"version":"current","lastUpdatedAt":1757698945000,"frontMatter":{"id":"kvconnector","title":"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc","sidebar_label":"KVConnector","description":"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc","keywords":["vLLM","KVConnector"]},"sidebar":"serving","previous":{"title":"Plugins","permalink":"/docs/mlops/serving/llm-d/plugins"},"next":{"title":"KVEvent","permalink":"/docs/mlops/serving/vllm/kvevent"}}');var l=r(74848),c=r(28453);const t={id:"kvconnector",title:"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc",sidebar_label:"KVConnector",description:"vLLM KVConnector \uc124\uc815 \uac00\uc774\ub4dc",keywords:["vLLM","KVConnector"]},i=void 0,s={},d=[{value:"vLLM \uc124\uc815",id:"vllm-\uc124\uc815",level:2},{value:"KVConnectorBase_V1",id:"kvconnectorbase_v1",level:2},{value:"Worker",id:"worker",level:3}];function a(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.h2,{id:"vllm-\uc124\uc815",children:"vLLM \uc124\uc815"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-shell",children:'vllm serve \\\n  ... \\\n  --kv-transfer-config \'{"<option>": "<value>", ...}\'\n'})}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"<option>"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"kv_connector: <KVConnectorBaseV1Impl>"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"KVConnector \uad6c\ud604\uccb4\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:["e.g. ",(0,l.jsx)(e.code,{children:"NixlConnector"}),", ",(0,l.jsx)(e.code,{children:"MultiConnector"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"kv_role: <role>"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"kv_producer"}),", ",(0,l.jsx)(e.code,{children:"kv_consumer"}),", ",(0,l.jsx)(e.code,{children:"kv_both"})," \uc911 \ud558\ub098\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"kv_connector_module_path: <module>"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"vllm\uc5d0 \ud3ec\ud568\ub418\uc9c0 \uc54a\uc740 KVConnector \uad6c\ud604\uccb4\ub97c \uc0ac\uc6a9\ud560 \uacbd\uc6b0, \ud574\ub2f9 \ubaa8\ub4c8\uc758 \uacbd\ub85c\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:["e.g. ",(0,l.jsx)(e.code,{children:"lmcache.integration.vllm.lmcache_connector_v1"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"kvconnectorbase_v1",children:"KVConnectorBase_V1"}),"\n",(0,l.jsx)(e.admonition,{title:"Reference",type:"info",children:(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.a,{href:"https://github.com/vllm-project/vllm/pull/15960",children:"vLLM GitHub / PR #15960"})}),"\n"]})}),"\n",(0,l.jsx)(e.p,{children:"\ud558\ub098\uc758 vLLM\uc740 \uc544\ub798\uc640 \uac19\uc774 \uad6c\uc131\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,l.jsx)(e.mermaid,{value:"flowchart\n  subgraph Scheduler[Scheduler process]\n    KVConnectorS[KVConnector<br/>in Scheduler]\n  end\n\n  subgraph Worker1[Worker process]\n    KVConnectorW1[KVConnector<br/>in Worker]\n  end\n\n  subgraph Worker2[Worker process]\n    KVConnectorW2[KVConnector<br/>in Worker]\n  end\n\n  Scheduler --\x3e Worker1\n  Scheduler --\x3e Worker2"}),"\n",(0,l.jsx)(e.h3,{id:"worker",children:"Worker"}),"\n",(0,l.jsx)(e.mermaid,{value:"sequenceDiagram\n  participant ModelRunner\n  participant Attention\n  participant KVConnector\n\n  ModelRunner ->> ModelRunner: set_forward_context()\n  activate ModelRunner\n\n  ModelRunner ->> KVConnector: bind_connector_metadata()\n  activate ModelRunner\n\n  opt is decode\n    ModelRunner ->> KVConnector: start_load_kv()\n    activate KVConnector\n    KVConnector --\x3e> ModelRunner: KVConnectorOutput\n  end\n\n  ModelRunner ->> Attention: forward()\n  activate Attention\n  loop for each layer\n    opt is decode\n        Attention ->> KVConnector: wait_for_layer_load()\n        deactivate KVConnector\n    end\n    Attention ->> Attention: forward()\n    opt is prefill\n        Attention ->> KVConnector: save_kv_layer()\n        activate KVConnector\n    end\n  end\n  deactivate Attention\n\n  opt is prefill\n    ModelRunner ->> KVConnector: wait_for_save()\n    deactivate KVConnector\n  end\n\n  ModelRunner ->> KVConnector: get_finished()\n\n  ModelRunner ->> KVConnector: clear_connector_metadata()\n  deactivate ModelRunner\n\n  ModelRunner --\x3e> ModelRunner: end set_forward_context()\n  deactivate ModelRunner"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"start_load_kv()"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\ubd88\ub7ec\uc62c KVCache\uac00 \uc788\ub294 \uacbd\uc6b0 KVCache\ub97c \ubd88\ub7ec\uc624\uae30 \uc2dc\uc791\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:["\ub450 \uac00\uc9c0 \uad6c\ud604\ubc29\uc2dd\uc774 \uc788\uc2b5\ub2c8\ub2e4.","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\ud55c \ubc88\uc5d0 \ubaa8\ub4e0 layer\uc758 KVCache\ub97c \ubd88\ub7ec\uc624\uae30"}),"\n",(0,l.jsxs)(e.li,{children:["\ube44\ub3d9\uae30\uc801\uc73c\ub85c \ubd88\ub7ec\uc624\uba74\uc11c ",(0,l.jsx)(e.code,{children:"wait_for_layer_load()"}),"\ub97c \ud1b5\ud574 \uac01 layer\uac00 \uc2e4\ud589\ub418\uae30 \uc804\uc5d0 \uc644\ub8cc\ub420 \ub54c\uae4c\uc9c0 \ub300\uae30"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"wait_for_layer_load()"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\ud574\ub2f9 layer\uc758 KVCache\uac00 \ubd88\ub7ec\uc640\uc84c\ub294\uc9c0 \ud655\uc778\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"start_load_kv()"}),"\uc5d0\uc11c \ubaa8\ub4e0 layer\uc758 KVCache\ub97c \ubd88\ub7ec\uc624\ub294 \uad6c\ud604\uc778 \uacbd\uc6b0, \uad6c\ud604\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub429\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"save_kv_layer()"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\ud574\ub2f9 layer\uc758 KVCache\ub97c \uc800\uc7a5\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:["\uc624\ud504\ub85c\ub529\ud558\uc9c0 \uc54a\uac70\ub098 ",(0,l.jsx)(e.code,{children:"wait_for_save()"}),"\uc5d0\uc11c \ud55c \ubc88\uc5d0 \ubaa8\ub4e0 layer\ub97c \uc800\uc7a5\ud558\ub294 \uad6c\ud604\uc778 \uacbd\uc6b0, \uad6c\ud604\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub429\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"wait_for_save()"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\ubaa8\ub4e0 layer\uc758 KVCache\uac00 \uc800\uc7a5\ub420 \ub54c\uae4c\uc9c0 \ub300\uae30\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsx)(e.li,{children:"\uc624\ud504\ub85c\ub529\ud558\uc9c0 \uc54a\ub294 \uacbd\uc6b0, \uad6c\ud604\ud558\uc9c0 \uc54a\uc544\ub3c4 \ub429\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(e.li,{children:["\uad6c\ud604\ud558\ub294 \uacbd\uc6b0 \ub450 \uac00\uc9c0 \uad6c\ud604\ubc29\uc2dd\uc774 \uc788\uc2b5\ub2c8\ub2e4.","\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.code,{children:"save_kv_layer()"})," \ud638\ucd9c \uc2dc \ube44\ub3d9\uae30\uc801\uc73c\ub85c \uc800\uc7a5\ud558\uae30 \uc2dc\uc791\ud558\uace0 \ubaa8\ub4e0 layer\uac00 \uc800\uc7a5\ub420 \ub54c\uae4c\uc9c0 \ub300\uae30"]}),"\n",(0,l.jsx)(e.li,{children:"\ud55c \ubc88\uc5d0 \ubaa8\ub4e0 layer\uc758 KVCache\ub97c \uc800\uc7a5\ud558\uae30"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(a,{...n})}):a(n)}}}]);