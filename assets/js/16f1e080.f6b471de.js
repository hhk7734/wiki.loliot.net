"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[81346],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>a});var i=t(96540);const o={},r=i.createContext(o);function s(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(r.Provider,{value:n},e.children)}},44963:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>k,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"mlops/kubernetes/network/konnectivity","title":"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30","description":"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30","source":"@site/docs/mlops/kubernetes/network/konnectivity.mdx","sourceDirName":"mlops/kubernetes/network","slug":"/mlops/kubernetes/network/konnectivity","permalink":"/docs/mlops/kubernetes/network/konnectivity","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/kubernetes/network/konnectivity.mdx","tags":[],"version":"current","lastUpdatedAt":1750341424000,"frontMatter":{"id":"konnectivity","title":"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30","sidebar_label":"Konnectivity","description":"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30","keywords":["kubernetes","service","konnectivity"]},"sidebar":"kubernetes","previous":{"title":"Service","permalink":"/docs/mlops/kubernetes/network/service"},"next":{"title":"volumes","permalink":"/docs/mlops/kubernetes/storage/volumes"}}');var o=t(74848),r=t(28453);const s={id:"konnectivity",title:"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30",sidebar_label:"Konnectivity",description:"Konnectivity\ub97c \ud1b5\ud574 Node\uc5d0 \uc811\uadfc\ud558\uae30",keywords:["kubernetes","service","konnectivity"]},a=void 0,c={},l=[{value:"Konnectivity",id:"konnectivity",level:2},{value:"\uc124\uc815",id:"\uc124\uc815",level:2},{value:"Konnectivity server",id:"konnectivity-server",level:3},{value:"Konnectivity agent",id:"konnectivity-agent",level:3}];function v(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"konnectivity",children:"Konnectivity"}),"\n",(0,o.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/apiserver-network-proxy",children:"apiserver-network-proxy GitHub"})}),"\n"]})}),"\n",(0,o.jsx)("center",{children:(0,o.jsx)(n.mermaid,{value:'flowchart TD\n  subgraph Subnet 1\n\n    subgraph Control Plane\n      konnectivity-server[Konnectivity Server]\n      konnectivity-server-soket@{ shape: das, label: "UDS" }\n\n      kube-apiserver --\x3e konnectivity-server-soket\n      konnectivity-server-soket --\x3e konnectivity-server\n    end\n\n  end\n\n  subgraph Subnet 2\n\n    subgraph Node 1\n      konnectivity-agent-1[Konnectivity Agent]\n      kubelet-1[kubelet]\n\n      konnectivity-agent-1 -. create tunnel .-> konnectivity-server\n      konnectivity-server --\x3e konnectivity-agent-1\n\n      konnectivity-agent-1 --\x3e kubelet-1\n    end\n\n    subgraph Node 2\n      konnectivity-agent-2[Konnectivity Agent]\n      kubelet-2[kubelet]\n\n      konnectivity-agent-2 -. create tunnel .-> konnectivity-server\n      konnectivity-server --\x3e konnectivity-agent-2\n\n      konnectivity-agent-2 --\x3e kubelet-2\n    end\n\n  end'})}),"\n",(0,o.jsx)(n.p,{children:"Control Plane\uc740 Node\uc5d0\uc11c \uc811\uadfc\ud560 \uc218 \uc788\uc9c0\ub9cc, Node\ub294 Control Plane\uc5d0 \uc811\uadfc\ud560 \uc218 \uc5c6\ub294 \uacbd\uc6b0\uac00 \uc788\uc2b5\ub2c8\ub2e4. \uc774\ub54c, Konnectivity\ub97c \uc0ac\uc6a9\ud558\uc5ec \uac01 Node\uc758 agent\uac00 \ubbf8\ub9ac server\uc640 tunnel\uc744 \ub9cc\ub4e4\uc5b4\ub450\uba74 kube-apiserver\uac00 Node\uc758 kubelet\uc5d0 \uc811\uadfc\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,o.jsx)(n.h2,{id:"\uc124\uc815",children:"\uc124\uc815"}),"\n",(0,o.jsx)(n.h3,{id:"konnectivity-server",children:"Konnectivity server"}),"\n",(0,o.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/extend-kubernetes/setup-konnectivity/",children:"Kubernetes Docs / Tasks / Extend Kubernetes / Set up Konnectivity service"})}),"\n"]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\ndata:\n  egress-selector-configuration.yaml: |\n    apiVersion: apiserver.k8s.io/v1beta1\n    kind: EgressSelectorConfiguration\n    egressSelections:\n      - name: cluster\n        connection:\n          proxyProtocol: GRPC\n          transport:\n            uds:\n              udsName: /run/konnectivity/konnectivity-server.socket\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nspec:\n  template:\n    metadata:\n      labels:\n        app.kubernetes.io/name: control-plane\n        app: control-plane\n    spec:\n      containers:\n        - name: konnectivity-server\n          image: registry.k8s.io/kas-network-proxy/proxy-server:v0.33.0\n          command:\n            - /proxy-server\n          args:\n            - --uds-name=/run/konnectivity/konnectivity-server.socket\n            - --authentication-audience=system:konnectivity-server\n            # ...\n          ports:\n            - name: konnectivity-agent\n              containerPort: 8132\n            - name: konnectivity-admin\n              containerPort: 8133\n            - name: konnectivity-health\n              containerPort: 8134\n          volumeMounts:\n            - name: konnectivity-uds\n              mountPath: /run/konnectivity\n        - name: kube-apiserver\n          image: registry.k8s.io/kube-apiserver:v1.32.6\n          command:\n            - kube-apiserver\n          args:\n            - --egress-selector-config-file=/etc/kubernetes/konnectivity/configurations/egress-selector-configuration.yaml\n            # ...\n          ports:\n            - name: kube-apiserver\n              containerPort: 6443\n          volumeMounts:\n            - name: konnectivity-uds\n              mountPath: /run/konnectivity\n            - name: egress-selector-configuration\n              mountPath: /etc/kubernetes/konnectivity/configurations\n      volumes:\n        - name: konnectivity-uds\n          emptyDir:\n            medium: Memory\n        - name: egress-selector-configuration\n          configMap:\n            name: konnectivity-egress-selector-configuration\n            defaultMode: 420\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Service\nspec:\n  type: LoadBalancer\n  selector:\n    app.kubernetes.io/name: control-plane\n    app: control-plane\n  ports:\n    - name: konnectivity-agent\n      port: 8132\n      targetPort: konnectivity-agent\n    - name: konnectivity-admin\n      port: 8133\n      targetPort: konnectivity-admin\n    - name: konnectivity-health\n      port: 8134\n      targetPort: konnectivity-health\n    - name: kube-apiserver\n      port: 6443\n      targetPort: kube-apiserver\n"})}),"\n",(0,o.jsx)(n.h3,{id:"konnectivity-agent",children:"Konnectivity agent"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: DaemonSet\nspec:\n  template:\n    spec:\n      containers:\n        - name: konnectivity-agent\n          image: registry.k8s.io/kas-network-proxy/proxy-agent:v0.33.0\n          command:\n            - /proxy-agent\n          args:\n            - --proxy-server-host=<IP>\n            # ...\n"})})]})}function k(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(v,{...e})}):v(e)}}}]);