"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[85895],{28453:(e,n,l)=>{l.d(n,{R:()=>c,x:()=>r});var t=l(96540);const i={},s=t.createContext(i);function c(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(s.Provider,{value:n},e.children)}},75740:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>h,contentTitle:()=>a,default:()=>j,frontMatter:()=>d,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"mlops/nn/llm/kvcache","title":"KV Cache","description":"KV Cache","source":"@site/docs/mlops/nn/llm/kvcache.mdx","sourceDirName":"mlops/nn/llm","slug":"/mlops/nn/llm/kvcache","permalink":"/docs/mlops/nn/llm/kvcache","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/nn/llm/kvcache.mdx","tags":[],"version":"current","lastUpdatedAt":1763046907000,"frontMatter":{"id":"kvcache","title":"KV Cache","sidebar_label":"KV Cache","description":"KV Cache","keywords":["Neural Network","Large Language Model","KVCache"]},"sidebar":"nn","previous":{"title":"Transformer (1706)","permalink":"/docs/mlops/nn/llm/transformer"},"next":{"title":"Mooncake (2407)","permalink":"/docs/mlops/nn/llm/mooncake"}}');var i=l(74848),s=l(28453),c=l(98180),r=l(79883);const d={id:"kvcache",title:"KV Cache",sidebar_label:"KV Cache",description:"KV Cache",keywords:["Neural Network","Large Language Model","KVCache"]},a=void 0,h={},o=[{value:"KV Cache",id:"kv-cache",level:2},{value:"KV Cache size",id:"kv-cache-size",level:2}];function x(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"kv-cache",children:"KV Cache"}),"\n",(0,i.jsx)("center",{children:(0,i.jsxs)("figure",{children:[(0,i.jsx)(r.A,{src:(0,c.Ay)("img/mlops/nn/llm/kvcache.drawio")}),(0,i.jsx)("figcaption",{children:"KV Cache"})]})}),"\n",(0,i.jsx)(n.h2,{id:"kv-cache-size",children:"KV Cache size"}),"\n",(0,i.jsx)(n.admonition,{title:"References",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://lmcache.ai/kv_cache_calculator.html",children:"KV Cache Size Calculator"})}),"\n"]})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Model"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"KV size per token (FP16)"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Context Length"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"Max KV size"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.2-1B-Instruct"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"32 KiB"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"128000"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"4 GiB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.1-8B-Instruct"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"128 KiB"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"128000"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"16 GiB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.3-70B-Instruct"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"320 KiB"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"128000"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"40 GiB"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Qwen/Qwen3-32B"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"256 KiB"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"32768 (131072 with YaRN)"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"8 GiB (32 GiB with YaRN)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"deepseek-ai/DeepSeek-R1"})}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"68.6 KiB"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"128000"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"8.38 GiB"})]})]})]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.2-1B-Instruct"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Layers: 16"}),"\n",(0,i.jsx)(n.li,{children:"KV Heads: 8"}),"\n",(0,i.jsx)(n.li,{children:"Head Dimension: 64"}),"\n",(0,i.jsxs)(n.li,{children:["Total Elements: 16384 ",(0,i.jsx)(n.code,{children:"(Layers * KV Heads * Head Dimension * 2)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.1-8B-Instruct"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Layers: 32"}),"\n",(0,i.jsx)(n.li,{children:"KV Heads: 8"}),"\n",(0,i.jsx)(n.li,{children:"Head Dimension: 128"}),"\n",(0,i.jsxs)(n.li,{children:["Total Elements: 65536 ",(0,i.jsx)(n.code,{children:"(Layers * KV Heads * Head Dimension * 2)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"meta-llama/Llama-3.3-70B-Instruct"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Layers: 80"}),"\n",(0,i.jsx)(n.li,{children:"KV Heads: 8"}),"\n",(0,i.jsx)(n.li,{children:"Head Dimension: 128"}),"\n",(0,i.jsxs)(n.li,{children:["Total Elements: 163840 ",(0,i.jsx)(n.code,{children:"(Layers * KV Heads * Head Dimension * 2)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Qwen/Qwen3-32B"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Layers: 64"}),"\n",(0,i.jsx)(n.li,{children:"KV Heads: 8"}),"\n",(0,i.jsx)(n.li,{children:"Head Dimension: 128"}),"\n",(0,i.jsxs)(n.li,{children:["Total Elements: 131072 ",(0,i.jsx)(n.code,{children:"(Layers * KV Heads * Head Dimension * 2)"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"deepseek-ai/DeepSeek-R1"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Layers: 61"}),"\n",(0,i.jsx)(n.li,{children:"KV LoRA Rank: 512"}),"\n",(0,i.jsx)(n.li,{children:"QK RoPE Head Dimension: 64"}),"\n",(0,i.jsxs)(n.li,{children:["Total Elements: 35136 ",(0,i.jsx)(n.code,{children:"(Layers * (KV LoRA Rank + QK RoPE Head Dimension))"})]}),"\n"]}),"\n"]}),"\n"]})]})}function j(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(x,{...e})}):x(e)}},79883:(e,n,l)=>{l.d(n,{A:()=>s});var t=l(96540),i=l(74848);function s({src:e}){const[n,l]=(0,t.useState)("loading..."),s=(0,t.useRef)(null);return(0,t.useEffect)(()=>{if("undefined"==typeof window)return;const n=window.GraphViewer;n?fetch(e).then(e=>{if(!e.ok)throw new Error("Failed to fetch drawio file");return e.text()}).then(e=>{if(!e)return void l("Drawio file is empty");const t={editable:"_blank",highlight:"#0000ff",nav:!0,resize:!0,toolbar:"zoom lightbox",xml:e};s.current.dataset.mxgraph=JSON.stringify(t),l(""),setTimeout(()=>{n.createViewerForElement(s.current)},0)}).catch(e=>{l("Failed to load diagram: "+e.message)}):l("GraphViewer is not loaded")},[e]),(0,i.jsxs)("div",{className:"w-full p-4",children:[n&&(0,i.jsx)("p",{children:n}),(0,i.jsx)("div",{className:"w-full bg-white",ref:s})]})}}}]);