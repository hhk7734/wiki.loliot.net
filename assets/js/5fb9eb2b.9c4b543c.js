"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[70076],{19107:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>i,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"mlops/provisioning/keda/external-scaler","title":"KEDA External Scaler","description":"KEDA External Scaler","source":"@site/docs/mlops/provisioning/keda/external-scaler.mdx","sourceDirName":"mlops/provisioning/keda","slug":"/mlops/provisioning/keda/external-scaler","permalink":"/docs/mlops/provisioning/keda/external-scaler","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/provisioning/keda/external-scaler.mdx","tags":[],"version":"current","lastUpdatedAt":1769357717000,"frontMatter":{"id":"external-scaler","title":"KEDA External Scaler","sidebar_label":"External Scaler","description":"KEDA External Scaler","keywords":["keda","event","external","trigger"]},"sidebar":"provisioning","previous":{"title":"CRD \uac00\uc774\ub4dc","permalink":"/docs/mlops/provisioning/keda/crd"},"next":{"title":"Knative","permalink":"/docs/mlops/provisioning/knative/"}}');var r=n(74848),a=n(28453);const l={id:"external-scaler",title:"KEDA External Scaler",sidebar_label:"External Scaler",description:"KEDA External Scaler",keywords:["keda","event","external","trigger"]},c=void 0,i={},o=[{value:"\uc791\ub3d9 \ubc29\uc2dd",id:"\uc791\ub3d9-\ubc29\uc2dd",level:2},{value:"Scaler \uc11c\ube44\uc2a4 \uad6c\ud604",id:"scaler-\uc11c\ube44\uc2a4-\uad6c\ud604",level:2},{value:"CRD\uc5d0 External scaler \uc124\uc815\ud558\uae30",id:"crd\uc5d0-external-scaler-\uc124\uc815\ud558\uae30",level:2}];function d(e){const s={a:"a",admonition:"admonition",annotation:"annotation",code:"code",h2:"h2",li:"li",math:"math",mfrac:"mfrac",mo:"mo",mrow:"mrow",mtext:"mtext",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.h2,{id:"\uc791\ub3d9-\ubc29\uc2dd",children:"\uc791\ub3d9 \ubc29\uc2dd"}),"\n",(0,r.jsx)(s.p,{children:"KEDA\ub294 KEDA operator (0 \u2194 1 \uc2a4\ucf00\uc77c\ub9c1)\uc640 Kubernetes HPA (1 \u2194 N \uc2a4\ucf00\uc77c\ub9c1)\ub97c \ud65c\uc6a9\ud55c 2\ub2e8\uacc4 \uc811\uadfc \ubc29\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec scaleTargetRef (e.g., Deployment)\ub97c \uc2a4\ucf00\uc77c\ub9c1\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(s.p,{children:"\ub2e4\uc74c\uc740 \ub2e8\uacc4\ubcc4 \uba54\ucee4\ub2c8\uc998\uc785\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:'0\uc5d0\uc11c 1\ub85c \uc2a4\ucf00\uc77c\ub9c1 (\ud65c\uc131\ud654); KEDA operator\ub294 scaleTargetRef\ub97c "\uae68\uc6b0\ub294" \uc5ed\ud560\uc744 \ud569\ub2c8\ub2e4.'}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Loop"}),": KEDA\ub294 \uc815\uae30\uc801\uc73c\ub85c \uc678\ubd80 \uc2a4\ucf00\uc77c\ub7ec\uc758 ",(0,r.jsx)(s.code,{children:"IsActive"})," RPC \uba54\uc11c\ub4dc\ub97c \ud3f4\ub9c1\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Logic"}),":","\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IsActive"}),"\uac00 true\ub97c \ubc18\ud658\ud558\uba74: KEDA\ub294 scaleTargetRef\ub97c minReplicaCount (\uae30\ubcf8\uac12 1)\ub85c \uc2a4\ucf00\uc77c\ub9c1\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"IsActive"}),"\uac00 (\ucfe8\ub2e4\uc6b4 \uae30\uac04 \ub3d9\uc548) false\ub97c \ubc18\ud658\ud558\uba74: KEDA\ub294 scaleTargetRef\ub97c 0\uc73c\ub85c \uc2a4\ucf00\uc77c\ub9c1\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(s.li,{children:["\n",(0,r.jsx)(s.p,{children:"1\uc5d0\uc11c N\uc73c\ub85c \uc2a4\ucf00\uc77c\ub9c1 (HPA); scaleTargetRef\uac00 \ud65c\uc131\ud654\ub418\uba74 (replicas > 0), KEDA\ub294 \uc2a4\ucf00\uc77c\ub9c1\uc744 \ucc98\ub9ac\ud558\uae30 \uc704\ud574 \ud45c\uc900 Kubernetes HPA \ub9ac\uc18c\uc2a4\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Setup"}),": KEDA\ub294 HPA \uaddc\uce59\uc744 \uc815\uc758\ud558\uae30 \uc704\ud574 \uc2a4\ucf00\uc77c\ub7ec\uc758 ",(0,r.jsx)(s.code,{children:"GetMetricSpec"})," RPC\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4 (e.g., ",(0,r.jsx)(s.code,{children:"TargetSize: 10"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Loop"}),": Kubernetes HPA \ucee8\ud2b8\ub864\ub7ec\ub294 KEDA metrics server\ub97c \ud3f4\ub9c1\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Data flow"}),":","\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"HPA\ub294 KEDA metrics server\uc5d0 \uc9c8\ubb38\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsxs)(s.li,{children:["KEDA metrics server\ub294 \uc2a4\ucf00\uc77c\ub7ec\uc758 ",(0,r.jsx)(s.code,{children:"GetMetrics"})," RPC\ub97c \ud638\ucd9c\ud569\ub2c8\ub2e4."]}),"\n",(0,r.jsx)(s.li,{children:"\uc2a4\ucf00\uc77c\ub7ec\ub294 \ud604\uc7ac \uac12\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4 (e.g., 50)."}),"\n",(0,r.jsxs)(s.li,{children:["HPA\ub294 \ud45c\uc900 \uacf5\uc2dd\uc744 \uc0ac\uc6a9\ud558\uc5ec desiredReplicas\ub97c \uacc4\uc0b0\ud569\ub2c8\ub2e4. ",(0,r.jsx)(s.a,{href:"/docs/mlops/kubernetes/workloads/horizontalpodautoscaler#algorithm",children:"Kubernetes HPA # Algorithm"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(s.span,{className:"katex-display",children:(0,r.jsxs)(s.span,{className:"katex",children:[(0,r.jsx)(s.span,{className:"katex-mathml",children:(0,r.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,r.jsxs)(s.semantics,{children:[(0,r.jsxs)(s.mrow,{children:[(0,r.jsx)(s.mtext,{children:"desiredReplicas"}),(0,r.jsx)(s.mo,{children:"="}),(0,r.jsx)(s.mo,{stretchy:"false",children:"\u2308"}),(0,r.jsx)(s.mtext,{children:"currentReplicas"}),(0,r.jsx)(s.mo,{children:"\xd7"}),(0,r.jsxs)(s.mfrac,{children:[(0,r.jsx)(s.mtext,{children:"currentMetricValue"}),(0,r.jsx)(s.mtext,{children:"desiredMetricValue"})]}),(0,r.jsx)(s.mo,{stretchy:"false",children:"\u2309"})]}),(0,r.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\text{desiredReplicas} = \\lceil \\text{currentReplicas} \\times \\frac{\\text{currentMetricValue}}{\\text{desiredMetricValue}} \\rceil"})]})})}),(0,r.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"0.8889em",verticalAlign:"-0.1944em"}}),(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"desiredReplicas"})}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,r.jsx)(s.span,{className:"mrel",children:"="}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,r.jsx)(s.span,{className:"mopen",children:"\u2308"}),(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"currentReplicas"})}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,r.jsx)(s.span,{className:"mbin",children:"\xd7"}),(0,r.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,r.jsxs)(s.span,{className:"base",children:[(0,r.jsx)(s.span,{className:"strut",style:{height:"2.0574em",verticalAlign:"-0.686em"}}),(0,r.jsxs)(s.span,{className:"mord",children:[(0,r.jsx)(s.span,{className:"mopen nulldelimiter"}),(0,r.jsx)(s.span,{className:"mfrac",children:(0,r.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,r.jsxs)(s.span,{className:"vlist-r",children:[(0,r.jsxs)(s.span,{className:"vlist",style:{height:"1.3714em"},children:[(0,r.jsxs)(s.span,{style:{top:"-2.314em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,r.jsx)(s.span,{className:"mord",children:(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"desiredMetricValue"})})})]}),(0,r.jsxs)(s.span,{style:{top:"-3.23em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,r.jsx)(s.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,r.jsxs)(s.span,{style:{top:"-3.677em"},children:[(0,r.jsx)(s.span,{className:"pstrut",style:{height:"3em"}}),(0,r.jsx)(s.span,{className:"mord",children:(0,r.jsx)(s.span,{className:"mord text",children:(0,r.jsx)(s.span,{className:"mord",children:"currentMetricValue"})})})]})]}),(0,r.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,r.jsx)(s.span,{className:"vlist-r",children:(0,r.jsx)(s.span,{className:"vlist",style:{height:"0.686em"},children:(0,r.jsx)(s.span,{})})})]})}),(0,r.jsx)(s.span,{className:"mclose nulldelimiter"})]}),(0,r.jsx)(s.span,{className:"mclose",children:"\u2309"})]})]})]})}),"\n",(0,r.jsx)(s.h2,{id:"scaler-\uc11c\ube44\uc2a4-\uad6c\ud604",children:"Scaler \uc11c\ube44\uc2a4 \uad6c\ud604"}),"\n",(0,r.jsx)(s.admonition,{title:"References",type:"info",children:(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"https://keda.sh/docs/2.18/concepts/external-scalers/",children:"KEDA / Concepts / External Scalers"})}),"\n",(0,r.jsx)(s.li,{children:(0,r.jsx)(s.a,{href:"/docs/lang/go/libraries/grpc/",children:"gRPC"})}),"\n"]})}),"\n",(0,r.jsx)(s.p,{children:"\uc544\ub798\uc640 \uac19\uc740 \uad6c\uc870\uc758 \ud504\ub85c\uc81d\ud2b8\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"<externalscaler>\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 scaler/\n\u2502       \u2514\u2500\u2500 main.go\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 application/\n\u2502   \u2502   \u2514\u2500\u2500 externalscaler.go\n\u2502   \u2514\u2500\u2500 pkg/\n\u2502       \u2514\u2500\u2500 externalscaler/\n\u2502           \u251c\u2500\u2500 externalscaler.pb.go\n\u2502           \u251c\u2500\u2500 externalscaler.proto\n\u2502           \u2514\u2500\u2500 externalscaler_grpc.pb.go\n\u251c\u2500\u2500 go.mod\n\u251c\u2500\u2500 go.sum\n\u251c\u2500\u2500 Makefile\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"curl https://raw.githubusercontent.com/kedacore/keda/main/pkg/scalers/externalscaler/externalscaler.proto \\\n    --create-dirs \\\n    -o internal/pkg/externalscaler/externalscaler.proto\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-shell",children:"protoc \\\n    --go_out=. \\\n    --go_opt=paths=source_relative \\\n    --go-grpc_out=. \\\n    --go-grpc_opt=paths=source_relative \\\n    internal/pkg/externalscaler/externalscaler.proto\n"})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-go",metastring:'title="internal/application/externalscaler.go"',children:'package application\n\nimport (\n\t"context"\n\n\tpb "github.com/hhk7734/externalscaler-test/internal/pkg/externalscaler"\n\t"google.golang.org/grpc/codes"\n\t"google.golang.org/grpc/status"\n)\n\ntype ExternalScaler struct {\n\tpb.UnimplementedExternalScalerServer\n}\n\n// IsActive\ub294 \ub300\uc0c1\uc774 \ud65c\uc131\ud654\ub418\uc5b4\uc57c \ud558\ub294\uc9c0 \uc5ec\ubd80\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4. false\ub97c \ubc18\ud658\ud558\uba74 \ub300\uc0c1\uc758 replicas\ub97c 0\uc73c\ub85c\n// \uc124\uc815\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) IsActive(ctx context.Context, scaledObject *pb.ScaledObjectRef) (*pb.IsActiveResponse, error) {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\treturn &pb.IsActiveResponse{Result: true}, nil\n}\n\n// GetMetricSpec\uc740 \ub300\uc0c1\uc774 \uc2a4\uce90\uc77c\ub9c1\ub418\uae30 \uc704\ud55c \uba54\ud2b8\ub9ad\uc758 \uae30\uc900\uac12\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) GetMetricSpec(ctx context.Context, scaledObject *pb.ScaledObjectRef) (*pb.GetMetricSpecResponse, error) {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\treturn &pb.GetMetricSpecResponse{\n\t\tMetricSpecs: []*pb.MetricSpec{\n\t\t\t{\n\t\t\t\tMetricName: "custom-metric",\n\t\t\t\tTargetSize: 10,\n\t\t\t},\n\t\t},\n\t}, nil\n}\n\n// GetMetrics\uc740 \uba54\ud2b8\ub9ad \uac12\uc744 \ubc18\ud658\ud569\ub2c8\ub2e4.\nfunc (e *ExternalScaler) GetMetrics(ctx context.Context, request *pb.GetMetricsRequest) (*pb.GetMetricsResponse, error) {\n\t// value := request.ScaledObjectRef.ScalerMetadata["<customKey>"]\n\n\treturn &pb.GetMetricsResponse{\n\t\tMetricValues: []*pb.MetricValue{\n\t\t\t{\n\t\t\t\tMetricName:  "custom-metric",\n\t\t\t\tMetricValue: 1,\n\t\t\t},\n\t\t},\n\t}, nil\n}\n\n// StreamIsActive\uc740 spec.triggers.type: external-push\uc778 \uacbd\uc6b0\uc5d0\ub9cc \uc0ac\uc6a9\ub429\ub2c8\ub2e4.\nfunc (e *ExternalScaler) StreamIsActive(scaledObject *pb.ScaledObjectRef, stream pb.ExternalScaler_StreamIsActiveServer) error {\n\t// value := scaledObject.ScalerMetadata["<customKey>"]\n\n\t// for {\n\t// \tselect {\n\t// \tcase <-stream.Context().Done():\n\t// \t\treturn nil\n\t// \tcase <-time.Tick(30 * time.Second):\n\t// \t\tif err := stream.Send(&pb.IsActiveResponse{Result: true}); err != nil {\n\t// \t\t\treturn err\n\t// \t\t}\n\t// \t}\n\t// }\n\n\treturn status.Error(codes.Unavailable, "external-push is not supported")\n}\n'})}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-go",metastring:'title="cmd/scaler/main.go"',children:'package main\n\nimport (\n\t"net"\n\n\t"github.com/hhk7734/externalscaler-test/internal/application"\n\tpb "github.com/hhk7734/externalscaler-test/internal/pkg/externalscaler"\n\t"google.golang.org/grpc"\n)\n\nfunc main() {\n\tgrpcServer := grpc.NewServer()\n\tlis, _ := net.Listen("tcp", ":6000")\n\tpb.RegisterExternalScalerServer(grpcServer, &application.ExternalScaler{})\n\n\tif err := grpcServer.Serve(lis); err != nil {\n\t}\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"crd\uc5d0-external-scaler-\uc124\uc815\ud558\uae30",children:"CRD\uc5d0 External scaler \uc124\uc815\ud558\uae30"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"spec:\n  triggers:\n    - type: external\n      metadata:\n        scalerAddress: <host>:<port>\n        # External scaler\uc5d0 \uc804\ub2ec\ud560 \uba54\ud0c0\ub370\uc774\ud130\n        # <customKey>: <value>\n"})})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},28453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var t=n(96540);const r={},a=t.createContext(r);function l(e){const s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);