"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[92536],{7938:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>r,contentTitle:()=>s,default:()=>o,frontMatter:()=>t,metadata:()=>l,toc:()=>d});const l=JSON.parse('{"id":"linux/package/debian/makefile","title":"Debian package Makefile","description":"Debian package Makefile","source":"@site/docs/linux/package/debian/makefile.mdx","sourceDirName":"linux/package/debian","slug":"/linux/package/debian/makefile","permalink":"/docs/linux/package/debian/makefile","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/linux/package/debian/makefile.mdx","tags":[],"version":"current","lastUpdatedAt":1746121371000,"frontMatter":{"id":"makefile","title":"Debian package Makefile","sidebar_label":"Makefile","description":"Debian package Makefile","keywords":["Debian","package","Makefile"]},"sidebar":"linux-package","previous":{"title":"Basics","permalink":"/docs/linux/package/debian/basics"},"next":{"title":"Advanced","permalink":"/docs/linux/package/debian/advanced"}}');var i=a(74848),c=a(28453);const t={id:"makefile",title:"Debian package Makefile",sidebar_label:"Makefile",description:"Debian package Makefile",keywords:["Debian","package","Makefile"]},s=void 0,r={},d=[{value:"Basic",id:"basic",level:2},{value:"Dynamic library",id:"dynamic-library",level:2}];function $(n){const e={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"basic",children:"Basic"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-makefile",children:".PHONY: all\nall:\n\n.PHONY: install\ninstall:\n\n.PHONY: clean\nclean:\n\n.PHONY: distclean\ndistclean: clean\n\n.PHONY: uninstall\nuninstall:\n"})}),"\n",(0,i.jsx)(e.h2,{id:"dynamic-library",children:"Dynamic library"}),"\n",(0,i.jsxs)(e.p,{children:["Ref: ",(0,i.jsx)(e.a,{href:"https://github.com/hhk7734/lot-SBC/blob/master/Makefile",children:"https://github.com/hhk7734/lot-SBC/blob/master/Makefile"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-makefile",children:"prefix = /usr\n\nVERSION = $(shell head -n1 debian/changelog | sed 's/.* .\\([0-9]\\+\\.[0-9]\\+\\.[0-9]\\+\\).*/\\1/')\nMAJOR   = $(shell echo $(VERSION) | sed 's/\\([0-9]*\\)\\..*/\\1/')\n\nDYNAMIC_LIB = lib<package>.so\n\nBUILD_DIR = build\n\nCC  = $(CROSS_COMPILE)gcc\nCXX = $(CROSS_COMPILE)g++\nLD  = $(CROSS_COMPILE)ld\n\nDEBUG = -g\nCOMMON_FLAGS  = -Wall -fPIC $(DEBUG)\nCOMMON_FLAGS += -O1\nCOMMON_FLAGS += -MMD -MP -MF\"$(@:%.o=%.d)\"\n\nCFLAGS = $(COMMON_FLAGS)\n\nCXXFLAGS  = $(COMMON_FLAGS)\nCXXFLAGS += -std=c++11\n\nLIBS =\n\nrwildcard=$(wildcard $1$2) $(foreach d,$(wildcard $1*),$(call rwildcard,$d/,$2))\n\nCSRCS =\n\nCXXSRCS =\n\nINCS_DIR  = -I.\n\nDEV_HEADERS  = $(shell ls <path>/*.h)\nDEV_HEADERS += $(shell ls <path>/*.hpp)\n\n.PHONY: all\nall: $(DYNAMIC_LIB).$(VERSION)\n\n$(BUILD_DIR):\n    mkdir $@\n\nvpath %.c $(sort $(dir $(CSRCS)))\n$(BUILD_DIR)/%.o: %.c | $(BUILD_DIR)\n    $(CC) $(CFLAGS) $(INCS_DIR) -Wa,-a,-ad,-alms=$(@:.o=.lst) -c -o $@ $<\n\nvpath %.cpp $(sort $(dir $(CXXSRCS)))\n$(BUILD_DIR)/%.o: %.cpp | $(BUILD_DIR)\n    $(CXX) $(CXXFLAGS) $(INCS_DIR) -Wa,-a,-ad,-alms=$(@:.o=.lst) -c -o $@ $<\n\nOBJS  = $(addprefix $(BUILD_DIR)/,$(notdir $(patsubst %.c,%.o,$(CSRCS))))\nOBJS += $(addprefix $(BUILD_DIR)/,$(notdir $(patsubst %.cpp,%.o,$(CXXSRCS))))\nOBJS += $(call rwildcard,obj,*.o)\n\n$(DYNAMIC_LIB).$(VERSION): $(OBJS)\n    $(LD) -shared $(LIBS) $^ -o $(BUILD_DIR)/$@\n\n-include $(wildcard $(BUILD_DIR)/*.d)\n\n.PHONY: install\ninstall:\n    install -m 0755 -d $(DESTDIR)$(prefix)/include/\n    install -m 0644 $(DEV_HEADERS) $(DESTDIR)$(prefix)/include/\n    install -m 0755 -d $(DESTDIR)$(prefix)/lib\n    install -m 0755 $(BUILD_DIR)/$(DYNAMIC_LIB).$(VERSION) $(DESTDIR)$(prefix)/lib\n    ln -sf $(DYNAMIC_LIB).$(VERSION) $(DESTDIR)$(prefix)/lib/$(DYNAMIC_LIB).$(MAJOR)\n    ln -sf $(DYNAMIC_LIB).$(MAJOR) $(DESTDIR)$(prefix)/lib/$(DYNAMIC_LIB)\n\n.PHONY: clean\nclean:\n    rm -rf $(BUILD_DIR)\n\n.PHONY: distclean\ndistclean: clean\n\n.PHONY: uninstall\nuninstall:\n    rm -f $(addprefix $(DESTDIR)$(prefix)/include/,$(notdir $(DEV_HEADERS)))\n    rm -f $(DESTDIR)$(prefix)/lib/lib<package>.*\n\n.PHONY: clang-format\nclang: $(call rwildcard,,*.c) $(call rwildcard,,*.cpp) $(call rwildcard,,*.h) $(call rwildcard,,*.hpp)\n    clang-format -style=file -i -verbose $^\n"})})]})}function o(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)($,{...n})}):$(n)}},28453:(n,e,a)=>{a.d(e,{R:()=>t,x:()=>s});var l=a(96540);const i={},c=l.createContext(i);function t(n){const e=l.useContext(c);return l.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:t(n.components),l.createElement(c.Provider,{value:e},n.children)}}}]);