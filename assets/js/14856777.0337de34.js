"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[44734],{17606:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"mlops/mlops/aws/ecr","title":"ECR","description":"ECR","source":"@site/docs/mlops/mlops/aws/ecr.mdx","sourceDirName":"mlops/mlops/aws","slug":"/mlops/mlops/aws/ecr","permalink":"/docs/mlops/mlops/aws/ecr","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/aws/ecr.mdx","tags":[],"version":"current","lastUpdatedAt":1735065445000,"frontMatter":{"id":"ecr","title":"ECR","sidebar_label":"ECR","description":"ECR","keywords":["ECR"]},"sidebar":"mlops","previous":{"title":"cluster-autoscaler","permalink":"/docs/mlops/mlops/aws/cluster-autoscaler"},"next":{"title":"ParallelCluster","permalink":"/docs/mlops/mlops/aws/parallel-cluster/"}}');var t=o(74848),r=o(28453);const s={id:"ecr",title:"ECR",sidebar_label:"ECR",description:"ECR",keywords:["ECR"]},c=void 0,a={},l=[{value:"Registry",id:"registry",level:2},{value:"Replication",id:"replication",level:2},{value:"From",id:"from",level:3},{value:"To",id:"to",level:3}];function p(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"registry",children:"Registry"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'name = "test"\ntest_registry = aws.ecr.Repository(\n    f"{name}-ecr",\n    name=name,\n    encryption_configurations=[aws.ecr.RepositoryEncryptionConfigurationArgs()],\n    image_scanning_configuration=aws.ecr.RepositoryImageScanningConfigurationArgs(\n        scan_on_push=False,\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n    tags={\n        "Name": name,\n        "Stack": variable.stack_name,\n    },\n)\n'})}),"\n",(0,t.jsx)(e.h2,{id:"replication",children:"Replication"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"A->B\ub85c B->C\ub85c \ubcf5\uc81c \uc124\uc815\uc744 \ud55c\ub2e4\uace0 \ud574\uc11c \uc804\ud30c\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uacbd\uc6b0 A->B, A->C\ub85c \uad6c\uc131\ud574\uc57c \ud569\ub2c8\ub2e4."}),"\n",(0,t.jsx)(e.li,{children:"\uc0ad\uc81c\ub294 \uc804\ud30c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"from",children:"From"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'to_account_id = "<account_id>"\nto_region = "<region>"\naws.ecr.ReplicationConfiguration(\n    "ecr-replication",\n    replication_configuration=aws.ecr.ReplicationConfigurationReplicationConfigurationArgs(\n        rules=[\n            aws.ecr.ReplicationConfigurationReplicationConfigurationRuleArgs(\n                destinations=[\n                    aws.ecr.ReplicationConfigurationReplicationConfigurationRuleDestinationArgs(\n                        registry_id=to_account_id,\n                        region=to_region,\n                    )\n                ],\n                # repository_filters=[\n                #     aws.ecr.ReplicationConfigurationReplicationConfigurationRuleRepositoryFilterArgs(\n                #         filter="<prefix>",\n                #         filter_type="PREFIX_MATCH",\n                #     )\n                # ],\n            )\n        ]\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n)\n'})}),"\n",(0,t.jsx)(e.h3,{id:"to",children:"To"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:'from_account_id = "<account_id>"\nfrom_region = "<region>"\nto_account_id = "<account_id>"\nto_region = "<region>"\naws.ecr.RegistryPolicy(\n    "ecr-registry-policy",\n    policy=json.dumps(\n        {\n            "Statement": [\n                {\n                    "Action": ["ecr:CreateRepository", "ecr:ReplicateImage"],\n                    "Effect": "Allow",\n                    "Principal": {"AWS": f"arn:aws:iam::{from_account_id}:root"},\n                    "Resource": f"arn:aws:ecr:{to_region}:{to_account_id}:repository/*",\n                    "Sid": f"{from_account_id}-ECR",\n                }\n            ],\n            "Version": "2012-10-17",\n        }\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n)\n'})})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(p,{...n})}):p(n)}},28453:(n,e,o)=>{o.d(e,{R:()=>s,x:()=>c});var i=o(96540);const t={},r=i.createContext(t);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);