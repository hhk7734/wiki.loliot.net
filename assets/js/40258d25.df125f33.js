"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[85459],{8961:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>t});const c=JSON.parse('{"id":"mlops/serving/vllm/kvevent","title":"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0","description":"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0","source":"@site/docs/mlops/serving/vllm/kvevent.mdx","sourceDirName":"mlops/serving/vllm","slug":"/mlops/serving/vllm/kvevent","permalink":"/docs/mlops/serving/vllm/kvevent","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/serving/vllm/kvevent.mdx","tags":[],"version":"current","lastUpdatedAt":1757781452000,"frontMatter":{"id":"kvevent","title":"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0","sidebar_label":"KVEvent","description":"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0","keywords":["vLLM","KVEvent"]},"sidebar":"serving","previous":{"title":"KVConnector","permalink":"/docs/mlops/serving/vllm/kvconnector"}}');var i=l(74848),s=l(28453);const r={id:"kvevent",title:"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0",sidebar_label:"KVEvent",description:"vLLM KVEvent \uad6c\ub3c5\uc744 \ud1b5\ud55c KVCache \uc815\ubcf4 \uac31\uc2e0",keywords:["vLLM","KVEvent"]},o=void 0,a={},t=[{value:"\uc124\uc815",id:"\uc124\uc815",level:2},{value:"KVCacheEvent",id:"kvcacheevent",level:2}];function h(e){const n={code:"code",h2:"h2",li:"li",mermaid:"mermaid",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\uc124\uc815",children:"\uc124\uc815"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"export PYTHONHASHSEED=<int>\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\ud658\uacbd \ubcc0\uc218","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PYTHONHASHSEED=<int>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uccab \ubc88\uc9f8 \uc694\uccad\uc758 \ubd80\ubaa8 hash \uac12\uc744 \ub9cc\ub4e4 \ub54c \uc0ac\uc6a9\ub429\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"\uc124\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \ub79c\ub364 \uac12\uc774 \uc124\uc815\ub418\uc5b4 cache hit\ub97c \uacc4\uc0b0\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Scheduler","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"--enable-chunked-prefill"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Cache","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"--enable-prefix-caching"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--block-size <size>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"1, 8, 16, 32, 64, 128 \uc911\uc5d0 \uc120\ud0dd\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--prefix-caching-hash-algo builtin"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"hash \uc54c\uace0\ub9ac\uc998\uc744 \uc9c0\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"builtin"}),": python ",(0,i.jsx)(n.code,{children:"hash"})," \ud568\uc218\ub97c \uc0ac\uc6a9\ud569\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"sha256"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"sha256_cbor_64bit"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["vLLM","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"--kv-events-config <configJson>"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"enable_kv_cache_events: true"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"publisher: zmq"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"endpoint: tcp://<host>:<port>"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"topic: <topic>"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"kvcacheevent",children:"KVCacheEvent"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n  Scheduler ->> KVCacheManager: allocate_slots()\n  KVCacheManager ->> KVCacheCoordinator: allocate_new_blocks()\n  KVCacheCoordinator ->> SingleTypeKVCacheManager: allocate_new_blocks()\n  SingleTypeKVCacheManager ->> BlockPool: get_new_blocks()\n  BlockPool ->> BlockPool: queue.append(BlockRemoved())\n  BlockPool --\x3e> SingleTypeKVCacheManager: list[KVCacheBlock]\n  SingleTypeKVCacheManager --\x3e> KVCacheCoordinator: list[KVCacheBlock]\n  KVCacheCoordinator --\x3e> KVCacheManager: list[KVCacheBlock]\n  KVCacheManager --\x3e> Scheduler: KVCacheBlocks\n\n  Note over Scheduler: receive KVCache from remote\n\n  Scheduler ->> KVCacheManager: cache_blocks()\n  KVCacheManager ->> KVCacheCoordinator: cache_blocks()\n  KVCacheCoordinator ->> SingleTypeKVCacheManager: cache_blocks()\n  SingleTypeKVCacheManager ->> BlockPool: cache_full_blocks()\n  BlockPool ->> BlockPool: queue.append(BlockStored())\n\n  Scheduler ->> KVCacheManager: take_events()\n  KVCacheManager ->> BlockPool: take_events()\n  BlockPool --\x3e> KVCacheManager: list[KVCacheEvent]\n  KVCacheManager --\x3e> Scheduler: list[KVCacheEvent]\n  Scheduler ->> EventPublisher: publish()"})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},28453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>o});var c=l(96540);const i={},s=c.createContext(i);function r(e){const n=c.useContext(s);return c.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);