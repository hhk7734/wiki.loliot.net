"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[96064],{28453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>c});var t=l(96540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},72315:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"mlops/monitoring/loki/loki","title":"Loki","description":"Loki","source":"@site/docs/mlops/monitoring/loki/loki.mdx","sourceDirName":"mlops/monitoring/loki","slug":"/mlops/monitoring/loki/","permalink":"/docs/mlops/monitoring/loki/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/monitoring/loki/loki.mdx","tags":[],"version":"current","lastUpdatedAt":1748797628000,"frontMatter":{"id":"loki","title":"Loki","sidebar_label":"Loki","description":"Loki","keywords":["Loki"]},"sidebar":"monitoring","previous":{"title":"Thanos","permalink":"/docs/mlops/monitoring/prometheus/thanos"},"next":{"title":"Label","permalink":"/docs/mlops/monitoring/loki/label"}}');var i=l(74848),s=l(28453),r=l(98180);const c={id:"loki",title:"Loki",sidebar_label:"Loki",description:"Loki",keywords:["Loki"]},d=void 0,o={},a=[{value:"\ubc30\ud3ec Mode",id:"\ubc30\ud3ec-mode",level:2},{value:"\ucef4\ud3ec\ub10c\ud2b8",id:"\ucef4\ud3ec\ub10c\ud2b8",level:2},{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"Grafana",id:"grafana",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"\ubc30\ud3ec-mode",children:"\ubc30\ud3ec Mode"}),"\n",(0,i.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/get-started/deployment-modes/",children:"Loki Docs / Deployment Modes"})}),"\n"]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Monolithic","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ubaa8\ub4e0 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ubc30\ud3ec"}),"\n",(0,i.jsx)(n.li,{children:"\ud558\ub8e8\uc5d0 20GB \uc815\ub3c4\uc758 \uc77d\uae30/\uc4f0\uae30\uac00 \uc788\ub294 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Simple scalable","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc77d\uae30 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\uacfc \uc4f0\uae30 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\ub85c \ubd84\ub9ac\ud558\uc5ec \ubc30\ud3ec"}),"\n",(0,i.jsx)(n.li,{children:"\ud558\ub8e8\uc5d0 ~ 10TB \uc815\ub3c4\uc758 \uc77d\uae30/\uc4f0\uae30\uac00 \uc788\ub294 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Microservices","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ubaa8\ub4e0 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ubd84\ub9ac\ud558\uc5ec \ubc30\ud3ec, \uac00\uc7a5 \uc790\uc720\ub3c4\uac00 \ub192\uc9c0\ub9cc \uc720\uc9c0\ubcf4\uc218\ub3c4 \uc5b4\ub824\uc6c0"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\ucef4\ud3ec\ub10c\ud2b8",children:"\ucef4\ud3ec\ub10c\ud2b8"}),"\n",(0,i.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/get-started/components/",children:"Loki Docs / Components"})}),"\n"]})}),"\n",(0,i.jsx)("center",{children:(0,i.jsxs)("figure",{children:[(0,i.jsx)("img",{src:(0,r.Ay)("img/mlops/monitoring/plg/loki_architecture_components.png")}),(0,i.jsx)("figcaption",{children:(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/get-started/architecture/",children:"Loki Docs / Architecture"})})]})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Distributor: \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \ub4e4\uc5b4\uc624\ub294 \ub85c\uadf8\ub97c \uac80\uc99d \ud6c4 Ingester\ub85c \uc804\ub2ec"}),"\n",(0,i.jsx)(n.li,{children:"Ingester: Distributor\ub85c\ubd80\ud130 \ubc1b\uc740 \ub85c\uadf8\ub97c \uc784\uc2dc \ub610\ub294 \uc7a5\uae30 \uc800\uc7a5"}),"\n",(0,i.jsx)(n.li,{children:"Query Frontend: \ucffc\ub9ac\ub97c \uc870\uc815, \ucffc\ub9ac \ub300\uae30\uc5f4 \uad00\ub9ac \ub4f1\uc744 \uc218\ud589"}),"\n",(0,i.jsx)(n.li,{children:"Querier: Ingester \ub610\ub294 \uc7a5\uae30 \uc800\uc7a5\uc18c\uc5d0\uc11c \ub85c\uadf8\ub97c \ucffc\ub9ac"}),"\n"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Component"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"microservice"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"single"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"read"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"write"}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:"backend"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Distributor"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Ingester"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Query Frontend"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Query Scheduler"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Querier"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Index Gateway"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Compactor"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Ruler"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"-"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"O"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,i.jsx)(n.admonition,{title:"Reference",type:"info",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/setup/install/helm/install-scalable/",children:"Loki Docs / Install the simple scalable Helm chart"})}),"\n"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm repo add grafana https://grafana.github.io/helm-charts\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm repo update grafana \\\n&& helm search repo grafana/loki -l | head -n 10\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm pull grafana/loki --version 6.30.1\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm show values grafana/loki --version 6.30.1 > loki-6.30.1.yaml\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="loki-values.yaml"',children:'deploymentMode: SimpleScalable\n\nglobal:\n  extraArgs:\n    - -config.expand-env=true\n  extraEnvFrom: []\n\nloki:\n  auth_enabled: false\n\n  schemaConfig:\n    configs:\n      - # \uc778\ub371\uc2a4 \uc0dd\uc131 \uc2dc\uc791\uc77c, \uc2a4\ud0a4\ub9c8\uac00 \ubcc0\uacbd\ub418\uba74 \ubcc0\uacbd\uc774 \uc2dc\uc791\ub418\ub294 \ub0a0\uc9dc\n        from: "2024-03-31"\n        store: tsdb\n        # chunks\uac00 \uc800\uc7a5\ub418\ub294 \uc800\uc7a5\uc18c\ub85c \uae30\ubcf8\uac12\uc73c\ub85c store \uac12\uc744 \uc501\ub2c8\ub2e4. aws(alias s3), azure,\n        # alibabacloud, bos, cos, swift, filesystem, or a named_store\n        object_store: s3\n        schema: v13\n        index:\n          prefix: loki_index_\n          period: 24h\n\n  storage:\n    bucketNames:\n      chunks: loki\n      ruler: loki\n      admin: loki\n    type: s3\n    s3:\n      s3ForcePathStyle: true\n      endpoint: "http://${BUCKET_HOST}:${BUCKET_PORT}"\n      region: "${BUCKET_REGION}"\n      accessKeyId: "${AWS_ACCESS_KEY_ID}"\n      secretAccessKey: "${AWS_SECRET_ACCESS_KEY}"\n\n  storage_config:\n    tsdb_shipper:\n      active_index_directory: /var/loki/tsdb-index\n      cache_location: /var/loki/tsdb-cache\n      cache_ttl: 168h\n\n  ingester:\n    chunk_encoding: snappy\n\n  querier:\n    max_concurrent: 4\n\n  limits_config:\n    max_entries_limit_per_query: 10000\n\nread:\n\nbackend:\n  persistence:\n    storageClass: ""\n\nwrite:\n  persistence:\n    storageClass: ""\n\ngateway:\n  podLabels: {}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"read"}),"(",(0,i.jsx)(n.code,{children:"querier"}),", ",(0,i.jsx)(n.code,{children:"queryFrontend"}),"), ",(0,i.jsx)(n.code,{children:"gateway"}),"\ub294 \ucffc\ub9ac\ub418\ub294 \ub85c\uadf8\uc758 \uc591\uc5d0 \ub530\ub77c ",(0,i.jsx)(n.strong,{children:"OOMKilled"}),"\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ubaa8\ub2c8\ud130\ub9c1\uc744 \ud1b5\ud574 \uc801\uc808\ud55c \uac12\uc744 \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4."]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"loki"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/configure",children:"Loki Docs / Configure"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"storage"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"storage_config"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"ingester"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"querier"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"max_concurrent: 4"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\uc131\ub2a5 \uac1c\uc120\uc774 \ud544\uc694\ud558\uace0, \ub9ac\uc18c\uc2a4\uac00 \ucda9\ubd84\ud558\ub2e4\uba74 \ub298\ub824\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.li,{children:"OOM \ub4f1 \ubb38\uc81c\uac00 \ubc1c\uc0dd\ud558\uba74 \uc904\uc5ec\ubcfc \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"compactor"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"limits_config"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm template loki grafana/loki \\\n    --version 6.30.1 \\\n    -n loki \\\n    -f loki-values.yaml \\\n    > loki.yaml\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-shell",children:"helm upgrade loki grafana/loki \\\n    --install \\\n    --history-max 5 \\\n    --version 6.30.1 \\\n    -n loki \\\n    -f loki-values.yaml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"grafana",children:"Grafana"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Configuration -> Data sources -> Add data source -> Loki","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["HTTP","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["URL: ",(0,i.jsx)(n.code,{children:"http://loki-gateway.loki.svc"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Explore -> Loki -> Add query","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Builder","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Label filters","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:'{job="fluent-bit"}'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Code","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Log browser: ",(0,i.jsx)(n.code,{children:'{job="fluent-bit"}'})]}),"\n",(0,i.jsxs)(n.li,{children:["Log query: ",(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/logql/log_queries/",children:"https://grafana.com/docs/loki/latest/logql/log_queries/"})]}),"\n",(0,i.jsxs)(n.li,{children:["LogQL Analyzer: ",(0,i.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/logql/analyzer/",children:"https://grafana.com/docs/loki/latest/logql/analyzer/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);