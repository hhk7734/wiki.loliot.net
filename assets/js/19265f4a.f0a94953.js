"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[79249],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>i});var r=s(96540);const t={},c=r.createContext(t);function l(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(c.Provider,{value:n},e.children)}},40808:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"mlops/mlops/auth/cert-manager/lets-encrypt","title":"Let\'s Encrypt with cert-manager","description":"Let\'s Encrypt with cert-manager","source":"@site/docs/mlops/mlops/auth/cert-manager/lets-encrypt.mdx","sourceDirName":"mlops/mlops/auth/cert-manager","slug":"/mlops/mlops/auth/cert-manager/lets-encrypt","permalink":"/docs/mlops/mlops/auth/cert-manager/lets-encrypt","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/auth/cert-manager/lets-encrypt.mdx","tags":[],"version":"current","lastUpdatedAt":1746964508000,"frontMatter":{"id":"lets-encrypt","title":"Let\'s Encrypt with cert-manager","sidebar_label":"Let\'s Encrypt","description":"Let\'s Encrypt with cert-manager","keywords":["cert-manager","Let\'s Encrypt"]},"sidebar":"mlops","previous":{"title":"CRDs","permalink":"/docs/mlops/mlops/auth/cert-manager/crds"},"next":{"title":"Keycloak","permalink":"/docs/mlops/mlops/auth/keycloak/"}}');var t=s(74848),c=s(28453);const l={id:"lets-encrypt",title:"Let's Encrypt with cert-manager",sidebar_label:"Let's Encrypt",description:"Let's Encrypt with cert-manager",keywords:["cert-manager","Let's Encrypt"]},i=void 0,a={},o=[{value:"Let&#39;s Encrypt",id:"lets-encrypt",level:2},{value:"HTTP-01 challenge",id:"http-01-challenge",level:3},{value:"DNS-01 challenge",id:"dns-01-challenge",level:3},{value:"Cloudflare",id:"cloudflare",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"lets-encrypt",children:"Let's Encrypt"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cert-manager.io/docs/faq/acme/",children:"https://cert-manager.io/docs/faq/acme/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"http-01-challenge",children:"HTTP-01 challenge"}),"\n",(0,t.jsxs)(n.p,{children:["\uc778\uc99d\uc744 \uc2dc\uc791\ud558\uba74 ",(0,t.jsx)(n.code,{children:"<path>"}),"\uc640 ",(0,t.jsx)(n.code,{children:"<token>"}),"\uc744 \ubc1c\ud589\ud574 \uc8fc\ub294\ub370, ",(0,t.jsx)(n.code,{children:"http://<domain>/.well-known/acme-challenge/<path>"}),"\uc5d0 \uc811\uc18d\ud588\uc744 \ub54c ",(0,t.jsx)(n.code,{children:"<token>"}),"\uc744 \ubc18\ud658\ud558\ub3c4\ub85d \ud558\uc5ec \uc11c\ubc84\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc74c\uc744 \uc99d\uba85\ud558\uba74 \uc778\uc99d\uc11c\uac00 \ubc1c\uae09\ub429\ub2c8\ub2e4. 80 \ud3ec\ud2b8\ub9cc \uc0ac\uc6a9 \uac00\ub2a5\ud558\uba70 \uc640\uc77c\ub4dc\uce74\ub4dc(",(0,t.jsx)(n.code,{children:'"*".<domain>'}),")\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h3,{id:"dns-01-challenge",children:"DNS-01 challenge"}),"\n",(0,t.jsxs)(n.p,{children:["\uc778\uc99d\uc744 \uc2dc\uc791\ud558\uba74 ",(0,t.jsx)(n.code,{children:"<token>"}),"\uc744 \ubc1c\ud589\ud574 \uc8fc\ub294\ub370, ",(0,t.jsx)(n.code,{children:"_acme-challenge.<domain>"})," TXT \ub808\ucf54\ub4dc\uc5d0 \ub123\uc5b4 DNS\ub97c \uc81c\uc5b4\ud560 \uc218 \uc788\uc74c\uc744 \uc99d\uba85\ud558\uba74 \uc778\uc99d\uc11c\uac00 \ubc1c\uae09\ub429\ub2c8\ub2e4. DNS \uc81c\uacf5 \uc5c5\uccb4\uc5d0\uc11c \uc790\ub3d9\uc73c\ub85c DNS\ub97c \uc5c5\ub370\uc774\ud2b8 \ud560 \uc218 \uc788\ub3c4\ub85d API\ub97c \uc81c\uacf5\ud574\uc8fc\ub294 \uacbd\uc6b0 \uc88b\uc2b5\ub2c8\ub2e4. \uc624\ub798\ub41c TXT \ub808\ucf54\ub4dc\ub294 \uc0ad\uc81c\ud574\uc8fc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.h4,{id:"cloudflare",children:"Cloudflare"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"API token"}),"\uacfc ",(0,t.jsx)(n.code,{children:"API key"}),"\ub97c \uc0ac\uc6a9\ud55c \ubc29\ubc95\uc774 \uc788\ub294\ub370, \uc5ec\uae30\uc11c\ub294 ",(0,t.jsx)(n.code,{children:"API token"}),"\ub9cc \ud14c\uc2a4\ud2b8 \ud574\ubcf4\uaca0\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"My Profile -> API Tokens -> Create Token"})," \ub610\ub294 ",(0,t.jsx)(n.strong,{children:"Manage Account -> Account API Tokens -> Create Token"})," \uc5d0\uc11c Edit zone DNS \ud15c\ud50c\ub9bf \uc744 \uc0ac\uc6a9\ud558\uc5ec \ud1a0\ud070\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4. \uc608\uc2dc\ub85c \uc544\ub798\uc640 \uac19\uc774 \uc124\uc815\ud588\uc2b5\ub2c8\ub2e4."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Permissions","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Zone, DNS, Edit"}),"\n",(0,t.jsx)(n.li,{children:"Zone, Zone, Read"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Zone Resources","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Include, Specific zone, ",(0,t.jsx)(n.code,{children:"<domain>"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Client IP Address Filtering","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"None"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["TTL","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"None"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\uc0dd\uc131\ud558\uba74 \ud1a0\ud070\uacfc \ud568\uaed8 \ud14c\uc2a4\ud2b8 \ucf54\ub4dc\ub97c \uc90d\ub2c8\ub2e4."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl create secret \\\n    generic \\\n    -n auth \\\n    cloudflare-api-token \\\n    --from-literal=token=<token>\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://cert-manager.io/docs/reference/api-docs/#acme.cert-manager.io/v1.ACMEIssuer",children:"https://cert-manager.io/docs/reference/api-docs/#acme.cert-manager.io/v1.ACMEIssuer"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: cert-manager.io/v1\nkind: ClusterIssuer\nmetadata:\n  name: letsencrypt\nspec:\n  acme:\n    email: "" # email\n    server: https://acme-v02.api.letsencrypt.org/directory\n    privateKeySecretRef:\n      name: letsencrypt\n    solvers:\n      - selector:\n          dnsZones:\n            - "" # "domain"\n        dns01:\n          cloudflare:\n            email: "" # cloudflare email\n            apiTokenSecretRef:\n              name: cloudflare-api-token\n              key: token\n'})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://istio.io/latest/docs/ops/integrations/certmanager/",children:"https://istio.io/latest/docs/ops/integrations/certmanager/"})}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: ingress-cert\n  namespace: istio-system # \uc774\ub97c \uc0ac\uc6a9\ud560 ingress gateway\uc758 namespace\ub97c \uc9c0\uc815\ud569\ub2c8\ub2e4.\nspec:\n  secretName: ingress-cert-tls\n  duration: 2160h # 90d\n  renewBefore: 360h # 15d\n  dnsNames:\n    - "" # "*.sub.domain"\n    - "" # "sub.domain"\n  issuerRef:\n    kind: ClusterIssuer\n    name: letsencrypt\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"Certificate"}),"\uc744 \uc0dd\uc131\ud558\ub294 \uc21c\uac04 \uc778\uc99d\uc744 \uc2dc\uc791\ud569\ub2c8\ub2e4."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl describe clusterissuers.cert-manager.io letsencrypt\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl get certificates.cert-manager.io -n istio-system ingress-cert\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"warning",children:(0,t.jsxs)(n.p,{children:["\uc774 \ub2e4\uc74c \uc21c\uc11c\ub294 \uc778\uc99d\uc5d0 \uc2e4\ud328\ub97c \ud558\ub294 \uacbd\uc6b0 \uccb4\ud06c \ud574\ubcfc \uc218 \uc788\ub294 \uc808\ucc28\uc785\ub2c8\ub2e4. \ubb34\uc870\uac74 \uc2e4\ud589\ud574\ubcf4\uae30 \ubcf4\ub2e8 ",(0,t.jsx)(n.code,{children:"Status"}),", ",(0,t.jsx)(n.code,{children:"Events"}),"\ub97c \uc798 \uc77d\uc5b4\ubcf4\uba74\uc11c \uc801\uc808\ud55c \uba85\ub839\uc5b4\ub97c \uc2e4\ud589\uc2dc\ucf1c\uc11c \ub514\ubc84\uae45 \ud574\uc57c\ud569\ub2c8\ub2e4."]})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl describe certificates.cert-manager.io -n istio-system ingress-cert\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl describe certificaterequests.cert-manager.io -n istio-ingress <name>\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"kubectl logs cert-manager-\n"})})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);