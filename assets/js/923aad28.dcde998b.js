"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[98403],{3264:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>t,contentTitle:()=>i,default:()=>w,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"mlops/mlops/workflow/argo-workflows/argo-workflows","title":"Argo Workflows","description":"Argo Workflows","source":"@site/docs/mlops/mlops/workflow/argo-workflows/argo-workflows.mdx","sourceDirName":"mlops/mlops/workflow/argo-workflows","slug":"/mlops/mlops/workflow/argo-workflows/","permalink":"/docs/mlops/mlops/workflow/argo-workflows/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/workflow/argo-workflows/argo-workflows.mdx","tags":[],"version":"current","lastUpdatedAt":1743270018000,"frontMatter":{"id":"argo-workflows","title":"Argo Workflows","sidebar_label":"Argo Workflows","description":"Argo Workflows","keywords":["argo","workflows"]},"sidebar":"mlops","previous":{"title":"Local GitHub Action","permalink":"/docs/mlops/mlops/workflow/argo-cd/gitops/act"},"next":{"title":"CRD","permalink":"/docs/mlops/mlops/workflow/argo-workflows/crd"}}');var s=n(74848),a=n(28453);const l={id:"argo-workflows",title:"Argo Workflows",sidebar_label:"Argo Workflows",description:"Argo Workflows",keywords:["argo","workflows"]},i=void 0,t={},c=[{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"RBAC",id:"rbac",level:2},{value:"User",id:"user",level:2},{value:"SSO-Dex with Argo CD",id:"sso-dex-with-argo-cd",level:3},{value:"OIDC",id:"oidc",level:3},{value:"Keycloak",id:"keycloak",level:4}];function d(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"wget https://github.com/argoproj/argo-workflows/releases/latest/download/argo-linux-amd64.gz \\\n&& gzip -d argo-linux-amd64.gz \\\n&& sudo mv argo-linux-amd64 /usr/local/bin/argo \\\n&& sudo chmod +x /usr/local/bin/argo\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"helm repo add argo https://argoproj.github.io/argo-helm\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"helm repo update argo \\\n&& helm search repo argo/argo-workflows -l | head -n 10\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"helm show values argo/argo-workflows \\\n    --version 0.39.0 \\\n    > argo-workflows-values.yaml\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:'title="argo-workflows-values.yaml"',children:"commonLabels: {}\n\ncontroller:\n  resources:\n    requests:\n      cpu: 100m\n      memory: 256Mi\n    limits:\n      memory: 256Mi\n\n  retentionPolicy:\n    completed: 10\n    failed: 100\n    errored: 100\n\nserver:\n  authModes:\n    - client # kubernetes \ud1a0\ud070\uc744 \uc0ac\uc6a9\ud55c \uc778\uc99d\n\n  resources:\n    requests:\n      cpu: 100m\n      memory: 256Mi\n    limits:\n      memory: 256Mi\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"helm template argo-workflows argo/argo-workflows \\\n    --version 0.39.0 \\\n    -n workflow \\\n    -f argo-cd-values.yaml \\\n    > argo-cd.yaml\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"helm upgrade argo-workflows argo/argo-workflows \\\n    --install \\\n    --history-max 5 \\\n    --version 0.39.0 \\\n    -n workflow \\\n    --values argo-workflows-values.yaml\n"})}),"\n",(0,s.jsx)(o.h2,{id:"rbac",children:"RBAC"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"https://argoproj.github.io/argo-workflows/argo-server-sso/",children:"https://argoproj.github.io/argo-workflows/argo-server-sso/"})}),"\n"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:'title="argo-workflows-values.yaml"',children:"server:\n  # ConfigMap.data.config: |, name: workflow-controller-configmap\n  sso:\n    # openid\ub294 \uae30\ubcf8\uc73c\ub85c \ucd94\uac00\ub429\ub2c8\ub2e4.\n    scopes:\n      - groups\n      - email\n      - profile\n    rbac:\n      enabled: true\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: argo-workflows-guest\n  namespace: workflow\n  annotations:\n    workflows.argoproj.io/rbac-rule: "true"\n    # \uc774 \uc124\uc815\uc774 guest \uc124\uc815\uc774 \ub420 \uc218 \uc788\ub3c4\ub85d \ub2e4\ub978 ServiceAccount\ub294 precedence\ub97c 1\n    # \uc774\uc0c1\uc73c\ub85c \uc124\uc815\ud574\uc8fc\uc138\uc694\n    workflows.argoproj.io/rbac-rule-precedence: "0"\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: argo-workflows-guest.service-account-token\n  namespace: workflow\n  annotations:\n    kubernetes.io/service-account.name: argo-workflows-guest\ntype: kubernetes.io/service-account-token\n'})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",children:'---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: argo-workflows-admin\n  namespace: workflow\n  annotations:\n    # * `groups` - an array of the OIDC groups\n    # * `iss` - the issuer ("argo-server")\n    # * `sub` - the subject (typically the username)\n    # https://github.com/antonmedv/expr/blob/master/docs/Language-Definition.md\n    workflows.argoproj.io/rbac-rule: "\'<group>\' in groups"\n    # \uac12\uc774 \ud074 \uc218\ub85d \uc6b0\uc120\uc21c\uc704\uac00 \ub192\uc544\uc9d0\n    workflows.argoproj.io/rbac-rule-precedence: "1"\n\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: argo-workflows-admin.service-account-token\n  namespace: workflow\n  annotations:\n    kubernetes.io/service-account.name: argo-workflows-admin\ntype: kubernetes.io/service-account-token\n'})}),"\n",(0,s.jsx)(o.admonition,{type:"info",children:(0,s.jsx)(o.p,{children:"ServiceAccount\uc5d0 \uc6d0\ud558\ub294 \ubaa9\uc801\uc5d0 \ub9de\ub294 Role\uacfc ClusterRole\uc744 \uc0dd\uc131 \ud6c4 \ubc14\uc778\ub529 \uc2dc\ucf1c\uc8fc\uc138\uc694."})}),"\n",(0,s.jsx)(o.h2,{id:"user",children:"User"}),"\n",(0,s.jsx)(o.h3,{id:"sso-dex-with-argo-cd",children:"SSO-Dex with Argo CD"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"cat << EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: argo-workflows-sso\n  namespace: workflow\ndata:\n  # `echo -n argo-workflows-sso | base64`\n  client-id: YXJnby13b3JrZmxvd3Mtc3Nv\n  # `echo -n MY-SECRET-STRING-CAN-BE-UUID | base64`\n  client-secret: TVktU0VDUkVULVNUUklORy1DQU4tQkUtVVVJRA==\nEOF\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:'title="argo-cd-values.yaml"',children:"dex:\n  env:\n    - name: ARGO_WORKFLOWS_SSO_CLIENT_SECRET\n      valueFrom:\n        secretKeyRef:\n          name: argo-workflows-sso\n          key: client-secret\n\nconfigs:\n  cm:\n    dex.config: |\n      staticClients:\n        - id: argo-workflows-sso\n          name: Argo Workflows\n          redirectURIs:\n            - <workflow-server-uri>/oauth2/callback\n          secretEnv: ARGO_WORKFLOWS_SSO_CLIENT_SECRET\n"})}),"\n",(0,s.jsx)(o.admonition,{type:"info",children:(0,s.jsxs)(o.p,{children:["Dex\ub294 \ud074\ub77c\uc774\uc5b8\ud2b8(",(0,s.jsx)(o.code,{children:"aud(audience)"}),")\ub300\uc2e0 \ub2e4\ub978 \ud074\ub77c\uc774\uc5b8\ud2b8(",(0,s.jsx)(o.code,{children:"azp(authorized party)"}),")\uc5d0\uac8c ID \ud1a0\ud070 \ubc1c\ud589\uc744 \ub9de\uae38 \uc218 \uc788\ub294 \uae30\ub2a5\uc774 \uc788\uc2b5\ub2c8\ub2e4. ",(0,s.jsx)(o.code,{children:"staticClients.trustedPeers: []"}),"\uc5d0 azp\uac00 \ub420 \ud074\ub77c\uc774\uc5b8\ud2b8\uc758 id\ub97c \ucd94\uac00\ud558\uba74 \ub429\ub2c8\ub2e4."]})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:'title="argo-workflows-values.yaml"',children:"server:\n  extraArgs:\n    - --access-control-allow-origin=true\n\n  authModes:\n    - sso\n\n  # ConfigMap.data.sso |, name: workflow-controller-configmap\n  sso:\n    enabled: true\n    issuer: <argo-cd-server-uri>/api/dex\n    sessionExpiry: 12h\n    clientId:\n      name: argo-workflows-sso\n      key: client-id\n    clientSecret:\n      name: argo-workflows-sso\n      key: client-secret\n    redirectUrl: <workflow-server-url>/oauth2/callback\n"})}),"\n",(0,s.jsx)(o.h3,{id:"oidc",children:"OIDC"}),"\n",(0,s.jsx)(o.h4,{id:"keycloak",children:"Keycloak"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:(0,s.jsx)(o.a,{href:"/docs/mlops/mlops/auth/keycloak/openid-connect",children:"Keycloak OIDC"})}),"\n"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-shell",children:"cat << EOF | kubectl apply -f -\napiVersion: v1\nkind: Secret\nmetadata:\n  name: argo-workflows-sso\n  namespace: workflow\nstringData:\n  client-id: argo-workflows\n  client-secret: <workflow-client-secret>\nEOF\n"})}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:'title="argo-workflows-values.yaml"',children:"server:\n  extraArgs:\n    - --access-control-allow-origin=true\n\n  authModes:\n    - sso\n\n  # ConfigMap.data.sso |, name: workflow-controller-configmap\n  sso:\n    enabled: true\n    issuer: <keycloakURL>/realms/<realm>\n    sessionExpiry: 12h\n    clientId:\n      name: argo-workflows-sso\n      key: client-id\n    clientSecret:\n      name: argo-workflows-sso\n      key: client-secret\n    redirectUrl: <workflow-server-url>/oauth2/callback\n"})})]})}function w(e={}){const{wrapper:o}={...(0,a.R)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,o,n)=>{n.d(o,{R:()=>l,x:()=>i});var r=n(96540);const s={},a=r.createContext(s);function l(e){const o=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function i(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(a.Provider,{value:o},e.children)}}}]);