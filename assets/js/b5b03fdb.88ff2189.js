"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[15323],{27669:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>a,frontMatter:()=>c,metadata:()=>r,toc:()=>t});var s=l(74848),o=l(28453);const c={id:"asyncio",title:"asyncio",sidebar_label:"asyncio",description:"Python asyncio",keywords:["Python","asyncio"]},i=void 0,r={id:"lang/python/asyncio/asyncio",title:"asyncio",description:"Python asyncio",source:"@site/docs/lang/python/asyncio/asyncio.mdx",sourceDirName:"lang/python/asyncio",slug:"/lang/python/asyncio/",permalink:"/docs/lang/python/asyncio/",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1729318814e3,frontMatter:{id:"asyncio",title:"asyncio",sidebar_label:"asyncio",description:"Python asyncio",keywords:["Python","asyncio"]},sidebar:"python",previous:{title:"pytest",permalink:"/docs/lang/python/pytest"},next:{title:"contextvar",permalink:"/docs/lang/python/context/contextvar"}},d={},t=[{value:"EventLoop in Thread",id:"eventloop-in-thread",level:2},{value:"EventLoop",id:"eventloop",level:2}];function h(n){const e={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.h2,{id:"eventloop-in-thread",children:"EventLoop in Thread"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-python",children:"import asyncio\nimport threading\n\n# \uba54\uc778 \uc2a4\ub808\ub4dc\uc5d0\uc11c \uc790\uc2dd \uc2a4\ub808\ub4dc\uc758 \uc774\ubca4\ud2b8 \ub8e8\ud504\ub97c \uc81c\uc5b4\nnew_loop = asyncio.new_event_loop()\n\ndef run_loop(loop: asyncio.AbstractEventLoop) -> None:\n    # \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \uc774\ubca4\ud2b8 \ub8e8\ud504 \ub4f1\ub85d\n    asyncio.set_event_loop(loop)\n\n    try:\n        # \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \ub4f1\ub85d\ub41c \uc774\ubca4\ud2b8 \ub8e8\ud504 \uac00\uc838\uc624\uae30\n        # loop = asyncio.get_event_loop()\n        loop.run_forever()\n    finally:\n        try:\n            loop.run_until_complete(loop.shutdown_asyncgens())\n            loop.run_until_complete(loop.shutdown_default_executor())\n        finally:\n            # \ud604\uc7ac \uc2a4\ub808\ub4dc\uc5d0 \ub4f1\ub85d\ub41c \uc774\ubca4\ud2b8 \ub8e8\ud504 \uc81c\uac70\n            asyncio.set_event_loop(None)\n            loop.close()\n\nt = threading.Thread(target=run_loop, args=(new_loop,))\nt.start()\n\n# new_loop\uc5d0 \uc791\uc5c5 \uc694\uccad\n# ...\n\n# loop.run_forever()\ub97c \uc885\ub8cc\ud574\ub2ec\ub77c\ub294 \uc694\uccad\nnew_loop.call_soon_threadsafe(new_loop.stop)\nt.join()\n"})}),"\n",(0,s.jsx)(e.h2,{id:"eventloop",children:"EventLoop"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\uc774\ubca4\ud2b8 \ub8e8\ud504 \uc2e4\ud589"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.run_until_complete(future)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"future\uac00 \uc644\ub8cc\ub420 \ub54c\uae4c\uc9c0 \ube14\ub85c\ud0b9 \ub429\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.li,{children:"\uc2e4\ud589\uc804\uc5d0 \ub4f1\ub85d\ub41c \ucf5c\ubc31\uc774 \uc788\ub294 \uacbd\uc6b0 \ud574\ub2f9 \ucf5c\ubc31\ub4e4\uc774 \uc2e4\ud589\ub429\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(e.li,{children:["\ucf54\ub8e8\ud2f4\uc744 \uc778\uc790\ub85c \uc804\ub2ec\ud55c \uacbd\uc6b0 ",(0,s.jsx)(e.code,{children:"asyncio.Task"}),"\ub85c \uac10\uc2f8\uc11c \uc2e4\ud589\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"future.result()"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.run_forever()"}),": \uc774\ubca4\ud2b8 \ub8e8\ud504\ub97c \uc2e4\ud589\uc2dc\ud0a4\uace0 \ub8e8\ud504\uac00 \uc885\ub8cc\ub420 \ub54c\uae4c\uc9c0 \ube14\ub85c\ud0b9 \ub429\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.stop()"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\ub8e8\ud504\uc5d0 \ub4f1\ub85d\ub41c \ubaa8\ub4e0 \ucf54\ub8e8\ud2f4\uc744 \uc885\ub8cc\uc2dc\ud0a4\uace0 \ub8e8\ud504\ub97c \uc885\ub8cc\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.li,{children:"\uc0c8\ub85c \ub4f1\ub85d\ud55c \ucf5c\ubc31\uc740 \uc2e4\ud589\ub418\uc9c0 \uc54a\uace0, \ub2e4\uc74c \uc774\ubca4\ud2b8 \ub8e8\ud504\ub97c \uc2e4\ud589\uc2dc\ud0ac \ub54c \uc2e4\ud589\ub429\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(e.li,{children:["\ucf5c\ubc31 \ub0b4\uc5d0\uc11c \uc0c8\ub85c\uc6b4 \ucf5c\ubc31\uc744 \ub4f1\ub85d\ud55c \uacbd\uc6b0 \uc0c8\ub85c\uc6b4 \ucf5c\ubc31\uc774\ubbc0\ub85c \uc2e4\ud589\ub418\uc9c0 \uc54a\uae30 \ub54c\ubb38\uc5d0 ",(0,s.jsx)(e.code,{children:"await"}),"\uc5d0 \uac78\ub824\uc788\ub294 \uacbd\uc6b0 \ud504\ub85c\uadf8\ub7a8\uc774 \uba48\ucd94\uac8c \ub429\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\uc774\ubca4\ud2b8 \ub8e8\ud504\uc5d0 \ucf5c\ubc31 \ub4f1\ub85d"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.call_soon(callback, *args, context=None)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\ucf5c\ubc31\uc740 ",(0,s.jsx)(e.code,{children:"callback(*args)"}),"\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.li,{children:"\ucee8\ud14d\uc2a4\ud2b8\ub97c \uc9c0\uc815\ud558\uc9c0 \uc54a\uc73c\uba74 \ud604\uc7ac \ucee8\ud0dd\uc2a4\ud2b8\uac00 \uc0ac\uc6a9\ub429\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.Handle"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.call_soon_threadsafe(callback, *args, context=None)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\uc2a4\ub808\ub4dc \uc548\uc804\ud55c ",(0,s.jsx)(e.code,{children:"loop.call_soon()"}),"\uc785\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.li,{children:"\ub2e4\ub978 \uc2a4\ub808\ub4dc\uc5d0\uc11c \ucf5c\ubc31\uc744 \ub4f1\ub85d\ud560 \ub54c \uc0ac\uc6a9\ud574\uc57c\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.call_later(delay, callback, *args, context=None)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"delay"}),"\ucd08 \ud6c4\uc5d0 \ucf5c\ubc31\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.TimerHandle"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.call_at(when, callback, *args, context=None)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"when == loop.time()"}),"\uc5d0 \ucf5c\ubc31\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.TimerHandle"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.run_in_executor(executor, callback, *args)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"executor"}),"\uc5d0\uc11c \ucf5c\ubc31\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4.","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["None(\uae30\ubcf8 \uc2e4\ud589\uae30), ",(0,s.jsx)(e.code,{children:"concurrent.futures.ThreadPoolExecutor"}),", ",(0,s.jsx)(e.code,{children:"concurrent.futures.ProcessPoolExecutor"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.Future"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.add_signal_handler(sig, callback, *args)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"signal.SIGINT"}),", ",(0,s.jsx)(e.code,{children:"signal.SIGTERM"}),", ... \ub4f1\uc758 signal\uc774 \ubc1c\uc0dd\ud558\uba74 \ucf5c\ubc31\uc744 \uc2e4\ud589\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:["\ucf5c\ubc31\uc740 ",(0,s.jsx)(e.code,{children:"callback(*args)"}),"\ub85c \uc2e4\ud589\ub429\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.li,{children:"\uba54\uc778 \uc2a4\ub808\ub4dc\uc5d0\uc11c\ub9cc \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.remove_signal_handler(sig)"}),"\ub85c \ucf5c\ubc31\uc744 \uc81c\uac70\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"asyncio.run_coroutine_threadsafe(coroutine, loop)"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\ub8e8\ud504\uc5d0 \ucf54\ub8e8\ud2f4\uc744 \ub4f1\ub85d\ud569\ub2c8\ub2e4."}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"concurrent.futures.Future"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["Keywords \uc778\uc790\ub97c \uc0ac\uc6a9\ud574\uc57c\ud558\ub294 \uacbd\uc6b0 ",(0,s.jsx)(e.code,{children:"functools.partial()"}),"\uc744 \uc0ac\uc6a9\ud569\ub2c8\ub2e4.","\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["Ex) ",(0,s.jsx)(e.code,{children:"loop.call_soon(functools.partial(callback, arg1, key=value))"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\uc774\ubca4\ud2b8 \ub8e8\ud504 \uc0c1\ud0dc \ud655\uc778"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.is_running()"}),": \ub8e8\ud504\uac00 \uc2e4\ud589\uc911\uc774\uba74 ",(0,s.jsx)(e.code,{children:"True"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.is_closed()"}),": \ub8e8\ud504\uac00 \ub2eb\ud614\uc73c\uba74 ",(0,s.jsx)(e.code,{children:"True"}),"\ub97c \ubc18\ud658\ud569\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:["\n",(0,s.jsx)(e.p,{children:"\uc774\ubca4\ud2b8 \ub8e8\ud504 \ub2eb\uae30"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.shutdown_asyncgens()"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\ud604\uc7ac \uc5f4\ub824\uc788\ub294 \ube44\ub3d9\uae30 \uc81c\ub108\ub808\uc774\ud130 \uac1d\uccb4\uc758 ",(0,s.jsx)(e.code,{children:"aclose()"}),"\ub97c \ud638\ucd9c\ud558\uc5ec \ub2eb\uc2b5\ub2c8\ub2e4."]}),"\n",(0,s.jsx)(e.li,{children:"\uc774\ud6c4\uc5d0 \ube44\ub3d9\uae30 \uc81c\ub108\ub808\uc774\ud130\uac00 \uc5f4\ub9ac\uba74 \uacbd\uace0\uac00 \ubc1c\uc0dd\ud569\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.shutdown_default_executor()"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsxs)(e.li,{children:["\uae30\ubcf8 \uc2e4\ud589\uae30\uc758 \uc885\ub8cc \ucf5c\ubc31\uc744 \ub4f1\ub85d\ud558\uace0, \ud604\uc7ac \uc5f4\ub824\uc788\ub294 ",(0,s.jsx)(e.code,{children:"ThreadPoolExecutor"}),"\uc758 \uc2a4\ub808\ub4dc\ub4e4\uc744 \uc870\uc778\ud569\ub2c8\ub2e4."]}),"\n",(0,s.jsxs)(e.li,{children:["\uc774\ud6c4\uc5d0 ",(0,s.jsx)(e.code,{children:"loop.run_in_executor()"}),"\uc5d0 \uae30\ubcf8 \uc2e4\ud589\uae30\ub97c \uc0ac\uc6a9\ud558\ub824\ub294 \uacbd\uc6b0 ",(0,s.jsx)(e.code,{children:"RuntimeError"}),"\ub97c \ubc1c\uc0dd\uc2dc\ud0b5\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(e.li,{children:[(0,s.jsx)(e.code,{children:"loop.close()"}),"\n",(0,s.jsxs)(e.ul,{children:["\n",(0,s.jsx)(e.li,{children:"\ub8e8\ud504\ub97c \ub2eb\uc2b5\ub2c8\ub2e4."}),"\n",(0,s.jsx)(e.li,{children:"\ub4f1\ub85d\ub41c \ubaa8\ub4e0 \ucf5c\ubc31\uc774 \uc0ad\uc81c \ub429\ub2c8\ub2e4."}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function a(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(h,{...n})}):h(n)}},28453:(n,e,l)=>{l.d(e,{R:()=>i,x:()=>r});var s=l(96540);const o={},c=s.createContext(o);function i(n){const e=s.useContext(c);return s.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:i(n.components),s.createElement(c.Provider,{value:e},n.children)}}}]);