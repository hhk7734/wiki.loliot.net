(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[96064],{4156:(e,n,i)=>{e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:i.p+"assets/ideal-img/loki_architecture_components.c91cd8b.750.png 750w",images:[{path:i.p+"assets/ideal-img/loki_architecture_components.c91cd8b.750.png",width:750,height:563}],src:i.p+"assets/ideal-img/loki_architecture_components.c91cd8b.750.png",placeholder:void 0,width:750,height:563}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAIAAABPmPnhAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA7UlEQVR4nAXBS06DQAAA0Dm0N3DlDXTj3hrTpFYXNlGjRFMbNFhJkVZKgdLOh5kB5sNvwPdAQRJJY8YlgrxpW8JyxJhSFWYlzwXA6AAxFakjfq9bxYv9KwwfY6Ini+Rnx0DouzS2ePKcLi6pzLJg5H2NNgd9/rD58AnYrWziTQmxiXevVcmy92P0GUJ1M0+dLQVN1zVmaE2vjGGCSVMPw7BF8nTsWysCpJRaSdOaiKzvvq/swKqqusTRcj6DkQ94yUUhTNd7e+fi6Wy2HKu6V38vbHoi3FuAGcIpVloTjuzgLTyuq7oTMMDOJE/cf48Z1HzGPYVAAAAAAElFTkSuQmCC"}},52810:(e,n,i)=>{"use strict";i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>g,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"mlops/monitoring/loki/loki","title":"Loki","description":"Loki","source":"@site/docs/mlops/monitoring/loki/loki.mdx","sourceDirName":"mlops/monitoring/loki","slug":"/mlops/monitoring/loki/","permalink":"/docs/mlops/monitoring/loki/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/monitoring/loki/loki.mdx","tags":[],"version":"current","lastUpdatedAt":1745080102000,"frontMatter":{"id":"loki","title":"Loki","sidebar_label":"Loki","description":"Loki","keywords":["Loki"]},"sidebar":"monitoring","previous":{"title":"Thanos","permalink":"/docs/mlops/monitoring/prometheus/thanos"},"next":{"title":"Label","permalink":"/docs/mlops/monitoring/loki/label"}}');var l=i(74848),r=i(28453),t=i(82331);const o={id:"loki",title:"Loki",sidebar_label:"Loki",description:"Loki",keywords:["Loki"]},a=void 0,c={},d=[{value:"\ubc30\ud3ec Mode",id:"\ubc30\ud3ec-mode",level:2},{value:"\ucef4\ud3ec\ub10c\ud2b8",id:"\ucef4\ud3ec\ub10c\ud2b8",level:2},{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"\uc0ad\uc81c",id:"\uc0ad\uc81c",level:2},{value:"Grafana",id:"grafana",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\ubc30\ud3ec-mode",children:"\ubc30\ud3ec Mode"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/fundamentals/architecture/deployment-modes/",children:"https://grafana.com/docs/loki/latest/fundamentals/architecture/deployment-modes/"})}),"\n"]}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Monolithic","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\ubaa8\ub4e0 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ud558\ub098\uc758 \uc778\uc2a4\ud134\uc2a4\uc5d0 \ubc30\ud3ec"}),"\n",(0,l.jsx)(n.li,{children:"\ud558\ub8e8\uc5d0 100GB \uc815\ub3c4\uc758 \uc77d\uae30/\uc4f0\uae30\uac00 \uc788\ub294 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Simple scalable","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\uc77d\uae30 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\uacfc \uc4f0\uae30 \ucef4\ud3ec\ub10c\ud2b8\ub4e4\ub85c \ubd84\ub9ac\ud558\uc5ec \ubc30\ud3ec"}),"\n",(0,l.jsx)(n.li,{children:"\ud558\ub8e8\uc5d0 100GB ~ 10TB \uc815\ub3c4\uc758 \uc77d\uae30/\uc4f0\uae30\uac00 \uc788\ub294 \ud658\uacbd\uc5d0\uc11c \uc0ac\uc6a9 \uac00\ub2a5"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Microservices","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\ubaa8\ub4e0 \ucef4\ud3ec\ub10c\ud2b8\ub97c \ubd84\ub9ac\ud558\uc5ec \ubc30\ud3ec, \uac00\uc7a5 \uc790\uc720\ub3c4\uac00 \ub192\uc9c0\ub9cc \uc720\uc9c0\ubcf4\uc218\ub3c4 \uc5b4\ub824\uc6c0"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\ucef4\ud3ec\ub10c\ud2b8",children:"\ucef4\ud3ec\ub10c\ud2b8"}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(t.A,{img:i(4156),width:750})}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/fundamentals/architecture/components/",children:"https://grafana.com/docs/loki/latest/fundamentals/architecture/components/"})}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Distributor: \ud074\ub77c\uc774\uc5b8\ud2b8\uc5d0\uc11c \ub4e4\uc5b4\uc624\ub294 \ub85c\uadf8\ub97c \uac80\uc99d \ud6c4 Ingester\ub85c \uc804\ub2ec"}),"\n",(0,l.jsx)(n.li,{children:"Ingester: Distributor\ub85c\ubd80\ud130 \ubc1b\uc740 \ub85c\uadf8\ub97c \uc784\uc2dc \ub610\ub294 \uc7a5\uae30 \uc800\uc7a5"}),"\n",(0,l.jsx)(n.li,{children:"Query Frontend: \ucffc\ub9ac\ub97c \uc870\uc815, \ucffc\ub9ac \ub300\uae30\uc5f4 \uad00\ub9ac \ub4f1\uc744 \uc218\ud589"}),"\n",(0,l.jsx)(n.li,{children:"Querier: Ingester \ub610\ub294 \uc7a5\uae30 \uc800\uc7a5\uc18c\uc5d0\uc11c \ub85c\uadf8\ub97c \ucffc\ub9ac"}),"\n"]}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(t.A,{img:i(64245),width:750})}),"\n",(0,l.jsx)("center",{children:(0,l.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/getting-started/",children:"https://grafana.com/docs/loki/latest/getting-started/"})}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsx)(n.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm repo add grafana https://grafana.github.io/helm-charts\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm repo update grafana \\\n&& helm search repo grafana/loki-distributed -l | head -n 10\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm pull grafana/loki-distributed --version 0.79.0\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm show values grafana/loki-distributed --version 0.79.0 > loki-distributed-0.79.0.yaml\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="loki-distributed-values.yaml"',children:'fullnameOverride: loki\n\nglobal:\n  dnsService: coredns\n\nloki:\n  # -- Check https://grafana.com/docs/loki/latest/configuration/#schema_config\n  # for more info on how to configure schemas\n  schemaConfig:\n    configs:\n      - # \uc778\ub371\uc2a4 \uc0dd\uc131 \uc2dc\uc791\uc77c, \uc2a4\ud0a4\ub9c8\uac00 \ubcc0\uacbd\ub418\uba74 \ubcc0\uacbd\uc774 \uc2dc\uc791\ub418\ub294 \ub0a0\uc9dc\n        from: "2024-03-31"\n        store: tsdb\n        # chunks\uac00 \uc800\uc7a5\ub418\ub294 \uc800\uc7a5\uc18c\ub85c \uae30\ubcf8\uac12\uc73c\ub85c store \uac12\uc744 \uc501\ub2c8\ub2e4. aws(alias s3), azure,\n        # alibabacloud, bos, cos, swift, filesystem, or a named_store\n        object_store: s3\n        schema: v13\n        index:\n          prefix: loki_index_\n          period: 24h\n\n  # -- Check https://grafana.com/docs/loki/latest/configuration/#storage_config\n  # for more info on how to configure storages\n  storageConfig:\n    # https://grafana.com/docs/loki/latest/configure/#aws_storage_config\n    aws:\n      # s3: s3://<region>/<bucket>\n      s3forcepathstyle: true\n      endpoint: "http://${BUCKET_HOST}:${BUCKET_PORT}"\n      region: "${BUCKET_REGION}"\n      bucketnames: "${BUCKET_NAME}"\n      access_key_id: "${AWS_ACCESS_KEY_ID}"\n      secret_access_key: "${AWS_SECRET_ACCESS_KEY}"\n\n    tsdb_shipper:\n      shared_store: s3\n      active_index_directory: /var/loki/tsdb-index\n      cache_location: /var/loki/tsdb-cache\n      cache_ttl: 168h\n\n  # -- Structured loki configuration, takes precedence over `loki.config`, `loki.schemaConfig`, `loki.storageConfig`\n  structuredConfig:\n    limits_config:\n      max_entries_limit_per_query: 10000\n\ningester:\n  extraArgs:\n    - -config.expand-env=true\n\ndistributor:\n  extraArgs:\n    - -config.expand-env=true\n\nquerier:\n  extraArgs:\n    - -config.expand-env=true\n\nqueryFrontend:\n  extraArgs:\n    - -config.expand-env=true\n\ngateway:\n  podLabels: {}\n\ncompactor:\n  enabled: false\n\nruler:\n  enabled: false\n'})}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"querier"}),", ",(0,l.jsx)(n.code,{children:"queryFrontend"}),", ",(0,l.jsx)(n.code,{children:"gateway"}),"\ub294 \ucffc\ub9ac\ub418\ub294 \ub85c\uadf8\uc758 \uc591\uc5d0 \ub530\ub77c ",(0,l.jsx)(n.strong,{children:"OOMKilled"}),"\uac00 \ubc1c\uc0dd\ud560 \uc218 \uc788\uc73c\ubbc0\ub85c \ubaa8\ub2c8\ud130\ub9c1\uc744 \ud1b5\ud574 \uc801\uc808\ud55c \uac12\uc744 \uc124\uc815\ud574\uc57c \ud569\ub2c8\ub2e4."]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm template loki loki-distributed-0.79.0.tgz \\\n    -n loki \\\n    -f loki-distributed-values.yaml \\\n    > loki-distributed.yaml\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm upgrade loki loki-distributed-0.79.0.tgz \\\n    --install \\\n    --history-max 5 \\\n    -n loki \\\n    -f loki-distributed-values.yaml\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\uc0ad\uc81c",children:"\uc0ad\uc81c"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"helm uninstall -n loki loki\n"})}),"\n",(0,l.jsx)(n.h2,{id:"grafana",children:"Grafana"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Configuration -> Data sources -> Add data source -> Loki","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["HTTP","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["URL: ",(0,l.jsx)(n.code,{children:"http://loki-querier.loki.svc:3100"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Explore -> Loki -> Add query","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Builder","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Label filters","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:'{job="fluent-bit"}'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Code","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Log browser: ",(0,l.jsx)(n.code,{children:'{job="fluent-bit"}'})]}),"\n",(0,l.jsxs)(n.li,{children:["Log query: ",(0,l.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/logql/log_queries/",children:"https://grafana.com/docs/loki/latest/logql/log_queries/"})]}),"\n",(0,l.jsxs)(n.li,{children:["LogQL Analyzer: ",(0,l.jsx)(n.a,{href:"https://grafana.com/docs/loki/latest/logql/analyzer/",children:"https://grafana.com/docs/loki/latest/logql/analyzer/"})]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},64245:(e,n,i)=>{e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:i.p+"assets/ideal-img/simple-scalable-test-environment.041d15f.750.png 750w",images:[{path:i.p+"assets/ideal-img/simple-scalable-test-environment.041d15f.750.png",width:750,height:552}],src:i.p+"assets/ideal-img/simple-scalable-test-environment.041d15f.750.png",placeholder:void 0,width:750,height:552}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAhElEQVR4nFWOOQ7DMBAD9f8/pnJh2JYUHatbyw0MBTlYsJkBQeVS2zSVzqkxAPmPMnTjkLKJZUxm5l9HdYahutvgK7vgj+uoY4rIshREah+pNBuzp9x7j7mdWjvKEFFrhAEbKObCwJPK5amOCeCNP5mM0zrt42T0Mb54HYIIcPdm0mN3L45czF8j4PVuAAAAAElFTkSuQmCC"}}}]);