"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[27627],{42882:(t,n,e)=>{e.r(n),e.d(n,{assets:()=>r,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>x});const c=JSON.parse('{"id":"lang/go/context","title":"context","description":"context","source":"@site/docs/lang/go/context.mdx","sourceDirName":"lang/go","slug":"/lang/go/context","permalink":"/docs/lang/go/context","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/lang/go/context.mdx","tags":[],"version":"current","lastUpdatedAt":1733853842000,"frontMatter":{"id":"context","title":"context","sidebar_label":"context","description":"context","keywords":["context"]},"sidebar":"go","previous":{"title":"Test","permalink":"/docs/lang/go/test"},"next":{"title":"Goroutine","permalink":"/docs/lang/go/goroutine"}}');var o=e(74848),l=e(28453);const a={id:"context",title:"context",sidebar_label:"context",description:"context",keywords:["context"]},i=void 0,r={},x=[{value:"<code>context.Context</code>",id:"contextcontext",level:2},{value:"<code>context.WithValue</code>",id:"contextwithvalue",level:2},{value:"<code>context.WithCancel</code>",id:"contextwithcancel",level:2}];function s(t){const n={admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...t.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h2,{id:"contextcontext",children:(0,o.jsx)(n.code,{children:"context.Context"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"struct\uc5d0 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc800\uc7a5\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4"}),"\n",(0,o.jsxs)(n.li,{children:["\uc77c\ubc18\uc801\uc73c\ub85c ",(0,o.jsx)(n.code,{children:"ctx context.Context"}),"\ub97c \uccab\ubc88\uc9f8 \ud30c\ub77c\ubbf8\ud130\ub85c \uc120\uc5b8\ud569\ub2c8\ub2e4"]}),"\n",(0,o.jsx)(n.li,{children:"nil \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc804\ub2ec\ud558\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4"}),"\n",(0,o.jsxs)(n.li,{children:["\uc808\ub2ec\ud574\uc57c\ud560 \ucee8\ud14d\uc2a4\ud2b8\uac00 \uc5c6\uac70\ub098 \ud655\uc2e4\uce58 \uc54a\ub2e4\uba74 ",(0,o.jsx)(n.code,{children:"context.TODO()"}),"\ub97c \uc804\ub2ec\ud569\ub2c8\ub2e4"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func DoSomething(ctx context.Context, arg Arg) error {\n\t// ctx \uc0ac\uc6a9\n\treturn nil\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"contextwithvalue",children:(0,o.jsx)(n.code,{children:"context.WithValue"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'func WithValue(parent Context, key, val any) Context {\n\tif parent == nil {\n\t\tpanic("cannot create context from nil parent")\n\t}\n\tif key == nil {\n\t\tpanic("nil key")\n\t}\n\tif !reflectlite.TypeOf(key).Comparable() {\n\t\tpanic("key is not comparable")\n\t}\n\treturn &valueCtx{parent, key, val}\n}\n\ntype valueCtx struct {\n\tContext\n\tkey, val any\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"context.WithValue"}),"\ub294 \ubd80\ubaa8 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uba64\ubc84 \ubcc0\uc218\ub85c \uac16\ub294 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc0dd\uc131\ud569\ub2c8\ub2e4."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func (c *valueCtx) Value(key any) any {\n\t// \uc790\uc2e0(n \uc138\ub300)\uc774 key\uc5d0 \ub9de\ub294 Context\uc778 \uacbd\uc6b0 \uc790\uc2e0\uc758 \uac12\uc744 \ubc18\ud658\n\tif c.key == key {\n\t\treturn c.val\n\t}\n\n\t// \uc544\ub2cc \uacbd\uc6b0 \ubd80\ubaa8(n-1 \uc138\ub300) Context\ub97c \ud655\uc778\n\treturn value(c.Context, key)\n}\n\nfunc value(c Context, key any) any {\n\tfor {\n\t\tswitch ctx := c.(type) {\n\t\tcase *valueCtx:\n\t\t\t// \ubd80\ubaa8(n-1 \uc138\ub300)\uac00 key\uc5d0 \ub9de\ub294 Context\uc778 \uacbd\uc6b0 \ubd80\ubaa8\uc758 \uac12\uc744 \ubc18\ud658\n\t\t\tif key == ctx.key {\n\t\t\t\treturn ctx.val\n\t\t\t}\n\n\t\t\t// \uc544\ub2cc \uacbd\uc6b0 \ubd80\ubaa8\uc758 \ubd80\ubaa8(n-2 \uc138\ub300) Context\ub97c \ud0d0\uc0c9\ud558\uae30 \uc704\ud574 \uc900\ube44\n\t\t\tc = ctx.Context\n\t\tcase *cancelCtx:\n\t\t\t// \ub0b4\ubd80 \ucf54\ub4dc\ub97c \uc704\ud55c \ucc98\ub9ac\n\t\t\tif key == &cancelCtxKey {\n\t\t\t\treturn c\n\t\t\t}\n\t\t\tc = ctx.Context\n\t\tcase *timerCtx:\n\t\t\t// \ub0b4\ubd80 \ucf54\ub4dc\ub97c \uc704\ud55c \ucc98\ub9ac\n\t\t\tif key == &cancelCtxKey {\n\t\t\t\treturn ctx.cancelCtx\n\t\t\t}\n\t\t\tc = ctx.Context\n\t\tcase *emptyCtx:\n\t\t\t// n-1 \uc138\ub300 == 1 \uc138\ub300 Context\uc778 \uacbd\uc6b0 \ub354 \uc774\uc0c1 \ucc3e\uc744 \uc218 \uc5c6\uc73c\ubbc0\ub85c nil \ubc18\ud658\n\t\t\treturn nil\n\t\tdefault:\n\t\t\t// n-2 \uc138\ub300 Context \ud655\uc778\n\t\t\treturn c.Value(key)\n\t\t}\n\t}\n}\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"warning",children:(0,o.jsx)(n.p,{children:"Context\ub97c \ud0a4-\uac12 \uc800\uc7a5\uc18c\ub85c \ub108\ubb34 \ub9ce\uc774 \uc0ac\uc6a9\ud558\uba74 \uc131\ub2a5\uc5d0 \uc601\ud5a5\uc744 \uc904 \uc218 \uc788\uc2b5\ub2c8\ub2e4"})}),"\n",(0,o.jsx)(n.h2,{id:"contextwithcancel",children:(0,o.jsx)(n.code,{children:"context.WithCancel"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:'func WithCancel(parent Context) (ctx Context, cancel CancelFunc) {\n\tc := withCancel(parent)\n\treturn c, func() { c.cancel(true, Canceled, nil) }\n}\n\nfunc withCancel(parent Context) *cancelCtx {\n\tif parent == nil {\n\t\tpanic("cannot create context from nil parent")\n\t}\n\tc := newCancelCtx(parent)\n\tpropagateCancel(parent, c)\n\treturn c\n}\n\ntype cancelCtx struct {\n\tContext\n\n\tmu       sync.Mutex            // protects following fields\n\tdone     atomic.Value          // of chan struct{}, created lazily, closed by first cancel call\n\tchildren map[canceler]struct{} // set to nil by the first cancel call\n\terr      error                 // set to non-nil by the first cancel call\n\tcause    error                 // set to non-nil by the first cancel call\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"context.WithCancel"}),"\uc740 \ubd80\ubaa8 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uba64\ubc84 \ubcc0\uc218\ub85c \uac16\ub294 \ucee8\ud14d\uc2a4\ud2b8\ub97c \uc0dd\uc131\ud558\uace0, \ubd80\ubaa8 \ucee8\ud14d\uc2a4\ud2b8\uac00 \ucde8\uc18c\ub418\uba74 \uc790\uc2e0\ub3c4 \ucde8\uc18c\ub418\ub3c4\ub85d \uc124\uacc4\ub418\uc5b4 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"WithCancelCause(parent Context) (ctx Context, cancel CancelCauseFunc)\nWithDeadline(parent Context, d time.Time) (Context, CancelFunc)\nWithTimeout(parent Context, timeout time.Duration) (Context, CancelFunc)\n"})})]})}function d(t={}){const{wrapper:n}={...(0,l.R)(),...t.components};return n?(0,o.jsx)(n,{...t,children:(0,o.jsx)(s,{...t})}):s(t)}},28453:(t,n,e)=>{e.d(n,{R:()=>a,x:()=>i});var c=e(96540);const o={},l=c.createContext(o);function a(t){const n=c.useContext(l);return c.useMemo((function(){return"function"==typeof t?t(n):{...n,...t}}),[n,t])}function i(t){let n;return n=t.disableParentContext?"function"==typeof t.components?t.components(o):t.components||o:a(t.components),c.createElement(l.Provider,{value:n},t.children)}}}]);