"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[18977],{20867:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>t,default:()=>p,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"mlops/monitoring/opensearch/basics","title":"OpenSearch Basics","description":"OpenSearch Basics","source":"@site/docs/mlops/monitoring/opensearch/basics.mdx","sourceDirName":"mlops/monitoring/opensearch","slug":"/mlops/monitoring/opensearch/basics","permalink":"/docs/mlops/monitoring/opensearch/basics","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/monitoring/opensearch/basics.mdx","tags":[],"version":"current","lastUpdatedAt":1734103299000,"frontMatter":{"id":"basics","title":"OpenSearch Basics","sidebar_label":"Basics","description":"OpenSearch Basics","keywords":["OpenSearch Basics"]},"sidebar":"monitoring","previous":{"title":"\ud655\uc7a5 \ud504\ub85c\uadf8\ub7a8","permalink":"/docs/mlops/monitoring/k6/extensions"},"next":{"title":"Operator","permalink":"/docs/mlops/monitoring/eck/operator"}}');var a=s(74848),o=s(28453);const c={id:"basics",title:"OpenSearch Basics",sidebar_label:"Basics",description:"OpenSearch Basics",keywords:["OpenSearch Basics"]},t=void 0,i={},l=[{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"OpenSearch",id:"opensearch",level:3},{value:"OpenSearch Dashboards",id:"opensearch-dashboards",level:3},{value:"Keycloak",id:"keycloak",level:3},{value:"OpenSearch",id:"opensearch-1",level:4},{value:"OpenSearch Dashboards",id:"opensearch-dashboards-1",level:4},{value:"Removal",id:"removal",level:2},{value:"Reference",id:"reference",level:2}];function h(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsx)(n.p,{children:"OIDC \uad00\ub828 \uc124\uc815\uc5d0 \uc2e4\ud328\ud55c \ub0b4\uc6a9\uc785\ub2c8\ub2e4. \ucd94\ud6c4 \uc131\uacf5\ud558\uba74 \uc218\uc815\ud558\ub3c4\ub85d \ud558\uaca0\uc2b5\ub2c8\ub2e4."})}),"\n",(0,a.jsx)(n.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm repo add opensearch https://opensearch-project.github.io/helm-charts \\\n&& helm repo update opensearch\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"mkdir -p monitoring/opensearch/helm\n"})}),"\n",(0,a.jsx)(n.h3,{id:"opensearch",children:"OpenSearch"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-ini",metastring:'title="monitoring/opensearch/opensearch-cert.conf"',children:"[ req_ext ]\nsubjectAltName=@san\n\n[ san ]\nDNS.1 = opensearch-cluster-master\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"openssl genrsa -out opensearch.key 3072 \\\n&& openssl pkcs8 -inform PEM -in opensearch.key \\\n    -topk8 -nocrypt -v1 PBE-SHA1-3DES \\\n    -outform PEM -out opensearch-key.pem \\\n&& rm opensearch.key \\\n&& openssl req -new -config opensearch-cert.conf -key opensearch-key.pem -out opensearch.csr \\\n&& openssl x509 -req -days 730 \\\n    -CA root-cert.pem -CAkey root-key.pem -CAcreateserial\\\n    -extensions req_ext -extfile opensearch-cert.conf \\\n    -in opensearch.csr -out opensearch-cert.pem \\\n&& rm opensearch.csr\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm search repo opensearch/opensearch -l | head -n 10\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm show values opensearch/opensearch \\\n    --version 1.10.2 \\\n    > monitoring/opensearch/helm/opensearch-values.yaml\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/helm/opensearch-values.yaml"',children:'masterService: "opensearch-cluster-master"\n\nreplicas: 1\n\n# /usr/share/opensearch/config\ub97c \uae30\uc900\uc73c\ub85c \ud569\ub2c8\ub2e4.\nconfig:\n  # /usr/share/opensearch/config/opensearch.yml\n  opensearch.yml: |-\n    cluster.name: opensearch-cluster\n    network.host: 0.0.0.0\n\n    # https://opensearch.org/docs/latest/security-plugin/configuration/tls\n    plugins.security.allow_unsafe_democertificates: true\n\n    plugins.security.ssl.transport.enabled: true\n    plugins.security.ssl.transport.pemcert_filepath: /usr/share/opensearch/config/opensearch-cert.pem\n    plugins.security.ssl.transport.pemkey_filepath: /usr/share/opensearch/config/opensearch-key.pem\n    plugins.security.ssl.transport.pemtrustedcas_filepath: /usr/share/opensearch/config/root-cert.pem\n\n    plugins.security.ssl.transport.enforce_hostname_verification: false\n\n    plugins.security.ssl.http.enabled: true\n    plugins.security.ssl.http.pemcert_filepath: /usr/share/opensearch/config/opensearch-cert.pem\n    plugins.security.ssl.http.pemkey_filepath: /usr/share/opensearch/config/opensearch-key.pem\n    plugins.security.ssl.http.pemtrustedcas_filepath: /usr/share/opensearch/config/root-cert.pem\n\n    plugins.security.restapi.roles_enabled: ["all_access"]\n\n    # \uc815\uaddc\uc2dd \uc0ac\uc6a9 \ubd88\uac00\n    plugins.security.authcz.admin_dn:\n      - "CN=....." # \uc218\uc815\ud574\uc57c\ud568\n\n    # \uc815\uaddc\uc2dd \uc0ac\uc6a9 \uac00\ub2a5\n    plugins.security.nodes_dn:\n      - "CN=....." # \uc218\uc815\ud574\uc57c\ud568\n\nopensearchJavaOpts: "-Xmx2g -Xms2g"\n\nresources:\n  requests:\n    cpu: "500m"\n    memory: "4Gi"\n  limits:\n    memory: "4Gi"\n\nnetworkHost: "0.0.0.0"\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm upgrade opensearch opensearch/opensearch \\\n    --install \\\n    --version 1.10.2 \\\n    -n monitoring \\\n    -f monitoring/opensearch/helm/opensearch-values.yaml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"opensearch-dashboards",children:"OpenSearch Dashboards"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"openssl genrsa -out opensearch-dashboards.key 3072 \\\n&& openssl pkcs8 -inform PEM -in opensearch-dashboards.key \\\n    -topk8 -nocrypt -v1 PBE-SHA1-3DES \\\n    -outform PEM -out opensearch-dashboards-key.pem \\\n&& rm opensearch-dashboards.key \\\n&& openssl req -new -config opensearch-dashboards-cert.conf -key opensearch-dashboards-key.pem -out opensearch-dashboards.csr \\\n&& openssl x509 -req -days 730 \\\n    -CA root-cert.pem -CAkey root-key.pem -CAcreateserial\\\n    -extensions req_ext -extfile opensearch-dashboards-cert.conf \\\n    -in opensearch-dashboards.csr -out opensearch-dashboards-cert.pem \\\n&& rm opensearch-dashboards.csr\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/opensearch-dashboards-account.yaml"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: opensearch-dashboards-account\n  namespace: monitoring\nstringData:\n  username: <username>\n  password: <password>\n  cookie: <cookie>\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm search repo opensearch/opensearch-dashboards -l | head -n 10\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm show values opensearch/opensearch-dashboards \\\n    --version 1.4.1 \\\n    > monitoring/opensearch/helm/opensearch-dashboards-values.yaml\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/helm/opensearch-dashboards-values.yaml"',children:'opensearchHosts: https://opensearch-cluster-master:9200\nreplicaCount: 1\n\nconfig:\n  # /usr/share/opensearch-dashboards/config/opensearch_dashboards.yml\n  # https://github.com/opensearch-project/OpenSearch-Dashboards/blob/main/config/opensearch_dashboards.yml\n  opensearch_dashboards.yml: |-\n    server.name: dashboards\n    server.host: 0.0.0.0\n\n    opensearch.hosts: ["https://opensearch-cluster-master:9200"]\n    opensearch.username: kibanaserver\n    opensearch.password: kibanaserver\n\n    opensearch.ssl.verificationMode: full\n    opensearch.ssl.certificateAuthorities: ["/usr/share/opensearch-dashboards/config/root-cert.pem"]\n\n    # browser <-> dashboard\n    server.ssl.enabled: false\n    server.ssl.certificate: /usr/share/opensearch-dashboards/config/opensearch-dashboards-cert.pem\n    server.ssl.key: /usr/share/opensearch-dashboards/config/opensearch-dashboards-key.pem\n\n    opensearch_security.cookie.secure: false\n\n    opensearch.requestHeadersWhitelist: ["securitytenant", "authorization"]\n    opensearch_security.multitenancy.enabled: true\n    opensearch_security.multitenancy.tenants.enable_global: true\n    opensearch_security.multitenancy.tenants.enable_private: true\n    opensearch_security.multitenancy.tenants.preferred: ["Private", "Global"]\n    opensearch_security.multitenancy.enable_filter: false\n\n    # \ud14c\uc2a4\ud2b8\ud560 \ub54c true\n    logging.verbose: false\n\nopensearchAccount:\n  secret: "opensearch-dashboards-account"\n  keyPassphrase:\n    enabled: false\n\nresources:\n  requests:\n    cpu: 200m\n    memory: 1Gi\n  limits:\n    memory: 2Gi\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm upgrade opensearch-dashboards opensearch/opensearch-dashboards \\\n    --install \\\n    --version 1.4.1 \\\n    -n monitoring \\\n    -f monitoring/opensearch/helm/opensearch-dashboards-values.yaml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"keycloak",children:"Keycloak"}),"\n",(0,a.jsx)(n.h4,{id:"opensearch-1",children:"OpenSearch"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/opensearch-security-config.yaml"',children:'apiVersion: v1\nkind: Secret\nmetadata:\n  name: opensearch-security-config\n  namespace: monitoring\nstringData:\n  config.yaml: |-\n    _meta:\n      type: "config"\n      config_version: 2\n    config:\n      dynamic:\n        authc:\n          basic_internal_auth_domain:\n            http_enabled: true\n            transport_enabled: true\n            order: 0\n            http_authenticator:\n              type: basic\n              challenge: false\n            authentication_backend:\n              type: internal\n\n          openid_auth_domain:\n            http_enabled: true\n            transport_enabled: true\n            order: 1\n            http_authenticator:\n              type: openid\n              challenge: false\n              config:\n                subject_key: email\n                roles_key: groups\n                openid_connect_url: <keycloakURL>/realms/<realm>/.well-known/openid-configuration\n            authentication_backend:\n              type: noop\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/helm/opensearch-values.yaml"',children:'securityConfig:\n  config:\n    securityConfigSecret: "opensearch-security-config"\n'})}),"\n",(0,a.jsx)(n.h4,{id:"opensearch-dashboards-1",children:"OpenSearch Dashboards"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="monitoring/opensearch/helm/opensearch-dashboards-values.yaml"',children:'config:\n  # /usr/share/opensearch-dashboards/config/opensearch_dashboards.yml\n  # https://github.com/opensearch-project/OpenSearch-Dashboards/blob/main/config/opensearch_dashboards.yml\n  opensearch_dashboards.yml: |-\n    opensearch_security.auth.type: openid\n    opensearch_security.openid.connect_url: <keycloakURL>/realms/<realm>/.well-known/openid-configuration\n    opensearch_security.openid.base_redirect_url: <dashboards-url>\n    opensearch_security.openid.client_id: <client-id>\n    opensearch_security.openid.client_secret: <client-secrret>\n    opensearch_security.openid.scope: openid profile email groups\n    opensearch_security.openid.verify_hostnames: "false"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"removal",children:"Removal"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm uninstall -n monitoring opensearch\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"helm uninstall -n monitoring opensearch-dashboards\n"})}),"\n",(0,a.jsx)(n.h2,{id:"reference",children:"Reference"})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>t});var r=s(96540);const a={},o=r.createContext(a);function c(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);