(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[40495],{61495:(e,n,s)=>{e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:s.p+"assets/ideal-img/prometheus-operator-architecture.ee79665.750.png 750w",images:[{path:s.p+"assets/ideal-img/prometheus-operator-architecture.ee79665.750.png",width:750,height:437}],src:s.p+"assets/ideal-img/prometheus-operator-architecture.ee79665.750.png",placeholder:void 0,width:750,height:437}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAIAAAB1kpiRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVR4nAG6AEX/AJXJ66HP7YjC6Xu75n285n685nC15Gaw4maw4ne65gCfzu2y2PCIwumayuu82/Gv1e98uuSTxumRxeh+vOYAlMnrotDugr/omcrqutrwrdTugLzln8zrncvqgr7mAJvN7a3V74vE6oS/6JHG6o7F6nG25GWv4mWw4nO76gCIw+mOxeqDwOmDwOiOxemIwuqDv+h5u+d8uOCjrsAAfb3ofb3oe7zokcfqp9Hrl8rsfLvnZa/hZa7fgLHVVwmECq7rU18AAAAASUVORK5CYII="}},92990:(e,n,s)=>{"use strict";s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>m,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"mlops/monitoring/prometheus/crd/prometheus","title":"Prometheus","description":"Prometheus","source":"@site/docs/mlops/monitoring/prometheus/crd/prometheus.mdx","sourceDirName":"mlops/monitoring/prometheus/crd","slug":"/mlops/monitoring/prometheus/crd/prometheus","permalink":"/docs/mlops/monitoring/prometheus/crd/prometheus","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/monitoring/prometheus/crd/prometheus.mdx","tags":[],"version":"current","lastUpdatedAt":1743003044000,"frontMatter":{"id":"prometheus","title":"Prometheus","sidebar_label":"Prometheus","description":"Prometheus","keywords":["Prometheus","operator","CRD"]},"sidebar":"monitoring","previous":{"title":"Operator","permalink":"/docs/mlops/monitoring/prometheus/operator"},"next":{"title":"Monitor","permalink":"/docs/mlops/monitoring/prometheus/crd/monitor"}}');var i=s(74848),o=s(28453),c=s(82331);const t={id:"prometheus",title:"Prometheus",sidebar_label:"Prometheus",description:"Prometheus",keywords:["Prometheus","operator","CRD"]},l=void 0,a={},d=[{value:"ServiceAccount",id:"serviceaccount",level:2},{value:"Prometheus",id:"prometheus",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("center",{children:(0,i.jsx)(c.A,{img:s(61495),width:750})}),"\n",(0,i.jsx)("center",{children:(0,i.jsx)("strong",{children:"Prometheus Operator Architecture"})}),"\n",(0,i.jsx)(n.h2,{id:"serviceaccount",children:"ServiceAccount"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md#enable-rbac-rules-for-prometheus-pods",children:"https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/user-guides/getting-started.md#enable-rbac-rules-for-prometheus-pods"})}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: <name>\n  namespace: <namespace>\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: <name>\nrules:\n  - apiGroups: [""]\n    resources:\n      - nodes\n      - nodes/metrics\n      - services\n      - endpoints\n      - pods\n    verbs: ["get", "list", "watch"]\n  - apiGroups: [""]\n    resources:\n      - configmaps\n    verbs: ["get"]\n  - apiGroups:\n      - networking.k8s.io\n    resources:\n      - ingresses\n    verbs: ["get", "list", "watch"]\n  - nonResourceURLs: ["/metrics"]\n    verbs: ["get"]\n\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: <name>\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: <name>\nsubjects:\n  - kind: ServiceAccount\n    name: <name>\n    namespace: <namespace>\n'})}),"\n",(0,i.jsx)(n.h2,{id:"prometheus",children:"Prometheus"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#prometheus",children:"https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#prometheus"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"spec\uc5d0 \ub9de\ub294 prometheus StatefulSets\uc744 \uc0dd\uc131\ud569\ub2c8\ub2e4."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'apiVersion: monitoring.coreos.com/v1\nkind: Prometheus\nmetadata:\n  name: <name>\n  namespace: <namespace>\nspec:\n  serviceAccountName: <serviceAccountName>\n\n  podMetadata: {}\n\n  initContainers:\n    - name: "prometheus-permission"\n      image: "busybox"\n      command: ["/bin/chmod", "-R", "777", "/prometheus"]\n      volumeMounts:\n        - name: "prometheus-<name>-db"\n          mountPath: "/prometheus"\n\n  storage:\n    volumeClaimTemplate:\n      spec:\n        storageClassName: gp3\n        accessModes:\n          - "ReadWriteOnce"\n        resources:\n          requests:\n            storage: 30Gi\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"serviceAccountName: <serviceAccountName>"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"podMetadata"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"labels: {}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"annotations: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"resources: {}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"initContainers: []"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"storage"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"volumeClaimTemplate: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"affinity: {}"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"tolerations: []"})}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"podMonitorNamespaceSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 Namespace\uc5d0\uc11c PodMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 Prometheus\uac00 \uc120\uc5b8\ub41c Namespace\uc5d0\uc11c\ub9cc PodMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"podMonitorSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 PodMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 PodMonitor\ub97c \ucc3e\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"serviceMonitorNamespaceSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 Namespace\uc5d0\uc11c ServiceMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 Prometheus\uac00 \uc120\uc5b8\ub41c Namespace\uc5d0\uc11c\ub9cc ServiceMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"serviceMonitorSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 ServiceMonitor\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 ServiceMonitor\ub97c \ucc3e\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scrapeConfigNamespaceSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 Namespace\uc5d0\uc11c ScrapeConfig\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 Prometheus\uac00 \uc120\uc5b8\ub41c Namespace\uc5d0\uc11c\ub9cc ScrapeConfig\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"scrapeConfigSelector"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"{}"}),"\ub85c \uc124\uc815\ud558\uba74 \ubaa8\ub4e0 ScrapeConfig\ub97c \ucc3e\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"null"}),"\ub85c \uc124\uc815\ud558\uba74 ScrapeConfig\ub97c \ucc3e\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchExpressions: []"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"matchLabels: {}"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"retention: 24h"})}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"Scrape \uc124\uc815 \ucd94\uac00\ub97c \uc544\ub798\uc640 \uac19\uc740 \ubc29\ubc95\uc73c\ub85c \uc9c1\uc811 \uc791\uc131\ud574 \ub123\uc744 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: additional-scrape-configs\n  namespace: monitoring\nstringData:\n  prometheus-additional.yaml: |\n    - job_name: 'prometheus-other-cluster-1'\n      scheme: http\n      scrape_interval: 23s\n      scrape_timeout: 23s\n      honor_labels: true\n      metrics_path: '/federate'\n\n      params:\n        'match[]':\n          - '{job=~\".+\", job!=\"kublet\"}'\n\n      static_configs:\n        - targets:\n          - 'prometheus-eks-2.monitoring:9090'\n\n    - job_name: 'prometheus-other-cluster-2'\n      scheme: http\n      scrape_interval: 21s\n      scrape_timeout: 21s\n      honor_labels: true\n      metrics_path: '/federate'\n\n      params:\n        'match[]':\n          - '{job=\"kublet\"}'\n\n      static_configs:\n        - targets:\n          - 'prometheus-eks-2.monitoring:9090'\n"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spec:\n  additionalScrapeConfigs:\n    name: additional-scrape-configs\n    key: prometheus-additional.yaml\n"})})]})]})}function m(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);