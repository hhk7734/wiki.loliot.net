"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[76278],{11164:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>a,contentTitle:()=>s,default:()=>u,frontMatter:()=>c,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"mlops/provisioning/ecr/ecr","title":"ECR","description":"ECR","source":"@site/docs/mlops/provisioning/ecr/ecr.mdx","sourceDirName":"mlops/provisioning/ecr","slug":"/mlops/provisioning/ecr/","permalink":"/docs/mlops/provisioning/ecr/","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/provisioning/ecr/ecr.mdx","tags":[],"version":"current","lastUpdatedAt":1758554600000,"frontMatter":{"id":"ecr","title":"ECR","sidebar_label":"ECR","description":"ECR","keywords":["ECR"]},"sidebar":"provisioning","previous":{"title":"Proxy Cache","permalink":"/docs/mlops/provisioning/harbor/proxy-cache"},"next":{"title":"Push/Pull","permalink":"/docs/mlops/provisioning/ecr/push-pull"}}');var r=i(74848),t=i(28453);const c={id:"ecr",title:"ECR",sidebar_label:"ECR",description:"ECR",keywords:["ECR"]},s=void 0,a={},l=[{value:"Registry",id:"registry",level:2},{value:"Replication",id:"replication",level:2},{value:"From",id:"from",level:3},{value:"To",id:"to",level:3}];function p(n){const e={code:"code",h2:"h2",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,t.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"registry",children:"Registry"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'name = "test"\ntest_registry = aws.ecr.Repository(\n    f"{name}-ecr",\n    name=name,\n    encryption_configurations=[aws.ecr.RepositoryEncryptionConfigurationArgs()],\n    image_scanning_configuration=aws.ecr.RepositoryImageScanningConfigurationArgs(\n        scan_on_push=False,\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n    tags={\n        "Name": name,\n        "Stack": variable.stack_name,\n    },\n)\n'})}),"\n",(0,r.jsx)(e.h2,{id:"replication",children:"Replication"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"A->B\ub85c B->C\ub85c \ubcf5\uc81c \uc124\uc815\uc744 \ud55c\ub2e4\uace0 \ud574\uc11c \uc804\ud30c\ub418\uc9c0\ub294 \uc54a\uc2b5\ub2c8\ub2e4. \uc774\ub7f0 \uacbd\uc6b0 A->B, A->C\ub85c \uad6c\uc131\ud574\uc57c \ud569\ub2c8\ub2e4."}),"\n",(0,r.jsx)(e.li,{children:"\uc0ad\uc81c\ub294 \uc804\ud30c\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4."}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"from",children:"From"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'to_account_id = "<account_id>"\nto_region = "<region>"\naws.ecr.ReplicationConfiguration(\n    "ecr-replication",\n    replication_configuration=aws.ecr.ReplicationConfigurationReplicationConfigurationArgs(\n        rules=[\n            aws.ecr.ReplicationConfigurationReplicationConfigurationRuleArgs(\n                destinations=[\n                    aws.ecr.ReplicationConfigurationReplicationConfigurationRuleDestinationArgs(\n                        registry_id=to_account_id,\n                        region=to_region,\n                    )\n                ],\n                # repository_filters=[\n                #     aws.ecr.ReplicationConfigurationReplicationConfigurationRuleRepositoryFilterArgs(\n                #         filter="<prefix>",\n                #         filter_type="PREFIX_MATCH",\n                #     )\n                # ],\n            )\n        ]\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n)\n'})}),"\n",(0,r.jsx)(e.h3,{id:"to",children:"To"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-python",children:'from_account_id = "<account_id>"\nfrom_region = "<region>"\nto_account_id = "<account_id>"\nto_region = "<region>"\naws.ecr.RegistryPolicy(\n    "ecr-registry-policy",\n    policy=json.dumps(\n        {\n            "Statement": [\n                {\n                    "Action": ["ecr:CreateRepository", "ecr:ReplicateImage"],\n                    "Effect": "Allow",\n                    "Principal": {"AWS": f"arn:aws:iam::{from_account_id}:root"},\n                    "Resource": f"arn:aws:ecr:{to_region}:{to_account_id}:repository/*",\n                    "Sid": f"{from_account_id}-ECR",\n                }\n            ],\n            "Version": "2012-10-17",\n        }\n    ),\n    opts=pulumi.ResourceOptions(protect=True),\n)\n'})})]})}function u(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(p,{...n})}):p(n)}},28453:(n,e,i)=>{i.d(e,{R:()=>c,x:()=>s});var o=i(96540);const r={},t=o.createContext(r);function c(n){const e=o.useContext(t);return o.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),o.createElement(t.Provider,{value:e},n.children)}}}]);