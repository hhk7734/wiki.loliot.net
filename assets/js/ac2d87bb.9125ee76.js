"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[2778],{97188:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>o,toc:()=>a});var l=s(74848),r=s(28453);const t={id:"crd",title:"Karpenter CRD",sidebar_label:"CRD",description:"Karpenter CRD",keywords:["karpenter","crd"]},i=void 0,o={id:"mlops/mlops/provisioning/karpenter/crd",title:"Karpenter CRD",description:"Karpenter CRD",source:"@site/docs/mlops/mlops/provisioning/karpenter/crd.mdx",sourceDirName:"mlops/mlops/provisioning/karpenter",slug:"/mlops/mlops/provisioning/karpenter/crd",permalink:"/docs/mlops/mlops/provisioning/karpenter/crd",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1723830925e3,frontMatter:{id:"crd",title:"Karpenter CRD",sidebar_label:"CRD",description:"Karpenter CRD",keywords:["karpenter","crd"]},sidebar:"mlops",previous:{title:"Spot Event",permalink:"/docs/mlops/mlops/provisioning/karpenter/spot-event"},next:{title:"Scheduling",permalink:"/docs/mlops/mlops/provisioning/karpenter/scheduling"}},c={},a=[{value:"NodePool",id:"nodepool",level:2},{value:"spec.template",id:"spectemplate",level:3},{value:"spec.template.spec.requirements",id:"spectemplatespecrequirements",level:4},{value:"spec.template.spec.kubelet",id:"spectemplatespeckubelet",level:4},{value:"spec.disruption",id:"specdisruption",level:3},{value:"spec.limits",id:"speclimits",level:3},{value:"EC2NodeClass",id:"ec2nodeclass",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"nodepool",children:"NodePool"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://karpenter.sh/docs/concepts/nodepools/",children:"https://karpenter.sh/docs/concepts/nodepools/"})}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["NodePool\ub294 ",(0,l.jsx)(n.strong,{children:"NodePool\uc5d0 \uba85\uc2dc\ub41c \uc81c\uc57d\uc0ac\ud56d"}),"\uacfc ",(0,l.jsx)(n.strong,{children:"Workload\uc5d0 \uba85\uc2dc\ub41c \uc81c\uc57d\uc0ac\ud56d"})," \uc911 \ucc98\ub9ac \uac00\ub2a5\ud55c \uc81c\uc57d\uc0ac\ud56d\uc744 \uace0\ub824\ud558\uc5ec \ud504\ub85c\ube44\uc800\ub2dd\uc744 \uc218\ud589\ud569\ub2c8\ub2e4. \uc635\uc158\uc774 \ub2e4\uc591\ud55c \ub9cc\ud07c \uc5ec\ub7ec \uc81c\uc57d\uc0ac\ud56d\uc758 \uc870\ud569\uc744 \ub9cc\ub4e4 \uc218 \uc788\ub3c4\ub85d \ud558\uc5ec \uc720\uc5b8\uc131\uc744 \uc81c\uacf5\ud569\ub2c8\ub2e4."]}),"\n",(0,l.jsx)(n.p,{children:"\ub610\ud55c kube-scheduler\ub098 Node\uac00 \uc900\ube44 \uc0c1\ud0dc\uac00 \ub418\uae30 \uc804\uc5d0 Pod\uac00 \ubc30\uce58\ub418\uae30 \uc704\ud55c \uc791\uc5c5\uc744 \ubbf8\ub9ac \uc218\ud589\ud574\uc11c \ub178\ub4dc \uc2dc\uc791 \ub300\uae30 \uc2dc\uac04\uc744 \uc904\uc5ec \uc90d\ub2c8\ub2e4."}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsx)(n.p,{children:"Node\ub294 NodePool\uac00 \uc18c\uc720\ud569\ub2c8\ub2e4. \ub530\ub77c\uc11c NodePool\ub97c \uc0ad\uc81c\ud558\uba74 \uc18c\uc720\ud558\uace0 \uc788\ub294 Node\ub4e4\ub3c4 \uc0ad\uc81c\ub429\ub2c8\ub2e4."})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl explain nodepool.spec\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: karpenter.sh/v1beta1\nkind: NodePool\nmetadata:\n  name: <name>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"spectemplate",children:"spec.template"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spec:\n  template:\n    metadata:\n      labels:\n        <key>: <value>\n      annotations:\n        <key>: <value>\n    spec:\n      nodeClassRef:\n        name: <nodeClassName>\n      taints:\n        - key: <key>\n          value: <value>\n          effect: <NoSchedule|PreferNoSchedule|NoExecute>\n      # startupTaints: []\n      requirements:\n        - key: <key>\n          operator: <In|NotIn|Exists|DoesNotExist|Gt|Lt>\n          values:\n            - <value>\n      kubelet:\n        clusterDNS:\n          - <ip|url>\n"})}),"\n",(0,l.jsx)(n.h4,{id:"spectemplatespecrequirements",children:"spec.template.spec.requirements"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://karpenter.sh/docs/concepts/nodepools/#spectemplatespecrequirements",children:"https://karpenter.sh/docs/concepts/nodepools/#spectemplatespecrequirements"})}),"\n"]}),"\n",(0,l.jsx)("br",{}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/labels-annotations-taints/",children:"\uc798 \uc54c\ub824\uc9c4 label"}),"\uc744 key\ub85c \ud558\ub294 \uc870\uac74\uc744 \uc124\uc815 \ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"key"}),", ",(0,l.jsx)(n.code,{children:"values"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/mlops/mlops/provisioning/karpenter/scheduling#well-knwon-labels",children:"Well-Knwon Label"})}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"operator"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"In"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"NotIn"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"Exists"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"DoesNotExist"})}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Gt"}),": \uc815\uc218\uac12\uc774 \uc8fc\uc5b4\uc84c\uc744 \ub54c\ub9cc \uc0ac\uc6a9 \uac00\ub2a5, \uc124\uc815\ud55c \uac12\ubcf4\ub2e4 \ud070 \uacbd\uc6b0 \ub9e4\uce6d\ub429\ub2c8\ub2e4."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Lt"}),": \uc815\uc218\uac12\uc774 \uc8fc\uc5b4\uc84c\uc744 \ub54c\ub9cc \uc0ac\uc6a9 \uac00\ub2a5, \uc124\uc815\ud55c \uac12\ubcf4\ub2e4 \uc791\uc740 \uacbd\uc6b0 \ub9e4\uce6d\ub429\ub2c8\ub2e4."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"values"}),"\uc5d0\ub294 \uc22b\uc790\ub3c4 ",(0,l.jsx)(n.code,{children:'"'}),"\ub85c \uac10\uc2f8\uc11c \ubb38\uc790\uc5f4\ub85c \uc785\ub825\ud574\uc57c \ud569\ub2c8\ub2e4."]}),"\n",(0,l.jsx)(n.li,{children:"\ud558\ub098\ub3c4 \uc120\uc5b8\uc744 \uc548\ud558\uba74 \uae30\ubcf8\uac12\uc73c\ub85c \uc124\uc815\ub418\ubbc0\ub85c \uc720\uc758\ud574\uc57c\ud569\ub2c8\ub2e4."}),"\n"]})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="default"',children:'spec:\n  template:\n    spec:\n      requirements:\n        - key: kubernetes.io/arch\n          operator: In\n          values: ["amd64"]\n        - key: kubernetes.io/os\n          operator: In\n          values: ["linux"]\n        - key: karpenter.sh/capacity-type\n          operator: In\n          values: ["on-demand"]\n        - key: karpenter.k8s.aws/instance-category\n          operator: In\n          values: ["c", "m", "r"]\n        - key: karpenter.k8s.aws/instance-generation\n          operator: Gt\n          values: ["2"]\n'})}),"\n",(0,l.jsx)(n.h4,{id:"spectemplatespeckubelet",children:"spec.template.spec.kubelet"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://karpenter.sh/docs/concepts/nodepools/#spectemplatespeckubelet",children:"https://karpenter.sh/docs/concepts/nodepools/#spectemplatespeckubelet"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"specdisruption",children:"spec.disruption"}),"\n",(0,l.jsxs)(n.p,{children:["Karpenter\ub294 \uac01 Node\uc5d0 ",(0,l.jsx)(n.code,{children:"Finalizer"}),"\ub97c \uc124\uc815\ud558\uc5ec Node \uc0ad\uc81c \ud504\ub85c\uc138\uc2a4\ub97c \uac1c\uc120\ud574\uc90d\ub2c8\ub2e4."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"kubectl delete node <node>"})," \ub610\ub294 ",(0,l.jsx)(n.code,{children:"kubectl delete node -l <key>[=<value>]"}),"\ub85c Node\ub97c \uc81c\uac70\ud560 \ub54c\uc5d0\ub3c4 Karpenter\uac00 \uad00\ub9ac\ud558\ub294 Node\ub294 \ubbf8\ub9ac Finalizer\ub97c \uc124\uc815\ud574\ub1a8\uae30 \ub54c\ubb38\uc5d0 Node \uc0ad\uc81c\uc5d0 \uc758\ud574 \uc0dd\uae38 \uc218 \uc788\ub294 \ubb38\uc81c\ub97c \ucd5c\uc18c\ud654 \ud574\uc90d\ub2c8\ub2e4."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spec:\n  disruption:\n    consolidationPolicy: WhenUnderutilized # WhenUnderutilized|WhenEmpty\n    # WhenEmpty \uc815\ucc45\uc744 \uc0ac\uc6a9 \uc2dc, \ub178\ub4dc\uc5d0 Daemonset\uc744 \uc81c\uc678\ud55c Pod\uac00 \uc5c6\uc744 \ub54c,\n    # consolidateAfter \uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \ub178\ub4dc\ub97c \uc815\ub9ac\ud569\ub2c8\ub2e4.\n    consolidateAfter: 30s # 00h00m00s|Never\n    # expireAfter \uc2dc\uac04\uc774 \uc9c0\ub098\uba74 \ub178\ub4dc\ub97c \uc815\ub9ac\ud569\ub2c8\ub2e4.\n    expireAfter: 720h # 00h00m00s|Never\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:["Spot\uc758 \uacbd\uc6b0 WhenUnderutilized\uc5d0 \uc758\ud55c \uc815\ub9ac\ub294 \uc544\uc9c1 \uc9c0\uc6d0\ub418\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4. ",(0,l.jsx)(n.a,{href:"https://github.com/kubernetes-sigs/descheduler",children:"https://github.com/kubernetes-sigs/descheduler"})," \ub97c \uace0\ub824\ud574\ubcf4\uc138\uc694."]})}),"\n",(0,l.jsx)(n.h3,{id:"speclimits",children:"spec.limits"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'spec:\n  limits:\n    # \uad00\ub9ac\ud558\ub294 \ub9ac\uc18c\uc2a4\uc758 \ucd1d \ud569\uc774 \uc544\ub798 \uc124\uc815 \uac12\uc744 \ub118\uc5b4\uac00\uba74 \ub354\uc774\uc0c1 \ub178\ub4dc\ub97c \uc0dd\uc131\ud558\uc9c0\n    # \uc54a\uc2b5\ub2c8\ub2e4.\n    # cpu: "10" \uc73c\ub85c \uc124\uc815\ub418\ub354\ub77c\ub3c4 72 \ucf54\uc5b4 \uc778\uc2a4\ud134\uc2a4\uac00 \uc0dd\uc131\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n    cpu: <DecimalSI> # m|""|k|M|G|T|P|E\n    memory: <BinarySI> # Ki|Mi|Gi|Ti|Pi|Ei\n'})}),"\n",(0,l.jsx)(n.h2,{id:"ec2nodeclass",children:"EC2NodeClass"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://karpenter.sh/docs/concepts/nodeclasses/",children:"https://karpenter.sh/docs/concepts/nodeclasses/"})}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"kubectl explain ec2nodeclass.spec\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: karpenter.k8s.aws/v1beta1\nkind: EC2NodeClass\nmetadata:\n  name: <name>\nspec:\n  amiFamily: AL2\n  # \ub9ac\uc2a4\ud2b8\ub294 OR \uc870\uac74\uc73c\ub85c \ucc98\ub9ac\ub429\ub2c8\ub2e4\n  subnetSelectorTerms:\n    # <value>\ub294 ''(\ubaa8\ub450 \uc77c\uce58), '*XX*'(\uc640\uc77c\ub4dc\uce74\ub4dc)\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n    - tags:\n        <key>: <value>\n        # kubernetes.io/cluster/<clusterName>: '*'\n        # karpenter.sh/discovery: <clusterName>\n    - id: <subnetID>\n  securityGroupSelectorTerms:\n    # <value>\ub294 ''(\ubaa8\ub450 \uc77c\uce58), '*XX*'(\uc640\uc77c\ub4dc\uce74\ub4dc)\ub97c \uc0ac\uc6a9\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4.\n    - tags:\n        <key>: <value>\n        # kubernetes.io/cluster/<clusterName>: '*'\n        # karpenter.sh/discovery: <clusterName>\n    # - name: <SGName>\n    # - id: <SGID>\n  # role \ub610\ub294 instanceProfile \uc911 \ud558\ub098\ub97c \uc124\uc815\ud574\uc57c\ud569\ub2c8\ub2e4.\n  role: <instanceAWSRoleName>\n  # instanceProfile: <instanceProfile>\n  tags:\n    # \ucd94\uac00\uc801\uc73c\ub85c \uc124\uc815\ud560 \ud0dc\uadf8\ub97c \uc124\uc815\ud569\ub2c8\ub2e4.\n    <key>: <value>\n  blockDeviceMappings:\n    - deviceName: /dev/xvda\n      ebs:\n        volumeType: gp3\n        volumeSize: 50Gi\n        encrypted: true\n        deleteOnTermination: true\n  # AMIFamily\uc758 \uae30\ubcf8 userData\uc5d0 \ubcd1\ud569\ub418\uac70\ub098 \uc55e\uc5d0 \ucd94\uac00\ub429\ub2c8\ub2e4.\n  userData: |\n    #!/bin/bash\n    echo \"Hello, World!\"\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>o});var l=s(96540);const r={},t=l.createContext(r);function i(e){const n=l.useContext(t);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);