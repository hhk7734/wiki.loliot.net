"use strict";(self.webpackChunkwiki_loliot_net=self.webpackChunkwiki_loliot_net||[]).push([[40844],{82545:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"mlops/mlops/container/apptainer","title":"Apptainer for HPC","description":"Apptainer for HPC","source":"@site/docs/mlops/mlops/container/apptainer.mdx","sourceDirName":"mlops/mlops/container","slug":"/mlops/mlops/container/apptainer","permalink":"/docs/mlops/mlops/container/apptainer","draft":false,"unlisted":false,"editUrl":"https://github.com/hhk7734/wiki/tree/main/docs/mlops/mlops/container/apptainer.mdx","tags":[],"version":"current","lastUpdatedAt":1732944079000,"frontMatter":{"id":"apptainer","title":"Apptainer for HPC","sidebar_label":"Apptainer for HPC","description":"Apptainer for HPC","keywords":["HPC","apptainer"]},"sidebar":"mlops","previous":{"title":"CRI - containerd","permalink":"/docs/mlops/mlops/container/cri-containerd"},"next":{"title":"Buildah and Skopeo","permalink":"/docs/mlops/mlops/container/buildah-skopeo"}}');var l=i(74848),t=i(28453);const a={id:"apptainer",title:"Apptainer for HPC",sidebar_label:"Apptainer for HPC",description:"Apptainer for HPC",keywords:["HPC","apptainer"]},r=void 0,d={},o=[{value:"\uc124\uce58",id:"\uc124\uce58",level:2},{value:"\uc0ac\uc804 \uc694\uad6c \uc0ac\ud56d",id:"\uc0ac\uc804-\uc694\uad6c-\uc0ac\ud56d",level:3},{value:"Apptainer",id:"apptainer",level:3},{value:"Uninstall",id:"uninstall",level:2},{value:"apptainer.conf",id:"apptainerconf",level:2},{value:"Bind Paths and Mounts",id:"bind-paths-and-mounts",level:3},{value:"Loop devices",id:"loop-devices",level:3},{value:"Build Test",id:"build-test",level:2},{value:"Definition file",id:"definition-file",level:2},{value:"Reference",id:"reference",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.h2,{id:"\uc124\uce58",children:"\uc124\uce58"}),"\n",(0,l.jsx)(n.h3,{id:"\uc0ac\uc804-\uc694\uad6c-\uc0ac\ud56d",children:"\uc0ac\uc804 \uc694\uad6c \uc0ac\ud56d"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo yum update -y \\\n&& sudo yum groupinstall -y 'Development Tools' \\\n&& sudo yum install -y \\\n    openssl-devel \\\n    libuuid-devel \\\n    libseccomp-devel \\\n    wget \\\n    squashfs-tools \\\n    cryptsetup\n"})}),"\n",(0,l.jsx)(n.p,{children:"or"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo apt-get update -y \\\n&& sudo apt-get install -y \\\n    build-essential \\\n    uuid-dev \\\n    libgpgme-dev \\\n    squashfs-tools \\\n    libseccomp-dev \\\n    wget \\\n    pkg-config \\\n    git \\\n    cryptsetup-bin\n"})}),"\n",(0,l.jsx)(n.p,{children:"Golang is required to build the apptainer."}),"\n",(0,l.jsx)(n.h3,{id:"apptainer",children:"Apptainer"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"export APPTAINER_VERSION=1.0.1\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo mkdir -p /opt/apptainer/$APPTAINER_VERSION\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"git clone https://github.com/apptainer/apptainer.git -b v$APPTAINER_VERSION --depth 1 \\\n&& cd apptainer\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"./mconfig --prefix=/opt/apptainer/$APPTAINER_VERSION \\\n&& make -C builddir \\\n&& sudo make -C builddir install\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"info",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"--without-suid"})," \uc635\uc158\uc744 \uc0ac\uc6a9\ud558\uc5ec \uc124\uce58\ud558\uba74 setuid \uad8c\ud55c\uc774 \ucc98\uc74c\ubd80\ud130 \uc5c6\ub294 \ub300\uc2e0 ",(0,l.jsx)(n.code,{children:"/opt/apptainer/$APPTAINER_VERSION"})," \ud3f4\ub354 \uc804\uccb4\ub97c \ub2e4\ub978 \uacf3\uc73c\ub85c \uc62e\uae30\ub354\ub77c\ub3c4 \uc2e4\ud589\uc5d0 \ubb38\uc81c\uac00 \uc5c6\uc2b5\ub2c8\ub2e4. ",(0,l.jsx)(n.code,{children:"libexec/apptainer/bin/starter-suid"}),"\uac00 setuid \uad00\ub828 \ud30c\uc77c\uc785\ub2c8\ub2e4."]})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.code,{children:"./mconfig --help"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"export PATH=/opt/apptainer/$APPTAINER_VERSION/bin:$PATH\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:["\uac00\ub2a5\ud558\uba74 \ucef4\ud4e8\ud2b8 \ub178\ub4dc\uc758 \ub85c\uceec \ub514\uc2a4\ud06c\uc5d0 \uc124\uce58\ud558\ub294 \uac83\uc774 \uc88b\uc73c\ub098 \ub124\ud2b8\uc6cc\ud06c \uc704\uce58\uc5d0 \uc124\uce58\ub418\ub294 \uacbd\uc6b0 ",(0,l.jsx)(n.code,{children:"--localstatedir"})," \uc635\uc158\uc744 \ud1b5\ud574 \ucee8\ud14c\uc774\ub108 \uc2e4\ud589\uc2dc \ud544\uc694\ud55c \ub8e8\ud2b8 \ud30c\uc77c \uc2dc\uc2a4\ud15c, \uc624\ubc84\ub808\uc774, \ubc14\uc778\ub529 \ub9c8\uc6b4\ud2b8 \ub4f1\uc73c\ub85c \uc0ac\uc6a9\ub420 \uc218 \uc788\ub294 \ub85c\uceec \uc2a4\ud1a0\ub9ac\uc9c0\ub97c \uc7a1\uc544\uc8fc\ub294 \uac83\uc774 \uc88b\uc2b5\ub2c8\ub2e4."]})}),"\n",(0,l.jsx)(n.h2,{id:"uninstall",children:"Uninstall"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo rm -r /opt/apptainer/$APPTAINER_VERSION\n"})}),"\n",(0,l.jsx)(n.h2,{id:"apptainerconf",children:"apptainer.conf"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/apptainer/apptainer/blob/main/pkg/util/apptainerconf/config.go",children:"https://github.com/apptainer/apptainer/blob/main/pkg/util/apptainerconf/config.go"})}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"bind-paths-and-mounts",children:"Bind Paths and Mounts"}),"\n",(0,l.jsxs)(n.p,{children:["Apptainer\uc758 \ud2b9\uc9d5 \uc911 \ud558\ub098\ub294 ",(0,l.jsx)(n.code,{children:"apptainer run"}),", ",(0,l.jsx)(n.code,{children:"apptainer exec"}),", ",(0,l.jsx)(n.code,{children:"apptainer shell"})," ",(0,l.jsx)(n.code,{children:"apptainer instance start"})," \uba85\ub839\uc5b4\ub97c \uc0ac\uc6a9\ud560 \ub54c, Host\uc640 Container\uac00 \uae30\ubcf8\uc801\uc73c\ub85c \uacf5\uc720\ud558\ub294 \uacbd\ub85c\uac00 \uc874\uc7ac\ud55c\ub2e4\ub294 \uac83\uc785\ub2c8\ub2e4."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",metastring:'title="apptainer.conf"',children:"mount <system path> = <yes|no>\n"})}),"\n",(0,l.jsx)(n.p,{children:"\uae30\ubcf8 \uc124\uc815\uc5d0\uc11c \ubc14\uc778\ub529 \ub418\ub294 \uc2dc\uc2a4\ud15c \uacbd\ub85c\ub294 \uc544\ub798\uc640 \uac19\uc2b5\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"$HOME"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/sys:/sys"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/proc:/proc"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/tmp:/tmp"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/var/tmp:/var/tmp"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/etc/resolv.conf:/etc/resolv.conf"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"/etc/passwd:/etc/passwd"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"$PWD"})}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"\uc0ac\uc6a9\uc790 \uc815\uc758\uc5d0 \uc758\ud55c \ubc14\uc778\ub529\uc740 \uc544\ub798\uc640 \uac19\uc740 \ubc29\ubc95\uc73c\ub85c \ucd94\uac00\ub420 \uc218 \uc788\uc2b5\ub2c8\ub2e4."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",metastring:'title="apptainer.conf"',children:"bind path = <path1>\nbind path = <path2>\n"})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"--bind Host[:Container[:Option]]"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"APPTAINER_BIND=Host[:Container[:Option]]"})}),"\n",(0,l.jsxs)(n.li,{children:["\uc635\uc158\uc744 \uc5ec\ub7ec \ubc88 \uc4f0\uac70\ub098, ",(0,l.jsx)(n.code,{children:","}),"\ub97c \uc0ac\uc6a9\ud558\uc5ec \uc5ec\ub7ec \uac1c\uc758 \uaddc\uce59\uc744 \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n",(0,l.jsx)(n.li,{children:"Container\uac00 \uc815\ud574\uc838 \uc788\uc9c0 \uc54a\uc740 \uacbd\uc6b0 Host\uc640 \uac19\uc740 \uacbd\ub85c\ub97c \uc0ac\uc6a9\ud55c\ub2e4\uace0 \uac00\uc815\ud569\ub2c8\ub2e4."}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Option"}),"\uc73c\ub85c\ub294 ",(0,l.jsx)(n.code,{children:"ro"}),"(read only)\uc640 ",(0,l.jsx)(n.code,{children:"rw"}),"(read write, default)\ub97c \uc9c0\uc815\ud560 \uc218 \uc788\uc2b5\ub2c8\ub2e4."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"loop-devices",children:"Loop devices"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",metastring:'title="apptainer.conf"',children:"max loop devices = <number>\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-conf",metastring:'title="apptainer.conf"',children:"shared loop devices = <yes|no>\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsx)(n.p,{children:"Linux Container\uc548\uc5d0\uc11c apptainer\ub97c \uc0ac\uc6a9\ud560 \ub54c, \ubcd1\ub82c\ub85c \uc2e4\ud589\ub418\ub294 Container\uc758 \uc218\uac00 \ub9ce\uc544\uc9c0\uba74 loop device\uac00 \ubd80\uc871\ud574\uc9c8 \uc218 \uc788\uc2b5\ub2c8\ub2e4."})}),"\n",(0,l.jsx)(n.h2,{id:"build-test",children:"Build Test"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apptainer pull docker://ubuntu:20.04\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"apptainer build --sandbox ubuntu ubuntu_20.04.sif\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo `which apptainer` shell --writable ubuntu\n"})}),"\n",(0,l.jsx)(n.admonition,{type:"warning",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"apptainer shell"})," \uba85\ub839\uc73c\ub85c \ucee8\ud14c\uc774\ub108\uc5d0 \uc811\uc18d\ud574\uc11c \uc791\uc5c5\uc744 \ud560 \ub54c, Host\uc640 Container\uac04 \uacf5\uc720\ub418\ub294 \uacbd\ub85c\uc5d0 \uc8fc\uc758\ud574\uc57c\ud569\ub2c8\ub2e4."]})}),"\n",(0,l.jsx)(n.h2,{id:"definition-file",children:"Definition file"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:'Bootstrap: localimage\nFrom: ubuntu_20.04.sif\nStage: build\n\n%setup\n    touch /file1\n    touch ${APPTAINER_ROOTFS}/file2\n\n%files\n    /file1\n    /file1 /opt\n\n%environment\n    export LISTEN_PORT=12345\n    export LC_ALL=C\n\n%post\n    apt-get update && apt-get install -y netcat\n    NOW=`date`\n    echo "export NOW=\\"${NOW}\\"" >> $APPTAINER_ENVIRONMENT\n\n%runscript\n    echo "Container was created $NOW"\n    echo "Arguments received: $*"\n    exec echo "$@"\n\n%startscript\n    nc -lp $LISTEN_PORT\n\n%test\n    grep -q NAME=\\"Ubuntu\\" /etc/os-release\n    if [ $? -eq 0 ]; then\n        echo "Container base is Ubuntu as expected."\n    else\n        echo "Container base is not Ubuntu."\n        exit 1\n    fi\n\n%labels\n    Author hyeonki\n    Version v0.0.1\n\n%help\n    This is a demo container used to illustrate a def file that uses all\n    supported sections.\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-shell",children:"sudo `which apptainer` build <sif> <def>\n"})}),"\n",(0,l.jsx)(n.h2,{id:"reference",children:"Reference"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/apptainer/apptainer",children:"https://github.com/apptainer/apptainer"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://apptainer.org/docs/admin/main/index.html",children:"https://apptainer.org/docs/admin/main/index.html"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://apptainer.org/docs/user/main/",children:"https://apptainer.org/docs/user/main/"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>r});var s=i(96540);const l={},t=s.createContext(l);function a(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);